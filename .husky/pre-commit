#!/bin/sh
# QOS v1 pre-commit: spectral & semgrep
if command -v npx >/dev/null 2>&1; then
  npx @stoplight/spectral-cli lint docs/03_ssot/openapi/staff-management.yaml || echo "⚠️ Spectral rule needs fix"
  [ -f docs/03_ssot/openapi/generic-resources.yaml ] && npx @stoplight/spectral-cli lint docs/03_ssot/openapi/generic-resources.yaml || true
fi
if command -v semgrep >/dev/null 2>&1; then
  semgrep --config .semgrep.yml || exit 1
else
  echo "⚠ semgrep not found; skipping"
fi

# Lint gate (kanri side)
if command -v npm >/dev/null 2>&1; then
  npm run ci:lint || true
fi
