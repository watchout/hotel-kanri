#!/usr/bin/env bash
# =============================================================================
# hotel-kanri Pre-Push: Critical Gates Only
# =============================================================================
# 設計方針：
# - Critical（必須）: SSOT準拠、セキュリティ、DB整合性 → ブロッキング
# - Non-Critical（任意）: Lint/Test → CIで警告のみ
# =============================================================================

echo "🔍 Critical Gates チェック開始..."

# ✅ OpenAPI生成（SSOT整合性の一部）
echo "1/3 OpenAPI生成中..."
pnpm openapi:gen || {
  echo "❌ OpenAPI生成失敗"
  exit 1
}

# ✅ SSOT整合性チェック
echo "2/3 SSOT整合性チェック中..."
if [ -f "scripts/quality/check-ssot-consistency.cjs" ]; then
  node scripts/quality/check-ssot-consistency.cjs || {
    echo "❌ SSOT整合性チェック失敗"
    exit 1
  }
else
  echo "⚠️  SSOT整合性チェックスクリプト未実装（TODO）"
fi

# ✅ データベース整合性チェック
echo "3/3 データベース整合性チェック中..."
if [ -f "scripts/quality/check-database-naming.cjs" ]; then
  node scripts/quality/check-database-naming.cjs || {
    echo "❌ データベース命名規則違反"
    exit 1
  }
else
  echo "✅ データベース整合性チェック（既存スクリプト使用）"
fi

echo ""
echo "✅ All Critical Gates Passed!"
echo "💡 Non-Critical checks (lint/test) will run in CI"

