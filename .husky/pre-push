#!/usr/bin/env bash
# =============================================================================
# hotel-kanri Pre-Push: Critical Gates Only
# =============================================================================
# è¨­è¨ˆæ–¹é‡ï¼š
# - Criticalï¼ˆå¿…é ˆï¼‰: SSOTæº–æ‹ ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€DBæ•´åˆæ€§ â†’ ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°
# - Non-Criticalï¼ˆä»»æ„ï¼‰: Lint/Test â†’ CIã§è­¦å‘Šã®ã¿
# =============================================================================

echo "ğŸ” Critical Gates ãƒã‚§ãƒƒã‚¯é–‹å§‹..."

# âœ… OpenAPIç”Ÿæˆï¼ˆSSOTæ•´åˆæ€§ã®ä¸€éƒ¨ï¼‰
echo "1/3 OpenAPIç”Ÿæˆä¸­..."
pnpm openapi:gen || {
  echo "âŒ OpenAPIç”Ÿæˆå¤±æ•—"
  exit 1
}

# âœ… SSOTæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
echo "2/3 SSOTæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ä¸­..."
if [ -f "scripts/quality/check-ssot-consistency.cjs" ]; then
  node scripts/quality/check-ssot-consistency.cjs || {
    echo "âŒ SSOTæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯å¤±æ•—"
    exit 1
  }
else
  echo "âš ï¸  SSOTæ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆæœªå®Ÿè£…ï¼ˆTODOï¼‰"
fi

# âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
echo "3/3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ä¸­..."
if [ -f "scripts/quality/check-database-naming.cjs" ]; then
  node scripts/quality/check-database-naming.cjs || {
    echo "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‘½åè¦å‰‡é•å"
    exit 1
  }
else
  echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ï¼ˆæ—¢å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨ï¼‰"
fi

echo ""
echo "âœ… All Critical Gates Passed!"
echo "ğŸ’¡ Non-Critical checks (lint/test) will run in CI"

