# hotel-saas システム仕様書

> **注意**: このドキュメントは詳細仕様書です。概要情報は [docs/systems/saas/overview.md](../../systems/saas/overview.md) を参照してください。

## 概要
hotel-saasはホテル客室AIコンシェルジュシステムであり、顧客体験を向上させるためのシステムです。客室内でのサービス提供、パーソナライズされた提案、フィードバック収集などの機能を提供します。

## 目的
- 顧客満足度の向上
- 追加売上の創出
- スタッフの業務効率化
- データ収集によるサービス改善

## 主要機能

### 1. 客室内サービス提供
- ルームサービス注文
- 館内施設案内
- 周辺観光情報提供
- 客室設備操作（照明、空調等）

### 2. パーソナライズ機能
- 顧客の過去の利用履歴に基づいた提案
- 顧客の好みに合わせたコンテンツ表示
- 特別な日（誕生日、記念日等）の認識と対応

### 3. フィードバック収集
- サービス利用後の評価収集
- 滞在中のアンケート
- チェックアウト後のレビュー依頼

### 4. スタッフ連携
- フロントデスクへの問い合わせ
- 客室清掃リクエスト
- 特別要望の伝達

### 5. エンターテイメント
- 映画・音楽コンテンツ
- ゲーム
- 電子書籍

## システム構成

### フロントエンド
- Vue 3 + TypeScript
- Responsive Design（タブレット、スマートフォン、TV画面対応）
- PWA対応（オフライン機能）

### バックエンド
- Node.js + TypeScript
- Express
- WebSocket（リアルタイム通信）

### データベース
- PostgreSQL（共通基盤への移行中）
- Redis（キャッシュ、セッション管理）

### 外部連携
- hotel-pms API（予約、請求情報）
- hotel-member API（顧客情報）
- 外部コンテンツプロバイダAPI

## 画面構成

### 1. ホーム画面
- ウェルカムメッセージ
- クイックアクセスメニュー
- お知らせ・プロモーション
- 天気情報

### 2. サービスメニュー
- ルームサービス
- 館内施設予約
- 客室設備操作
- コンシェルジュサービス

### 3. 顧客情報画面
- 予約詳細
- 請求情報
- ポイント情報
- プロフィール設定

### 4. フィードバック画面
- サービス評価
- 滞在満足度調査
- 改善提案入力

## データフロー

### 1. 顧客情報取得
1. hotel-member APIから顧客基本情報を取得
2. customer.updatedイベントを購読して最新情報を維持

### 2. 予約情報取得
1. hotel-pms APIから予約情報を取得
2. reservation.updatedイベントを購読して最新情報を維持

### 3. サービス注文処理
1. ユーザーからの注文情報を受け取る
2. 注文情報をバリデーション
3. service.orderedイベントを発行
4. hotel-pmsで請求処理
5. 注文状況を更新

### 4. フィードバック処理
1. ユーザーからのフィードバックを受け取る
2. feedback.submittedイベントを発行
3. hotel-memberで顧客情報に紐づけて保存

## イベント連携

### 発行イベント
- service.ordered: サービス注文発生時
- service.canceled: サービス注文キャンセル時
- feedback.submitted: フィードバック送信時

### 購読イベント
- reservation.updated: 予約情報更新時
- checkin_checkout.checked_in: チェックイン発生時
- checkin_checkout.checked_out: チェックアウト発生時
- customer.updated: 顧客情報更新時

## セキュリティ要件
- JWT認証による保護
- 顧客データの暗号化
- XSS対策
- CSRF対策
- レート制限

## パフォーマンス要件
- 画面表示: 2秒以内
- API応答: 1秒以内
- 同時接続: 最大1000ユーザー

## 制約事項
- 顧客・予約情報は参照のみ（更新禁止）
- 他システムDBへの直接アクセス禁止
- 請求処理はhotel-pms経由で実行
- 決済処理はhotel-pms経由で実行

## 開発ガイドライン
- コンポーネントベース設計
- 状態管理はPinia
- APIクライアントは共通モジュール化
- エラーハンドリングの統一
- ログ出力の標準化

## テスト要件
- 単体テスト: Vitest
- E2Eテスト: Cypress
- カバレッジ目標: 80%以上

## デプロイメント
- Docker + Kubernetes
- CI/CD: GitHub Actions
- 環境: 開発、ステージング、本番
- ブルー/グリーンデプロイメント

## 監視・ロギング
- エラーログ
- パフォーマンスメトリクス
- ユーザー行動分析
- システムヘルスチェック