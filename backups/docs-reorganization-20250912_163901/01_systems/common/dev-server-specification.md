# 開発サーバー仕様書

## 1. 概要

本仕様書は、ホテル統合システム（hotel-saas, hotel-pms, hotel-member, hotel-common）の開発環境サーバー構成と運用方針を定義します。

## 2. サーバー構成

### 2.1 物理構成

**開発・デモ環境（ConoHa VPS）**

| サーバー名 | 役割 | スペック | IPアドレス |
|------------|------|----------|------------|
| omotenasu-dev | アプリケーションサーバー | メモリ 1GB / CPU 2Core | 163.44.117.60 |
| omotenasu-db | データベースサーバー | メモリ 4GB / CPU 4Core | 163.44.97.2 |

**本番環境（将来計画 - さくらクラウド）**

| サーバー名 | 役割 | スペック |
|------------|------|----------|
| app-prod | アプリケーションサーバー | メモリ 8GB / CPU 4Core |
| db-prod | データベースサーバー | メモリ 16GB / CPU 6Core |
| lb-prod | ロードバランサー | さくらクラウド標準 |

### 2.2 論理構成

**開発環境でのアプリケーション配置**

アプリケーションサーバー（omotenasu-dev）上で以下のシステムを共存させる:
- hotel-saas
- hotel-pms
- hotel-member
- hotel-common

**データベース構成**

データベースサーバー（omotenasu-db）上で以下のデータベースを運用:
- hotel_saas_dev
- hotel_pms_dev
- hotel_member_dev
- hotel_common_dev

## 3. 技術スタック

### 3.1 基本インフラ

- **OS**: Ubuntu Server 22.04 LTS
- **ランタイム**: Node.js 18 LTS
- **データベース**: PostgreSQL 14
- **コンテナ技術**: Docker & Docker Compose
- **プロセス管理**: PM2

### 3.2 開発ツール

- **バージョン管理**: Git
- **CI/CD**: GitHub Actions (将来的に導入)
- **監視**: Node Exporter + Prometheus (オプション)
- **セキュリティ**: UFW, Fail2Ban

## 4. 運用方針

### 4.1 アプリケーション管理

- 各アプリケーションは `/home/admin/projects/` 配下に配置
- PM2を使用してプロセス管理
- 環境変数は `.env` ファイルで管理

### 4.2 デプロイフロー

1. ローカル開発環境でコード開発・テスト
2. GitHubリポジトリにプッシュ
3. 開発サーバーでデプロイスクリプトを実行
4. PM2でアプリケーションを起動/再起動

### 4.3 リソース制約対応

- 同時に複数のアプリケーションを実行しない
- 不要なプロセスは停止して、リソースを効率的に利用
- メモリ使用量を定期的に監視

### 4.4 バックアップ戦略

- コードは GitHub リポジトリで管理
- データベースは日次バックアップ
- 設定ファイルは定期的にバックアップ

## 5. セキュリティ方針

### 5.1 アクセス制御

- SSH接続は公開鍵認証のみ許可
- root直接ログイン禁止
- sudoコマンドでの権限昇格

### 5.2 ネットワークセキュリティ

- UFWによるポート制限
- Fail2Banによる不正アクセス防止
- データベースサーバーへのアクセスは特定IPからのみ許可

### 5.3 更新管理

- セキュリティアップデートは定期的に適用
- 依存パッケージの脆弱性チェック

## 6. 監視・ロギング

- PM2によるアプリケーションログ管理
- システムログの定期チェック
- リソース使用状況の監視

## 7. 拡張性・将来計画

- リソース不足時はVPSのスペックアップグレード
- 本番環境はさくらクラウドで構築予定
- 将来的にはCI/CDパイプラインを整備

## 8. 制約事項

- 開発サーバーのリソースは限定的（メモリ1GB）
- 同時に複数アプリケーションの開発は困難
- 本格的な負荷テストには不適

## 9. バージョン管理

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2023-08-01 | 初版作成 |

## 10. 承認

本仕様書は開発チームによって承認されています。