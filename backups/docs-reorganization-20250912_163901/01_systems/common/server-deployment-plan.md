# ホテル統合システム サーバー環境構築計画

## 1. サーバー構成概要

### 開発/デモ環境 (ConoHa VPS)

**アプリケーションサーバー (OmotenasuAI)**
- IP: 163.44.117.60
- スペック: メモリ 1GB / CPU 2Core
- 役割: Node.js/TypeScriptアプリケーション実行環境

**データベースサーバー (OmotenasuDB)**
- IP: 163.44.97.2
- スペック: メモリ 4GB / CPU 4Core
- 役割: PostgreSQL専用サーバー

### 本番環境 (さくらクラウド - 将来計画)

**アプリケーションサーバー**
- 推奨スペック: メモリ 8GB / CPU 4Core (スタンダードプラン)
- 台数: 1台
- 役割: Node.js/TypeScriptアプリケーション実行環境

**データベースサーバー**
- 推奨スペック: メモリ 16GB / CPU 6Core
- 台数: 1台
- 役割: PostgreSQL専用サーバー

**ロードバランサー**
- さくらクラウド標準ロードバランサー
- 台数: 1台
- 役割: トラフィック分散、将来的な拡張性確保

## 2. OS選定

全環境共通で **Ubuntu Server 22.04 LTS** を採用

**選定理由**:
- 5年間の長期サポート (2027年4月まで)
- Node.js/TypeScript環境との高い親和性
- PostgreSQLとの相性の良さ
- 豊富なコミュニティサポートと情報源
- 充実したセキュリティ対策

## 3. 環境構築手順

### 3.1 開発環境構築 (ConoHa VPS)

#### 基本セットアップ
1. SSH鍵認証の設定
2. ファイアウォール設定 (UFW)
3. システムアップデート

#### アプリケーションサーバー (OmotenasuAI)
1. Node.js (v18 LTS) インストール
2. Git インストール
3. PM2 (プロセス管理) インストール
4. アプリケーションコードのデプロイ

#### データベースサーバー (OmotenasuDB)
1. PostgreSQL 14 インストール
2. データベースユーザー作成
3. リモートアクセス設定
4. バックアップ設定

### 3.2 本番環境構築 (将来計画)

1. さくらクラウドでのサーバー契約
2. ネットワーク設計 (プライベートネットワーク構成)
3. セキュリティグループ設定
4. CI/CDパイプラインの構築
5. 監視システムの導入

## 4. 環境差異の最小化対策

### 4.1 Docker/Docker Compose による環境標準化

```yaml
# docker-compose.yml
version: '3'
services:
  app:
    build: .
    environment:
      NODE_ENV: ${NODE_ENV:-development}
  db:
    image: postgres:14
    environment:
      POSTGRES_PASSWORD: ${DB_PASSWORD:-development}
```

### 4.2 環境変数による設定管理

```
project/
├── .env.local     # ローカル環境用
├── .env.development  # 開発サーバー用
└── .env.production   # 本番環境用
```

### 4.3 デプロイ自動化

- GitHub Actions による自動デプロイ
- テスト自動化
- 環境固有の設定自動適用

## 5. バックアップと復旧計画

### 5.1 データベースバックアップ

- 日次フルバックアップ
- 時間単位の増分バックアップ
- オフサイトバックアップの保管

### 5.2 復旧手順

- RTO (Recovery Time Objective): 2時間以内
- RPO (Recovery Point Objective): 1時間以内
- 定期的な復旧訓練の実施

## 6. セキュリティ対策

- SSH鍵認証のみ許可 (パスワード認証無効)
- ファイアウォール設定 (必要最小限のポートのみ開放)
- 定期的なセキュリティアップデート
- SSL/TLS証明書の導入
- WAF (Web Application Firewall) の検討

## 7. 監視計画

- サーバーリソース監視 (CPU, メモリ, ディスク)
- アプリケーションログ監視
- データベースパフォーマンス監視
- アラート設定

## 8. スケーリング計画

### 8.1 垂直スケーリング (初期段階)

- サーバースペックのアップグレード
- メモリ増設
- CPUコア数増加

### 8.2 水平スケーリング (成長段階)

- アプリケーションサーバーの増設
- ロードバランサーの導入
- データベースのレプリケーション設定

## 9. コスト見積もり

### 開発/デモ環境 (現状)

- アプリケーションサーバー: 約900円/月
- データベースサーバー: 約2,000円/月
- **合計**: 約2,900円/月

### 本番環境 (将来計画)

- アプリケーションサーバー: 約10,000円/月 (1台)
- データベースサーバー: 約30,000円/月
- ロードバランサー: 約5,000円/月
- その他 (バックアップ、監視等): 約10,000円/月
- **合計**: 約55,000円/月

## 10. 移行計画

### 10.1 開発からデモへの移行

1. コード凍結
2. テスト実施
3. デモ用データセット準備
4. デモ環境設定

### 10.2 デモから本番への移行

1. 本番環境構築
2. データ移行
3. 段階的カットオーバー
4. 動作検証
5. 監視体制確立

## 11. 運用体制

- 日次チェック項目
- 週次メンテナンス計画
- 月次レビュー
- インシデント対応フロー

## 12. 今後の課題

- 高可用性構成への移行
- ディザスタリカバリ計画の詳細化
- パフォーマンス最適化
- セキュリティ強化