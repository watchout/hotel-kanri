# 🔗 統合仕様ヒアリング質問書 【回答済み】

## OmotenasuAI PMS "Tsukuyomi" 連携管理者向け質問事項

**対象**: hotel-common / hotel-integration 担当者  
**目的**: システム間連携仕様の確定・共通ライブラリ設計方針の決定

**回答者**: システム統合管理者  
**回答日**: 2024年12月  
**回答形式**: ✅ 決定事項 / 🔄 検討中事項 / ⚠️ 要相談事項

---

## 📋 **1. 共通データスキーマ設計**

### 1.1 顧客・会員データ

**Q1-1: 顧客データの主管理システムはhotel-memberで確定でしょうか？**
> ✅ **決定事項**: **hotel-memberが顧客・会員データの主管理システム**
> - PostgreSQL + SQLAlchemy構成
> - OTPログイン、ランク・ポイントシステム実装済み
> - 他システムは参照・同期で利用

**Q1-2: PMSで必要な顧客情報項目（氏名、連絡先、会員レベル等）は？**
> ✅ **決定事項**: 以下の項目をPMSで参照必要
> ```typescript
> interface GuestDataForPMS {
>   user_id: string;           // 会員ID
>   name: string;              // 氏名
>   phone: string;             // 連絡先
>   email?: string;            // メールアドレス
>   rank_id: number;           // 会員ランク
>   current_points: number;    // 現在ポイント残高
>   total_stays: number;       // 総宿泊回数
> }
> ```

**Q1-3: 顧客データの更新頻度と同期タイミングは？**
> ✅ **決定事項**: **APIによる即時同期（リアルタイム反映）**
> - **リアルタイム同期**: チェックイン時の会員情報取得、基本情報変更
> - **更新可能項目**: 氏名・住所・電話番号（PMS側で限定的に更新可能）
> - **専用管理項目**: 会員ランク・配信設定はhotel-member管理専用
> - **権限制御**: フィールド単位の更新可否フラグで制御
> - **オフライン対応**: PMSローカルキャッシュ、復旧後差分同期

**Q1-4: ゲスト（非会員）データの扱いは各システム独立管理？**
> ✅ **決定事項**: **ゲストデータは各システム独立管理**
> - PMS: 一時的なゲスト情報（チェックイン～アウト期間）
> - hotel-saas: 客室利用時の注文・サービス利用履歴
> - hotel-member: 会員登録時のみデータ移管

### 1.2 予約・宿泊データ

**Q1-5: 予約データの主管理はhotel-saasで、PMSは参照のみ？**
> ✅ **決定事項**: **PMS中心一元管理構成**
> - **hotel-pms**: 全予約情報の一元管理（メインシステム）
> - **hotel-member**: 予約導線として特化、共通APIで接続
> - **OTA連携**: 双方向API連携（楽天・じゃらん・一休・Booking.com等）
> - **フロント予約**: hotel-pmsで直接登録、統合DBに反映
> - **origin属性**: 全予約に予約元を明示・識別（member/ota/front）

**Q1-6: チェックイン後の宿泊データ所有権はPMSに移管？**
> ✅ **決定事項**: **段階的データ所有権移管**
> ```
> 予約段階: hotel-member主管理
> チェックイン: PMSに会計・客室管理権限移管
> 滞在中: PMS主管理（hotel-saasは注文データのみ）
> チェックアウト: PMS完全管理（履歴として保管）
> ```

**Q1-7: 料金・プラン情報の管理責任はどのシステム？**
> 🔄 **検討中事項**: 
> - **基本料金**: PMSで管理（日次・季節変動対応）
> - **会員割引**: hotel-memberで管理（ランク連動）
> - **付帯サービス料金**: hotel-saasで管理（注文・コンシェルジュ）
> - ⚠️ **要相談**: 料金計算ロジックの統一化

**Q1-8: キャンセル・変更データの同期処理は？**
> 🔄 **検討中事項**: 
> - **予約変更**: hotel-member → PMSにリアルタイム通知
> - **キャンセル**: 全システム即座同期（在庫・売上への影響）
> - **No-Show処理**: PMSから他システムへ通知

### 1.3 共通スキーマ定義

**Q1-9: hotel-commonでのデータモデル定義方法は？（TypeScript型、JSON Schema、Zod等）**
> ✅ **決定事項**: **TypeScript + Zod**
> ```typescript
> // hotel-common/src/types/
> export const ReservationSchema = z.object({
>   id: z.string().uuid(),
>   user_id: z.string().uuid(),
>   checkin_date: z.date(),
>   checkout_date: z.date(),
>   room_type: z.enum(['standard', 'deluxe', 'suite']),
>   total_amount: z.number().positive(),
>   status: z.enum(['pending', 'confirmed', 'checked_in', 'completed', 'cancelled'])
> });
> ```

**Q1-10: スキーマバージョニング管理方法は？**
> 🔄 **検討中事項**: **セマンティックバージョニング採用**
> - hotel-common v1.x.x: 後方互換性維持
> - v2.x.x: 破壊的変更（事前調整必須）
> - 各システムでの依存バージョン管理

**Q1-11: 必須フィールド・オプションフィールドの設計方針は？**
> ✅ **決定事項**: **段階的必須化戦略**
> - Core必須: id, created_at, updated_at
> - システム別必須: 各システムで追加検証
> - 将来拡張用: optional フィールドとして先行定義

---

## 🔐 **2. 認証・セキュリティ統合**

### 2.1 共通認証基盤

**Q2-1: 共通認証サービスは既存サービス利用？独自実装？**
> ✅ **決定事項**: **hotel-common独自JWT実装**
> - 依存関係: jsonwebtoken v9.0.2 実装済み
> - Redis v5.6.0 でセッション管理
> - 各システムの既存認証との段階的統合

**Q2-2: JWT仕様（有効期限、リフレッシュトークン、署名アルゴリズム）は？**
> ✅ **決定事項**: 
> ```typescript
> interface JWTPayload {
>   user_id: string;
>   role: 'staff' | 'manager' | 'admin' | 'owner';
>   permissions: string[];
>   hotel_group_id: string;
>   exp: number;        // 8時間（勤務時間考慮）
>   refresh_exp: number; // 30日
> }
> ```

**Q2-3: スタッフ権限レベルの統一基準は？（4段階: 閲覧・入力・管理・経営者）**
> 🔄 **検討中事項**: **4段階統一権限**
> - **staff**: 基本操作（チェックイン・アウト、注文対応）
> - **manager**: 管理機能（日報、統計、設定変更）
> - **admin**: システム管理（ユーザー管理、バックアップ）
> - **owner**: 全権限（経営判断、システム統合管理）

**Q2-4: シングルサインオン（SSO）の実装範囲は？**
> ✅ **決定事項**: **段階的SSO実装（hotel-common JWT基盤）**
> - **Phase 1**: hotel-saas + hotel-member（優先実装）
> - **Phase 2**: hotel-pms統合、完全SSO実現
> - **技術基盤**: hotel-common JWT認証基盤に集約
> - **ID統一**: UUIDベースでユーザーID統一
> - **既存データ移行**: 各システムの既存認証データを段階的移行
> - **オフライン対応**: PMSローカルPIN認証 + キャッシュトークン併用

### 2.2 オフライン認証連携

**Q2-5: PMSのオフライン期間中の認証管理は？**
> 🔄 **検討中事項**: **ハイブリッド認証システム**
> - **オンライン時**: JWT認証（hotel-common経由）
> - **オフライン時**: ローカルPIN認証 + キャッシュされたトークン
> - **復旧時**: 自動再認証・同期

**Q2-6: ローカル認証（PIN）と共通認証の併用方法は？**
> 🔄 **検討中事項**: 
> ```typescript
> interface OfflineAuth {
>   staff_pin: string;      // 4桁PIN
>   cached_token: string;   // 最後のJWT
>   offline_permissions: string[]; // 制限された権限
>   last_sync: Date;        // 最後の同期時刻
> }
> ```

**Q2-7: オフライン復旧時の認証同期処理は？**
> 🔄 **検討中事項**: 
> - トークン有効性確認
> - 権限変更の差分同期
> - オフライン期間中の操作ログ送信

### 2.3 データ暗号化・保護

**Q2-8: システム間通信の暗号化方式は？（TLS、E2E暗号化等）**
> ✅ **決定事項**: **TLS 1.3 + API Key認証**
> - HTTPS必須（開発環境も含む）
> - API Key: システム間固有キー
> - 機密データ: AES-256追加暗号化

**Q2-9: 個人情報の暗号化・マスキング基準は？**
> ⚠️ **要相談事項**: **GDPR・個人情報保護法対応**
> - クレジットカード情報: 非保存（決済代行サービス利用）
> - 電話番号・メール: ハッシュ化 + 可逆暗号化
> - 宿泊履歴: 匿名化オプション

**Q2-10: ログ・監査データの管理方針は？**
> 🔄 **検討中事項**: 
> - 操作ログ: 3年保管
> - アクセスログ: 1年保管  
> - システム間通信ログ: 6ヶ月保管
> - ⚠️ **要相談**: ログ集約システムの選定

---

## 🔄 **3. API設計・通信方式**

### 3.1 API設計方針

**Q3-1: REST API設計の統一ルール（エンドポイント命名、HTTPメソッド等）は？**
> ✅ **決定事項**: **RESTful設計標準**
> ```
> GET    /api/v1/reservations        - 一覧取得
> GET    /api/v1/reservations/{id}   - 詳細取得
> POST   /api/v1/reservations        - 新規作成
> PUT    /api/v1/reservations/{id}   - 全体更新
> PATCH  /api/v1/reservations/{id}   - 部分更新
> DELETE /api/v1/reservations/{id}   - 削除
> ```

**Q3-2: レスポンス形式の統一フォーマットは？**
> ✅ **決定事項**: **統一APIレスポンス**
> ```typescript
> interface APIResponse<T> {
>   success: boolean;
>   data?: T;
>   error?: {
>     code: string;
>     message: string;
>     details?: any;
>   };
>   meta?: {
>     page?: number;
>     limit?: number;
>     total?: number;
>   };
> }
> ```

**Q3-3: エラーハンドリング・エラーコード体系は？**
> ✅ **決定事項**: **統一エラーコード体系**
> ```typescript
> enum ErrorCode {
>   // 共通エラー
>   INVALID_REQUEST = "E001",
>   UNAUTHORIZED = "E002", 
>   FORBIDDEN = "E003",
>   NOT_FOUND = "E004",
>   
>   // ビジネスロジックエラー
>   RESERVATION_CONFLICT = "B001",
>   INSUFFICIENT_POINTS = "B002",
>   ROOM_UNAVAILABLE = "B003",
>   
>   // システムエラー
>   DATABASE_ERROR = "S001",
>   SYNC_FAILURE = "S002"
> }
> ```

**Q3-4: ページネーション・フィルタリング方式は？**
> ✅ **決定事項**: **カーソルベースページネーション**
> ```
> GET /api/v1/reservations?cursor=xxx&limit=20&filter=status:confirmed&sort=checkin_date:desc
> ```

### 3.2 同期方式・頻度

**Q3-5: リアルタイム同期 vs バッチ同期の使い分け基準は？**
> ✅ **決定事項**: **Event-driven + Pub/Sub構成による優先度ベース同期**
> - **リアルタイム同期対象**: 予約情報・チェックイン/アウト・顧客基本情報・ポイント・部屋在庫
> - **バッチ同期対象**: 日次/月次売上集計・滞在傾向分析・会員ランク評価・レポート帳票
> - **同期方式**: Pub/Subメッセージング + Webhook + 非同期Queue処理
> - **疎結合設計**: Event-driven構造で複数システムが柔軟に連携

**Q3-6: WebSocket/SSE使用対象機能は？**
> ✅ **決定事項**: **Event-driven基盤でのWebSocket活用**
> - **基盤**: hotel-common Socket.io-client v4.8.1 + Pub/Sub連携
> - **対象機能**: リアルタイム稼働状況、緊急通知、予約状況更新
> - **通信障害対応**: PMSローカルキャッシュで業務継続、復旧後キューで差分同期
> - **冗長化設計**: ジャーナルリプレイによる整合性保証

**Q3-7: 同期失敗時のリトライ・エスカレーション方針は？**
> 🔄 **検討中事項**: **指数バックオフ + エスカレーション**
> - 1分後 → 5分後 → 15分後 → 1時間後
> - 3回失敗: 自動アラート
> - 12時間失敗: 手動介入要求

**Q3-8: データ量増加時のパフォーマンス対策は？**
> 🔄 **検討中事項**: 
> - データベース分割（月次・年次）
> - CDN活用（静的データ）
> - Redis活用（頻繁アクセスデータ）

### 3.3 オフライン対応

**Q3-9: PMSオフライン期間中の他システム動作は？**
> ✅ **決定事項**: **冗長化設計による業務継続**
> - **hotel-pms**: ローカルキャッシュ or 同期用軽量DB（read-only）で最低限業務継続
> - **hotel-saas**: 客室注文機能継続（PMSデータなしでも動作）
> - **hotel-member**: 会員機能継続（PMSとの同期は復旧後）
> - **制限機能**: チェックイン・アウト、リアルタイム在庫確認（オフライン時）
> - **復旧時**: キューを使って差分同期（ジャーナルリプレイ）

**Q3-10: オフライン復旧時の差分同期アルゴリズムは？**
> 🔄 **検討中事項**: **タイムスタンプベース差分同期**
> ```typescript
> interface SyncPayload {
>   last_sync_timestamp: Date;
>   incremental_changes: ChangeLog[];
>   conflict_resolution: 'timestamp' | 'manual';
> }
> ```

**Q3-11: データ競合解決の優先順位ルールは？**
> 🔄 **検討中事項**: **システム優先度**
> 1. **予約・会計データ**: PMS優先
> 2. **会員・ポイントデータ**: hotel-member優先  
> 3. **注文データ**: hotel-saas優先
> 4. **設定データ**: 最新タイムスタンプ優先

---

## ⚔️ **4. データ競合・整合性管理**

### 4.1 競合解決戦略

**Q4-1: 同一データが複数システムで更新された場合の解決方針は？**
> 🔄 **検討中事項**: **3段階競合解決**
> 1. **自動解決**: タイムスタンプ + システム優先度
> 2. **半自動解決**: ユーザー確認 + 推奨選択肢提示
> 3. **手動解決**: 管理者判断 + ログ記録

**Q4-2: タイムスタンプベース vs バージョンベースの選択基準は？**
> ✅ **決定事項**: **ハイブリッド方式**
> - **タイムスタンプ**: 単純データ更新（顧客情報等）
> - **バージョン**: 複雑データ（予約・会計データ）
> - **UUID**: 全データ（一意性保証）

**Q4-3: 手動解決が必要な競合の判定条件は？**
> 🔄 **検討中事項**: 
> - 金額差異 > 1000円
> - 予約期間の重複
> - 顧客情報の重要フィールド差異
> - システム間の論理矛盾

**Q4-4: 競合発生時の通知・アラート方法は？**
> 🔄 **検討中事項**: 
> - **即座通知**: 管理者へのメール + Slack
> - **日次サマリー**: 競合解決状況レポート
> - **週次**: 競合傾向分析

### 4.2 データ整合性チェック

**Q4-5: システム間データ整合性の定期チェック方法は？**
> 🔄 **検討中事項**: **多層チェックシステム**
> - **リアルタイム**: CRC32チェックサム
> - **日次**: 重要データの完全照合
> - **週次**: 統計データの突合
> - **月次**: 全データ整合性監査

**Q4-6: 不整合検出時の自動修復 vs 手動対応の基準は？**
> 🔄 **検討中事項**: 
> - **自動修復**: データフォーマット修正、軽微な不整合
> - **手動対応**: 金額・予約に関わる重要データ
> - **即座停止**: セキュリティ関連、システム全体への影響

**Q4-7: 整合性ログ・監査記録の保管期間は？**
> ✅ **決定事項**: 
> - **整合性チェックログ**: 1年保管
> - **競合解決ログ**: 3年保管
> - **監査記録**: 7年保管（法的要件考慮）

---

## 🧪 **5. テスト・品質保証**

### 5.1 統合テスト戦略

**Q5-1: システム間結合テストの実行環境・頻度は？**
> 🔄 **検討中事項**: **段階的テスト環境**
> - **開発環境**: 各開発者ローカルでモック利用
> - **統合環境**: 全システム接続、日次自動テスト
> - **ステージング環境**: 本番同等、週次手動テスト
> - **本番**: 段階的リリース、監視強化

**Q5-2: モックサーバー vs 実環境テストの使い分けは？**
> ✅ **決定事項**: **レベル別テスト**
> - **ユニット**: 100%モック
> - **統合**: 70%モック + 30%実環境
> - **E2E**: 100%実環境
> - **負荷**: 実環境 + テストデータ

**Q5-3: E2Eテストのシナリオ範囲は？**
> 🔄 **検討中事項**: **重要業務フロー**
> - 会員登録 → 予約 → チェックイン → 注文 → チェックアウト
> - ポイント利用 → 特典交換
> - 緊急キャンセル → 返金処理
> - オフライン復旧 → データ同期

**Q5-4: パフォーマンステスト・負荷テストの基準は？**
> 🔄 **検討中事項**: 
> - **同時利用者**: 最大10ユーザー
> - **レスポンス時間**: API < 500ms、画面遷移 < 2秒
> - **データ量**: 予約10,000件、会員1,000名での安定動作

### 5.2 品質管理

**Q5-5: コードレビュー・設計レビューのプロセスは？**
> ⚠️ **要相談事項**: **標準化されたレビュープロセス必要**
> - hotel-common変更: 全システム担当者レビュー必須
> - API仕様変更: 影響システム確認必須
> - セキュリティ関連: セキュリティ専門レビュー

**Q5-6: 共通ライブラリの変更管理・影響範囲確認方法は？**
> 🔄 **検討中事項**: **自動影響分析システム**
> - 依存関係分析ツール
> - 破壊的変更の自動検出
> - 影響範囲レポート自動生成

**Q5-7: 本番監視・アラート設計は？**
> 🔄 **検討中事項**: 
> - システム稼働率 > 99.5%
> - API異常率 < 1%
> - データ同期遅延 < 5分

---

## 🚀 **6. 開発・リリース管理**

### 6.1 開発プロセス

**Q6-1: hotel-commonライブラリの開発・更新サイクルは？**
> 🔄 **検討中事項**: **計画的リリースサイクル**
> - **マイナーバージョン**: 2週間ごと（機能追加）
> - **パッチバージョン**: 必要に応じて（バグ修正）
> - **メジャーバージョン**: 3ヶ月ごと（破壊的変更）

**Q6-2: 各システムのバージョン依存関係管理は？**
> 🔄 **検討中事項**: **依存関係マトリックス管理**
> ```
> hotel-saas: hotel-common ^1.2.0
> hotel-member: hotel-common ^1.1.0  
> hotel-pms: hotel-common ^1.3.0 (予定)
> ```

**Q6-3: ブレーキングチェンジ発生時の調整プロセスは？**
> ⚠️ **要相談事項**: **緊急調整プロトコル必要**
> - 事前通知（2週間前）
> - 移行ガイド作成
> - 段階的移行期間設定
> - ロールバック計画策定

**Q6-4: 開発環境・ステージング環境の構成は？**
> 🔄 **検討中事項**: 
> - **ローカル**: Docker Compose（全システム単一起動）
> - **統合**: クラウド環境（全システム接続）
> - **ステージング**: 本番同等構成

### 6.2 リリース調整

**Q6-5: システム間のリリース順序・タイミング調整は？**
> 🔄 **検討中事項**: **段階的リリース戦略**
> 1. hotel-common（基盤）
> 2. hotel-member（データ管理）
> 3. hotel-saas（ユーザー体験）
> 4. hotel-pms（業務管理）

**Q6-6: ローリングアップデート vs 一括アップデートの方針は？**
> 🔄 **検討中事項**: 
> - **一括**: 重要機能・破壊的変更
> - **ローリング**: バグ修正・軽微な改善
> - **カナリアリリース**: 新機能（段階的展開）

**Q6-7: 緊急修正・ホットフィックスの適用手順は？**
> ⚠️ **要相談事項**: **緊急対応プロトコル必要**
> - 緊急度判定基準
> - 承認フロー簡略化
> - 即座適用 vs 計画適用の判断基準

**Q6-8: 本番切り戻し（ロールバック）時の対応は？**
> 🔄 **検討中事項**: 
> - **自動ロールバック**: 重要メトリクス閾値超過時
> - **手動ロールバック**: 管理者判断
> - **データ整合性**: ロールバック後の同期処理

---

## 📈 **7. 将来拡張・スケーラビリティ**

### 7.1 拡張性設計

**Q7-1: 新システム追加時の連携追加プロセスは？**
> 🔄 **検討中事項**: **標準化された追加プロセス**
> - hotel-common SDK提供
> - 認証・API仕様の自動準拠
> - 段階的統合テスト

**Q7-2: マルチテナント（複数ホテル）対応の設計方針は？**
> ⚠️ **要相談事項**: **重要な将来要件**
> - データ分離戦略（DB分離 vs テーブル分離）
> - テナント別設定管理
> - テナント間データ共有制御

**Q7-3: 海外展開時の多言語・多通貨対応は？**
> 🔄 **検討中事項**: 
> - **多言語**: i18n対応（日英中韓）
> - **多通貨**: 為替レート自動更新
> - **地域法規**: GDPR、各国個人情報保護法

**Q7-4: パフォーマンス・容量の限界値とスケーリング方針は？**
> 🔄 **検討中事項**: 
> - **単一ホテル**: 同時ユーザー50名まで
> - **データ量**: 10年間履歴保持
> - **スケーリング**: 水平分散 vs 垂直分散

---

## 📋 **8. 運用・保守**

### 8.1 運用監視

**Q8-1: システム間通信の監視・ログ収集方式は？**
> 🔄 **検討中事項**: **統合監視システム**
> - **ログ集約**: ELK Stack または類似ツール
> - **メトリクス**: API応答時間、エラー率、スループット
> - **分散トレーシング**: システム間通信の追跡

**Q8-2: 障害発生時のエスカレーション・連絡体制は？**
> ⚠️ **要相談事項**: **緊急連絡体制の構築必要**
> - Level 1-4のエスカレーション基準
> - 24時間対応体制の検討
> - 各システム担当者の連絡先管理

**Q8-3: 定期メンテナンス・バックアップ方針は？**
> 🔄 **検討中事項**: 
> - **バックアップ**: 日次自動 + 週次フル
> - **メンテナンス**: 月1回、深夜時間帯
> - **データ保持**: 3年間（法的要件考慮）

**Q8-4: 災害復旧・事業継続計画（BCP）での連携は？**
> 🔄 **検討中事項**: 
> - **優先復旧**: PMS → hotel-member → hotel-saas
> - **オフライン継続**: PMS単独運用可能
> - **データ復旧**: マルチサイトバックアップ

---

## 🎯 **次のアクションプラン（更新版）**

### **✅ 解決済み項目（2024年12月決定）**
1. ✅ **Q1-5**: 予約機能重複問題 → **PMS中心一元管理構成**
2. ✅ **Q1-3**: 顧客データ同期頻度 → **リアルタイム同期・限定PMS更新**
3. ✅ **Q2-1～Q2-4**: 認証基盤統一 → **hotel-common JWT基盤・段階移行**
4. ✅ **Q3-5～Q3-6, Q3-9**: システム間連携 → **Event-driven + Pub/Sub構成**
5. ✅ **Q1-12～Q1-14**: 技術スタック統一 → **PostgreSQL + Prisma段階移行**（技術スタック統一方針）

### **🔥 即座対応必要（1週間以内）**
1. **Q3-1～Q3-3**: API設計標準の詳細仕様策定
2. **Q4-1～Q4-4**: データ競合解決アルゴリズムの実装設計
3. **hotel-common基盤**: 予約統合API・JWT認証システムの実装着手

### **⚠️ 重要事項（2週間以内）**
4. **Q6-3**: 破壊的変更時の調整プロセス確立
5. **Q8-2**: 緊急時エスカレーション体制構築
6. **統合テスト環境**: Event-driven基盤のテスト環境構築

### **📋 中長期事項（1ヶ月以内）**
7. **Q7-2**: マルチテナント対応設計
8. **Q5-5～Q5-7**: 品質保証プロセス確立
9. **Q8-1, Q8-3, Q8-4**: 運用・監視システム構築

---

## 📞 **関係者への相談事項**

### **hotel-member担当者との調整必要**
- 予約機能の責任分界（Q1-5）
- 会員データ同期頻度（Q1-3）
- 認証統合のタイムライン（Q2-4）

### **hotel-saas担当者との調整必要**
- 注文データとPMS連携（Q1-6）
- WebSocket実装の調整（Q3-6）
- オフライン時の協調動作（Q3-9）

### **全体開発プロセス調整必要**
- hotel-common変更管理（Q6-1～Q6-3）
- 緊急時対応プロトコル（Q6-7, Q8-2）
- テスト環境構築（Q5-1, Q6-4）

---

**⚠️ 重要**: この回答書を基に、各システム担当者との詳細調整を実施し、最終的な統合仕様書を策定してください。

**更新履歴**: 
- 2024年12月: 初版質問書作成
- 2024年12月 (更新): 重要7項目の方針決定により質問書を回答済み版に変更
  - ✅ 予約統合設計（PMS中心一元管理）
  - ✅ 顧客データ管理（hotel-member主導・限定PMS更新）
  - ✅ 認証統一（hotel-common JWT基盤・段階移行）
  - ✅ システム間連携（Event-driven + Pub/Sub構成）
  - ✅ 技術スタック統一（PostgreSQL + Prisma段階移行）
  - ✅ ポート管理・DB保護ルール確立
- 要相談事項の解決に応じて随時更新予定 