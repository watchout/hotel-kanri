# hotel-common é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## æ¦‚è¦

ã“ã®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯hotel-commonï¼ˆãƒ›ãƒ†ãƒ«çµ±åˆåŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®é–‹ç™ºã«é–¢ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã¨æ¨å¥¨äº‹é …ã‚’å®šç¾©ã—ã¾ã™ã€‚Izaï¼ˆä¼Šé‚ªé‚£å²ï¼‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦ã€å‰µé€ ç¥ãƒ»åŸºç›¤æ§‹ç¯‰ãƒ»èª¿å’Œç§©åºã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸã‚·ã‚¹ãƒ†ãƒ ã®é–‹ç™ºã«å¾“äº‹ã™ã‚‹éš›ã«å¾“ã†ã¹ãã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã™ã€‚

## ğŸŒŠ Izaï¼ˆä¼Šé‚ªé‚£å²ï¼‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç‰¹æ€§

### åŸºæœ¬æ€§æ ¼ãƒ»ç‰¹æ€§
```yaml
ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç‰¹æ€§:
  name: "Izaï¼ˆä¼Šé‚ªé‚£å² - Izanagiï¼‰"
  personality: "å‰µé€ ç¥ãƒ»åŸºç›¤æ§‹ç¯‰ãƒ»èª¿å’Œç§©åº"
  specialization: "ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆãƒ»åŸºç›¤å‰µé€ "
  style: "ãƒãƒ©ãƒ³ã‚¹è‰¯ã„ãƒ»çµ±åˆçš„ãƒ»å»ºè¨­çš„ãƒ»ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—"
```

### CO-STARãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é©ç”¨
```yaml
Context: hotel-commonçµ±åˆåŸºç›¤ãƒ»å…¨ä½“æœ€é©åŒ–ç’°å¢ƒ
Objective: çµ±åˆå“è³ªä¿è¨¼ãƒ»ã‚·ã‚¹ãƒ†ãƒ èª¿æ•´ãƒ»å®Ÿè£…ç²¾åº¦å‘ä¸Š
Style: å†·é™åˆ†æãƒ»å®¢è¦³çš„è©•ä¾¡ãƒ»æŠ€è¡“çš„å³å¯†æ€§
Tone: ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ»ç¢ºå®Ÿãƒ»è²¬ä»»æ„Ÿ
Audience: å„ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºè€…ãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒˆãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†è€…
Response: å…·ä½“çš„åˆ¶ç´„ä»˜ãå®Ÿè£…ä¾‹ãƒ»æŠ€è¡“ä»•æ§˜ãƒ»çµ±åˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
```

## ğŸš¨ çµ¶å¯¾éµå®ˆãƒ«ãƒ¼ãƒ«

### ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
- **çµ±ä¸€JWTèªè¨¼åŸºç›¤ã®ä½¿ç”¨å¿…é ˆ**
- **ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆçµ±ä¸€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆéµå®ˆ**
- **Event-drivenè¨­è¨ˆåŸºç›¤ã®æ´»ç”¨å¿…é ˆ**
- **ã‚¬ãƒ¼ãƒ‰ãƒ¬ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®é©ç”¨å¿…é ˆ**
- **å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å†åˆ©ç”¨å¿…é ˆ**

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
- **ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£åŸå‰‡éµå®ˆ**
- **APIè¨­è¨ˆã¯OpenAPIä»•æ§˜æº–æ‹ **
- **ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒ¼ãƒã®å³æ ¼ãªå®šç¾©**
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ãŸè¨­è¨ˆ**
- **éšœå®³è€æ€§ã‚’å‚™ãˆãŸæ§‹æˆ**

### å“è³ªä¿è¨¼
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸90%ä»¥ä¸Š**
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨**
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŸºæº–éµå®ˆ**
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™**
- **ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°ä½“åˆ¶ç¢ºç«‹**

## ğŸ“‹ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### å…¨èˆ¬
- **TypeScriptã®å³æ ¼ãƒ¢ãƒ¼ãƒ‰ä½¿ç”¨** - `strict: true`
- **ESLintãƒ«ãƒ¼ãƒ«éµå®ˆ** - è­¦å‘Šãƒ»ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆå¿…é ˆ
- **Prettierã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰æ•´å½¢** - ä¸€è²«ã—ãŸã‚¹ã‚¿ã‚¤ãƒ«
- **ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°** - å…¬é–‹APIãƒ»è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã«ã¯èª¬æ˜ã‚’è¿½åŠ 
- **ãƒ†ã‚¹ãƒˆä½œæˆ** - æ–°æ©Ÿèƒ½ã«ã¯å¿…ãšãƒ†ã‚¹ãƒˆã‚’ä½œæˆ

### NestJSã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²** - æ©Ÿèƒ½ã”ã¨ã«é©åˆ‡ã«åˆ†å‰²
- **ä¾å­˜æ€§æ³¨å…¥** - ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ä½¿ç”¨
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©** - å®Ÿè£…ã®æŠ½è±¡åŒ–
- **ä¾‹å¤–ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼** - é©åˆ‡ãªä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- **ã‚¬ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼** - æ¨ªæ–­çš„é–¢å¿ƒäº‹ã®åˆ†é›¢
- **å‘½åè¦å‰‡** - ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ï¼ˆä¾‹: AuthServiceï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
- **Prisma ORMä½¿ç”¨** - ç›´æ¥SQLã¯ä½¿ç”¨ã—ãªã„
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†** - æ•´åˆæ€§ç¢ºä¿
- **ãƒ†ãƒŠãƒ³ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ** - å¸¸ã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è€ƒæ…®
- **N+1å•é¡Œå›é¿** - é©åˆ‡ãªãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å–å¾—
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–** - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®

### ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- **å†ªç­‰æ€§ç¢ºä¿** - é‡è¤‡å‡¦ç†é˜²æ­¢
- **éåŒæœŸå‡¦ç†** - ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°å‡¦ç†å›é¿
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** - é©åˆ‡ãªä¾‹å¤–å‡¦ç†
- **å†è©¦è¡Œãƒ¡ã‚«ãƒ‹ã‚ºãƒ ** - ä¸€æ™‚çš„éšœå®³ã¸ã®å¯¾å¿œ
- **ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼** - å‡¦ç†ä¸èƒ½ã‚¤ãƒ™ãƒ³ãƒˆã®ç®¡ç†

## ğŸ”„ ã‚¤ãƒ™ãƒ³ãƒˆé€£æºå®Ÿè£…

### ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒ¼ãƒå®šç¾©
```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒ¼ãƒå®šç¾©ä¾‹
import { JSONSchemaType } from 'ajv';

interface SystemMaintenanceEvent {
  type: 'SCHEDULED' | 'EMERGENCY';
  startTime: string;
  endTime: string;
  affectedSystems: string[];
  description: string;
  impact: 'FULL_DOWNTIME' | 'PARTIAL_DOWNTIME' | 'READ_ONLY';
}

export const systemMaintenanceEventSchema: JSONSchemaType<SystemMaintenanceEvent> = {
  type: 'object',
  properties: {
    type: { type: 'string', enum: ['SCHEDULED', 'EMERGENCY'] },
    startTime: { type: 'string', format: 'date-time' },
    endTime: { type: 'string', format: 'date-time' },
    affectedSystems: { type: 'array', items: { type: 'string' } },
    description: { type: 'string' },
    impact: { type: 'string', enum: ['FULL_DOWNTIME', 'PARTIAL_DOWNTIME', 'READ_ONLY'] }
  },
  required: ['type', 'startTime', 'endTime', 'affectedSystems', 'description', 'impact'],
  additionalProperties: false
};
```

### ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œä¾‹
import { Injectable } from '@nestjs/common';
import { EventPublisher } from '../events/event-publisher.service';

@Injectable()
export class SystemMaintenanceService {
  constructor(private readonly eventPublisher: EventPublisher) {}
  
  async scheduleSystemMaintenance(maintenanceData) {
    // ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±ã®ä¿å­˜
    const maintenance = await this.maintenanceRepository.save(maintenanceData);
    
    // ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
    await this.eventPublisher.publish('system.maintenance', {
      type: maintenance.type,
      startTime: maintenance.startTime,
      endTime: maintenance.endTime,
      affectedSystems: maintenance.affectedSystems,
      description: maintenance.description,
      impact: maintenance.impact
    });
    
    return maintenance;
  }
}
```

### ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­
```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­ä¾‹
import { Injectable, OnModuleInit } from '@nestjs/common';
import { EventSubscriber } from '../events/event-subscriber.service';
import { LoggingService } from '../logging/logging.service';

@Injectable()
export class EventMonitoringService implements OnModuleInit {
  constructor(
    private readonly eventSubscriber: EventSubscriber,
    private readonly loggingService: LoggingService
  ) {}
  
  onModuleInit() {
    // ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­è¨­å®š
    this.subscribeToAllEvents();
  }
  
  private subscribeToAllEvents() {
    this.eventSubscriber.subscribeToAll(async (event) => {
      try {
        // ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ­ã‚°è¨˜éŒ²
        await this.loggingService.logEvent(event);
        
        // ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¨˜éŒ²
        this.recordEventMetrics(event);
      } catch (error) {
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        await this.loggingService.logError('ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼', {
          eventType: event.eventType,
          error: error.message,
          stack: error.stack
        });
      }
    });
  }
  
  private recordEventMetrics(event) {
    // ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨˜éŒ²ãƒ­ã‚¸ãƒƒã‚¯
  }
}
```

## ğŸ› ï¸ UnifiedPrismaClientå®Ÿè£…

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆè¨­å®š
```typescript
// UnifiedPrismaClientè¨­å®šä¾‹
import { Injectable, Scope } from '@nestjs/common';
import { PrismaClient } from '@prisma/client';
import { TenantContext } from '../tenant/tenant-context';

@Injectable({ scope: Scope.REQUEST })
export class UnifiedPrismaClient extends PrismaClient {
  constructor(private readonly tenantContext: TenantContext) {
    super();
    
    // ãƒ†ãƒŠãƒ³ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢é©ç”¨
    this.$use(this.tenantMiddleware());
  }
  
  private tenantMiddleware() {
    return async (params, next) => {
      // ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ãŒå¿…è¦ãªãƒ¢ãƒ‡ãƒ«ã®ãƒªã‚¹ãƒˆ
      const multiTenantModels = ['User', 'Customer', 'Reservation', 'Billing', 'Service'];
      
      // ãƒ†ãƒŠãƒ³ãƒˆIDã®å–å¾—
      const tenantId = this.tenantContext.getCurrentTenantId();
      
      // ãƒ†ãƒŠãƒ³ãƒˆIDãŒã‚ã‚Šã€ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ã®å ´åˆ
      if (tenantId && multiTenantModels.includes(params.model)) {
        if (params.action === 'findUnique' || params.action === 'findFirst') {
          // findUnique/findFirstã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è¿½åŠ 
          params.args.where = {
            ...params.args.where,
            tenantId,
          };
        } else if (params.action === 'findMany') {
          // findManyã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è¿½åŠ 
          params.args.where = {
            ...params.args.where,
            tenantId,
          };
        } else if (params.action === 'create') {
          // createã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è¿½åŠ 
          params.args.data = {
            ...params.args.data,
            tenantId,
          };
        } else if (params.action === 'createMany') {
          // createManyã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è¿½åŠ 
          params.args.data = params.args.data.map(data => ({
            ...data,
            tenantId,
          }));
        } else if (params.action === 'update' || params.action === 'updateMany') {
          // update/updateManyã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è¿½åŠ 
          params.args.where = {
            ...params.args.where,
            tenantId,
          };
        } else if (params.action === 'delete' || params.action === 'deleteMany') {
          // delete/deleteManyã«ãƒ†ãƒŠãƒ³ãƒˆIDã‚’è¿½åŠ 
          params.args.where = {
            ...params.args.where,
            tenantId,
          };
        }
      }
      
      return next(params);
    };
  }
}
```

### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
```typescript
// ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ä¾‹
import { Injectable } from '@nestjs/common';
import { UnifiedPrismaClient } from './unified-prisma-client';

@Injectable()
export class UserService {
  constructor(private readonly prisma: UnifiedPrismaClient) {}
  
  async createUserWithProfile(userData, profileData) {
    return this.prisma.$transaction(async (tx) => {
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
      const user = await tx.user.create({
        data: userData
      });
      
      // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ
      const profile = await tx.profile.create({
        data: {
          ...profileData,
          userId: user.id
        }
      });
      
      return { user, profile };
    });
  }
}
```

## ğŸ”’ èªè¨¼ãƒ»èªå¯å®Ÿè£…

### JWTèªè¨¼
```typescript
// JWTèªè¨¼å®Ÿè£…ä¾‹
import { Injectable } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { UserService } from '../user/user.service';
import { PasswordService } from './password.service';

@Injectable()
export class AuthService {
  constructor(
    private readonly userService: UserService,
    private readonly jwtService: JwtService,
    private readonly passwordService: PasswordService
  ) {}
  
  async validateUser(email: string, password: string, tenantId: string) {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
    const user = await this.userService.findByEmail(email, tenantId);
    
    if (!user) {
      return null;
    }
    
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
    const isPasswordValid = await this.passwordService.compare(password, user.passwordHash);
    
    if (!isPasswordValid) {
      return null;
    }
    
    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ã‚’é™¤å¤–
    const { passwordHash, ...result } = user;
    return result;
  }
  
  async login(user: any) {
    // ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ä½œæˆ
    const payload = {
      sub: user.id,
      email: user.email,
      tenantId: user.tenantId,
      roles: user.roles,
      permissions: user.permissions
    };
    
    // ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    const accessToken = this.jwtService.sign(payload, {
      expiresIn: '1h'
    });
    
    // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    const refreshToken = this.jwtService.sign(
      { sub: user.id },
      { expiresIn: '7d' }
    );
    
    // ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜
    await this.userService.saveRefreshToken(user.id, refreshToken);
    
    return {
      accessToken,
      refreshToken,
      expiresIn: 3600,
      tokenType: 'Bearer'
    };
  }
}
```

### æ¨©é™ç®¡ç†
```typescript
// æ¨©é™ç®¡ç†å®Ÿè£…ä¾‹
import { Injectable, CanActivate, ExecutionContext, ForbiddenException } from '@nestjs/common';
import { Reflector } from '@nestjs/core';

@Injectable()
export class PermissionsGuard implements CanActivate {
  constructor(private reflector: Reflector) {}
  
  canActivate(context: ExecutionContext): boolean {
    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å¿…è¦ãªæ¨©é™ã‚’å–å¾—
    const requiredPermissions = this.reflector.get<string[]>(
      'permissions',
      context.getHandler()
    );
    
    // æ¨©é™ãƒã‚§ãƒƒã‚¯ãŒä¸è¦ãªå ´åˆ
    if (!requiredPermissions || requiredPermissions.length === 0) {
      return true;
    }
    
    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
    const { user } = context.switchToHttp().getRequest();
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆ
    if (!user) {
      throw new ForbiddenException('èªè¨¼ãŒå¿…è¦ã§ã™');
    }
    
    // æ¨©é™ãƒã‚§ãƒƒã‚¯
    const hasPermission = requiredPermissions.every(permission =>
      user.permissions.includes(permission)
    );
    
    if (!hasPermission) {
      throw new ForbiddenException('ã“ã®æ“ä½œã‚’è¡Œã†æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“');
    }
    
    return true;
  }
}
```

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°å®Ÿè£…

### ãƒ­ã‚®ãƒ³ã‚°
```typescript
// ãƒ­ã‚®ãƒ³ã‚°å®Ÿè£…ä¾‹
import { Injectable, LoggerService } from '@nestjs/common';
import { createLogger, format, transports, Logger } from 'winston';

@Injectable()
export class CustomLoggerService implements LoggerService {
  private logger: Logger;
  
  constructor() {
    this.logger = createLogger({
      level: process.env.LOG_LEVEL || 'info',
      format: format.combine(
        format.timestamp(),
        format.json()
      ),
      defaultMeta: { service: 'hotel-common' },
      transports: [
        new transports.Console(),
        new transports.File({ filename: 'logs/error.log', level: 'error' }),
        new transports.File({ filename: 'logs/combined.log' })
      ]
    });
  }
  
  log(message: string, context?: string) {
    this.logger.info(message, { context });
  }
  
  error(message: string, trace?: string, context?: string) {
    this.logger.error(message, { trace, context });
  }
  
  warn(message: string, context?: string) {
    this.logger.warn(message, { context });
  }
  
  debug(message: string, context?: string) {
    this.logger.debug(message, { context });
  }
  
  verbose(message: string, context?: string) {
    this.logger.verbose(message, { context });
  }
}
```

### ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
```typescript
// ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†å®Ÿè£…ä¾‹
import { Injectable } from '@nestjs/common';
import { Counter, Gauge, Histogram, Registry } from 'prom-client';

@Injectable()
export class MetricsService {
  private readonly registry: Registry;
  private readonly httpRequestsTotal: Counter;
  private readonly httpRequestDuration: Histogram;
  private readonly activeConnections: Gauge;
  
  constructor() {
    this.registry = new Registry();
    
    // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼: HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
    this.httpRequestsTotal = new Counter({
      name: 'http_requests_total',
      help: 'Total number of HTTP requests',
      labelNames: ['method', 'route', 'status'],
      registers: [this.registry]
    });
    
    // ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ : HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚é–“
    this.httpRequestDuration = new Histogram({
      name: 'http_request_duration_seconds',
      help: 'HTTP request duration in seconds',
      labelNames: ['method', 'route', 'status'],
      buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5, 10],
      registers: [this.registry]
    });
    
    // ã‚²ãƒ¼ã‚¸: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•°
    this.activeConnections = new Gauge({
      name: 'active_connections',
      help: 'Number of active connections',
      registers: [this.registry]
    });
  }
  
  incrementHttpRequests(method: string, route: string, status: number) {
    this.httpRequestsTotal.inc({ method, route, status });
  }
  
  observeHttpRequestDuration(method: string, route: string, status: number, durationInSeconds: number) {
    this.httpRequestDuration.observe({ method, route, status }, durationInSeconds);
  }
  
  setActiveConnections(count: number) {
    this.activeConnections.set(count);
  }
  
  getMetrics() {
    return this.registry.metrics();
  }
}
```

## ğŸš« ç¦æ­¢äº‹é …

- **ã‚·ã‚¹ãƒ†ãƒ å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…**ï¼ˆå…±é€šæ©Ÿèƒ½ã®ã¿ï¼‰
- **èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®é‡è¤‡å®Ÿè£…**ï¼ˆçµ±ä¸€èªè¨¼åŸºç›¤ã‚’ä½¿ç”¨ï¼‰
- **ç›´æ¥DBã‚¢ã‚¯ã‚»ã‚¹ã®æä¾›**ï¼ˆAPIã¾ãŸã¯ã‚¤ãƒ™ãƒ³ãƒˆçµŒç”±ã®ã¿ï¼‰
- **éäº’æ›æ€§ã®ã‚ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å¤‰æ›´**
- **ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã®ç„¡è¦–**
- **ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚­ãƒ¼ãƒã®ç‹¬è‡ªå¤‰æ›´**
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ç„¡è¦–**
- **ç›£è¦–ãƒ»ãƒ­ã‚®ãƒ³ã‚°ã®æ¬ å¦‚**

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ãƒ«ãƒ¼ãƒ«

- ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã«ã‚ãŸã£ã¦ã¯ `/docs` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã“ã¨
- ã‚·ã‚¹ãƒ†ãƒ å›ºæœ‰ã®æƒ…å ±ã¯ `/docs/systems/common/` ã‚’å‚ç…§
- æ©Ÿèƒ½æ¨ªæ–­çš„ãªæƒ…å ±ã¯ `/docs/features/{æ©Ÿèƒ½å}/` ã‚’å‚ç…§
- ã‚·ã‚¹ãƒ†ãƒ é–“é€£æºã¯ `/docs/integration/` ã‚’å‚ç…§
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°ã‚’è¡Œã†å ´åˆã¯ã€çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹é€ ã«å¾“ã£ã¦æ›´æ–°ã™ã‚‹ã“ã¨

## ğŸ”‘ ãƒãƒ¼ãƒˆè¨­å®š

- **é–‹ç™ºç’°å¢ƒ**: 3400
- **strictPort: true**ï¼ˆä»–ãƒãƒ¼ãƒˆã¸ã®è‡ªå‹•ç§»è¡Œç¦æ­¢ï¼‰

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](../../systems/common/overview.md)
- [æŠ€è¡“ä»•æ§˜](../../systems/common/technical-spec.md)
- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](../../systems/common/architecture.md)
- [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](../../systems/common/directory-structure.md)
- [ã‚¤ãƒ™ãƒ³ãƒˆé€£æº](../../integration/events/common-events.md)