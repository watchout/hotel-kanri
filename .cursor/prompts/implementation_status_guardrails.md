# 🛡️ 実装状況管理ガードレール

**作成日**: 2025年10月9日  
**目的**: 実装完了の判断基準を統一し、バージョン管理を確実にする

---

## 🎯 基本原則

### 原則1: 実装状況はSSOT内で管理

**唯一の記録場所**:
```
各SSOTファイル内の「実装状況」セクション
```

❌ **禁止事項**:
- 別ファイルで実装状況を管理する
- 実装レポートファイルを作成する
- README.mdに実装状況を書く

✅ **正しい対応**:
- SSOTファイル内の「実装状況」セクションを更新
- SSOT_PROGRESS_MASTER.md にはサマリーのみ記録

---

## 📊 実装完了の判断基準

### ✅ 完全実装（100%）

以下の**全て**を満たす場合のみ「完全実装」とする：

#### 1. データベース実装（Phase 1）
- [ ] PrismaスキーマがSSOT通りに実装されている
- [ ] テーブル・カラム名がSSOT通り（snake_case + @map）
- [ ] インデックスがSSOT通りに設定されている
- [ ] マイグレーションが正常に実行できる
- [ ] tenant_id による分離が実装されている

#### 2. API実装（Phase 2）
- [ ] 全エンドポイントが実装されている
- [ ] リクエスト・レスポンス形式がSSOT通り
- [ ] エラーハンドリングが実装されている
- [ ] 認証チェックが実装されている
- [ ] テナント分離が実装されている

#### 3. フロントエンド実装（Phase 3）
- [ ] 全ページ・画面が実装されている
- [ ] Composableが実装されている
- [ ] UIがSSOT通りに動作する
- [ ] エラーハンドリングが実装されている
- [ ] ローディング状態が実装されている

#### 4. テスト（Phase 4）
- [ ] 単体テストが実装されている
- [ ] 統合テストが実装されている
- [ ] E2Eテストが実装されている
- [ ] 全テストがパスする

#### 5. SSOT準拠確認（Phase 5）
- [ ] 実際にSSOT通りに動作することを確認
- [ ] 本番同等性を確認（環境分岐なし）
- [ ] マルチテナント分離を確認
- [ ] セキュリティ要件を確認

---

### 🟢 部分実装（1-99%）

**定義**: Phase 1-5 のうち一部が完了している状態

**完了率の計算**:
```
完了率 = (完了Phase数 / 5) × 100%
```

**例**:
- Phase 1-2完了、Phase 3-5未完了 → **40% (2/5)**
- Phase 1-3完了、Phase 4-5未完了 → **60% (3/5)**
- Phase 1-4完了、Phase 5未完了 → **80% (4/5)**

---

### ❌ 未実装（0%）

**定義**: 全Phase が未着手

---

## 🔄 バージョン管理ルール

### バージョンアップ時の対応

**例**: SSOT v1.0.0 → v1.1.0 に更新

#### Step 1: SSOTを更新
```markdown
**バージョン**: 1.1.0  
**最終更新**: 2025-10-09
```

#### Step 2: 実装状況セクションに新バージョンを追加
```markdown
### hotel-saas 実装状況

| バージョン | 状態 | 完了率 | 完了日 | 備考 |
|-----------|-----|--------|--------|------|
| v1.0.0 | ✅ | 100% | 2025-10-03 | 完了 |
| v1.1.0 | ❌ | 0% | - | **要対応** |

**実装チェックリスト（v1.1.0）**:
- [ ] Phase 1: データベース設計（追加カラム対応）
- [ ] Phase 2: API実装（新エンドポイント追加）
- [ ] Phase 3: フロントエンド実装（新機能追加）
- [ ] Phase 4: テスト
- [ ] Phase 5: デプロイ・動作確認
```

#### Step 3: 実装作業を進める
- チェックリストを更新しながら進める
- 完了したPhaseは ✅ にする

#### Step 4: 完了時に状態を更新
```markdown
| v1.1.0 | ✅ | 100% | 2025-10-15 | 完了 |
```

#### Step 5: SSOT_PROGRESS_MASTER.md を更新
```markdown
| SSOT_ADMIN_AI_CONCIERGE.md | ✅ v1.1.0 | ✅ 100% | ⭕ 0% |
```

---

## 📝 実装状況の記録方法

### テンプレート

```markdown
## 📊 実装状況

### 実装完了の定義

✅ **完了（100%）**: 以下の全てを満たす
- [ ] データベース実装完了
- [ ] API実装完了
- [ ] フロントエンド実装完了
- [ ] テスト完了
- [ ] SSOT準拠確認

🟢 **部分実装（1-99%）**: 一部のPhaseが完了

❌ **未実装（0%）**: 未着手

---

### hotel-saas 実装状況

| バージョン | 状態 | 完了率 | 完了日 | 担当 | 備考 |
|-----------|-----|--------|--------|------|------|
| v1.0.0 | ✅ | 100% (5/5) | 2025-10-03 | Sun | 完了 |
| v1.1.0 | 🟡 | 60% (3/5) | - | Sun | Phase 3まで完了 |

**実装チェックリスト（v1.1.0）**:
- [x] Phase 1: データベース設計
- [x] Phase 2: API実装
- [x] Phase 3: フロントエンド実装
- [ ] Phase 4: テスト
- [ ] Phase 5: デプロイ・動作確認

**詳細**:
- **Phase 1**: 2025-10-10完了 - 新テーブル追加
- **Phase 2**: 2025-10-11完了 - 新エンドポイント実装
- **Phase 3**: 2025-10-12完了 - UI実装
- **Phase 4**: 未着手
- **Phase 5**: 未着手

---

### hotel-common 実装状況

| バージョン | 状態 | 完了率 | 完了日 | 担当 | 備考 |
|-----------|-----|--------|--------|------|------|
| v1.0.0 | ⭕ | 0% (0/5) | - | Iza | 実装予定 |
```

---

## 🚨 禁止パターン

### パターン1: 実装レポートファイルの作成

```
❌ 禁止:
- SSOT_ADMIN_AI_CONCIERGE_IMPLEMENTATION_REPORT.md
- SSOT_ADMIN_AI_CONCIERGE_IMPL_STATUS.md
- implementation_reports/
```

**理由**: ファイル乱立、更新漏れ、整合性維持困難

**正しい対応**: SSOTファイル内の「実装状況」セクションを更新

---

### パターン2: 曖昧な判断

```
❌ 禁止:
「だいたい動いてるから完全実装でいいか」
「テストはないけど動作確認したから100%」
```

**正しい対応**: 5つのPhase全てを完了してから100%にする

---

### パターン3: バージョン管理の欠如

```
❌ 禁止:
| hotel-saas | ✅ 完了 | ← どのバージョン？
```

**正しい対応**: 必ずバージョンを記録
```
| v1.1.0 | ✅ | 100% | 2025-10-15 | 完了 |
```

---

## ✅ AI自己チェックリスト

実装状況を更新する前に確認：

- [ ] SSOTファイル内の「実装状況」セクションを更新しているか？
- [ ] バージョン番号を記録しているか？
- [ ] 完了率（X/5）を正確に計算しているか？
- [ ] チェックリストを更新しているか？
- [ ] 100%にする場合、5つのPhase全てが完了しているか？
- [ ] SSOT_PROGRESS_MASTER.md のサマリーも更新したか？

**1つでも「いいえ」がある場合**: 更新を見直す

---

## 📋 更新ワークフロー

### 実装開始時

1. SSOTファイルを開く
2. 「実装状況」セクションに移動
3. 該当バージョンの状態を「🟡 進行中」に変更
4. チェックリストを確認

### Phase完了時

1. チェックリストの該当Phaseを ✅ にする
2. 完了率を更新（例: 1/5 → 2/5）
3. 詳細欄に完了日と内容を記録

### 全Phase完了時

1. 状態を「✅ 完了」に変更
2. 完了率を「100% (5/5)」に更新
3. 完了日を記録
4. SSOT_PROGRESS_MASTER.md を更新

---

## 🔍 実装調査ワークフロー

### 基本方針

**段階的調査・記録方式を採用**:
- ✅ 新規SSOT: 「未実装（0%）」でスタート
- ✅ 実装指示を受けたSSO: その時点で調査→記録→実装
- ✅ 既存SSOT: 必要なタイミングで調査・記録

❌ **一括調査はしない**: 時間がかかり、情報が古くなる

---

### 実装指示を受けた際のワークフロー

#### Step 1: SSOTを確認

```markdown
1. 該当SSOTを開く
2. 実装状況セクションに移動
3. 実装状況を確認
```

#### Step 2: 状況に応じて対応

**ケース1: 実装状況が「未調査」**
```markdown
1. ユーザーに「実装調査を行います」と報告
2. 実装調査を実施（5つのPhase確認）
3. 実装状況をSSOTに記録
4. ユーザーに調査結果を報告
5. 実装方針を提案
6. 承認後に実装開始
```

**ケース2: 実装状況が記録済み（例: 60%）**
```markdown
1. ユーザーに現状を報告
   「Phase 3まで完了、Phase 4-5が未完了です」
2. 残りのPhaseの実装方針を提案
3. 承認後に実装開始
```

**ケース3: 実装状況が「100%」**
```markdown
1. ユーザーに「既に実装完了しています」と報告
2. 動作確認を実施
3. 問題があれば修正提案
```

---

### 実装調査の手順

#### Phase 1: データベース確認

```markdown
確認項目:
- [ ] Prismaスキーマにテーブルが存在するか
- [ ] カラム名がSSOT通りか（snake_case + @map）
- [ ] インデックスが設定されているか
- [ ] tenant_id による分離が実装されているか

確認方法:
- /Users/kaneko/hotel-common/prisma/schema.prisma を確認
```

#### Phase 2: API確認

```markdown
確認項目:
- [ ] hotel-common: 全エンドポイントが実装されているか
- [ ] hotel-saas: プロキシAPIが実装されているか
- [ ] リクエスト・レスポンス形式がSSOT通りか
- [ ] エラーハンドリングが実装されているか
- [ ] 認証チェックが実装されているか

確認方法:
- hotel-common: /src/routes/ 配下を確認
- hotel-saas: /server/api/ 配下を確認
```

#### Phase 3: フロントエンド確認

```markdown
確認項目:
- [ ] 全ページ・画面が実装されているか
- [ ] Composableが実装されているか
- [ ] UIがSSOT通りに動作するか
- [ ] エラーハンドリングが実装されているか

確認方法:
- hotel-saas: /pages/ 配下を確認
- hotel-saas: /composables/ 配下を確認
```

#### Phase 4: テスト確認

```markdown
確認項目:
- [ ] 単体テストが存在するか
- [ ] 統合テストが存在するか
- [ ] E2Eテストが存在するか
- [ ] 全テストがパスするか

確認方法:
- テストファイルの有無を確認
```

#### Phase 5: SSOT準拠確認

```markdown
確認項目:
- [ ] 実際にSSOT通りに動作するか
- [ ] 本番同等性が保たれているか
- [ ] マルチテナント分離が実装されているか
- [ ] セキュリティ要件が満たされているか

確認方法:
- 実際に動作確認を実施
```

---

### 調査結果の記録テンプレート

```markdown
## 📊 実装状況

### hotel-saas 実装状況

| バージョン | 状態 | 完了率 | 完了日 | 担当 | 備考 |
|-----------|-----|--------|--------|------|------|
| v1.0.0 | 🟢 | 60% (3/5) | - | Sun | Phase 3まで完了 |

**実装チェックリスト（v1.0.0）**:
- [x] Phase 1: データベース設計（部分完了）
- [x] Phase 2: API実装（部分完了）
- [x] Phase 3: フロントエンド実装（完了）
- [ ] Phase 4: テスト（未実装）
- [ ] Phase 5: SSOT準拠確認（未完了）

**詳細**:
- **Phase 1**: 部分完了 - [具体的な内容]
- **Phase 2**: 部分完了 - [具体的な内容]
- **Phase 3**: 完了 - [具体的な内容]
- **Phase 4**: 未実装 - テストコードなし
- **Phase 5**: 未完了 - SSOT通りの動作確認が必要

**課題**:
- [具体的な課題を記載]

**調査日**: YYYY-MM-DD
```

---

### ユーザーへの報告テンプレート

```markdown
[機能名]の実装状況を調査しました。

### hotel-saas
- **完了率**: XX% (X/5 Phase完了)
- **ステータス**: [完了/部分実装/未実装]

完了しているPhase:
- ✅ Phase 1: データベース設計
- ✅ Phase 2: API実装
- ✅ Phase 3: フロントエンド実装

未完了のPhase:
- ❌ Phase 4: テスト
- ❌ Phase 5: SSOT準拠確認

### hotel-common
- **完了率**: XX% (X/5 Phase完了)
- **ステータス**: [完了/部分実装/未実装]

### 実装方針
[残りのPhaseをどう実装するか提案]

実装を進めてよろしいでしょうか？
```

---

## 📝 更新履歴

| 日付 | 更新内容 | 担当 |
|------|---------|------|
| 2025-10-09 | 初版作成 | 統合管理 |
| 2025-10-09 | 実装調査ワークフロー追加 | 統合管理 |

---

**ガードレールファイル**: `/Users/kaneko/hotel-kanri/.cursor/prompts/implementation_status_guardrails.md`  
**最終更新**: 2025年10月9日

