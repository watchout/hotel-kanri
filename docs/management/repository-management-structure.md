# リポジトリ管理体制

## 概要

本ドキュメントでは、omotenasuai.comプロジェクトのリポジトリ構成、環境構成、管理フロー、権限管理について定義します。これらの管理体制は、効率的な開発プロセスと安全なコード管理を実現するためのものです。

## リポジトリ構成

### メインリポジトリ

| リポジトリ名 | 目的 | 主な内容 |
|-------------|------|---------|
| hotel-kanri | 管理・ドキュメント | プロジェクト全体の管理、設定、ドキュメント |
| hotel-common | 共通基盤 | 認証、イベント連携、APIゲートウェイ、共通ユーティリティ |
| hotel-pms | PMS | 予約管理、フロント業務、請求管理 |
| hotel-member | 会員管理 | 顧客データ管理、会員プログラム、CRM |
| hotel-saas | SaaS | 客室サービス、AIコンシェルジュ、モバイルアプリ連携 |

### サポートリポジトリ

| リポジトリ名 | 目的 | 主な内容 |
|-------------|------|---------|
| hotel-infra | インフラ管理 | IaC、デプロイスクリプト、監視設定 |
| hotel-design | デザイン | UI/UXデザイン、スタイルガイド |
| hotel-test | テスト | E2Eテスト、負荷テスト、テストデータ |

## 環境構成

### 環境の種類

| 環境名 | 目的 | アクセス制限 | 更新頻度 |
|--------|------|------------|---------|
| 開発環境（dev） | 開発者の日常的な開発作業 | 開発チームのみ | 随時（CI/CD） |
| テスト環境（test） | QA、機能テスト | 開発・QAチーム | 安定版のみ |
| ステージング環境（staging） | 本番前最終確認 | 全チーム | リリース前 |
| 本番環境（prod） | 実サービス提供 | 運用チームのみ | 計画リリースのみ |

### ブランチと環境の対応

| ブランチ | 対応環境 | 更新トリガー |
|---------|---------|------------|
| feature/* | なし | なし（ローカル開発のみ） |
| develop | 開発環境 | プッシュ時自動デプロイ |
| release/* | テスト環境 | プッシュ時自動デプロイ |
| main | ステージング環境 | マージ時自動デプロイ |
| production | 本番環境 | 手動承認後デプロイ |

## 管理フロー

### コード変更フロー

1. **機能開発**
   - feature/機能名ブランチを作成
   - 開発完了後、developブランチへのPRを作成
   - コードレビュー実施
   - レビュー承認後、developブランチにマージ

2. **リリース準備**
   - リリース時期に合わせてrelease/バージョンブランチを作成
   - QAテスト実施
   - バグ修正はrelease/バージョンブランチに直接コミット
   - テスト完了後、mainブランチとdevelopブランチへのPRを作成

3. **本番リリース**
   - mainブランチからproductionブランチへのPRを作成
   - リリース承認プロセスを実施
   - 承認後、productionブランチにマージ
   - タグ付け（vX.Y.Z）を実施

### ホットフィックスフロー

1. productionブランチからhotfix/問題内容ブランチを作成
2. 修正を実施
3. QAテスト実施
4. production、main、developブランチへのPRを作成
5. レビュー・承認後、各ブランチにマージ
6. タグ付け（vX.Y.Z+1）を実施

## 権限管理

### ロールと権限

| ロール | 対象者 | 権限 |
|--------|-------|------|
| 管理者 | プロジェクトリード、技術リード | 全リポジトリの管理権限、保護ブランチへのマージ権限 |
| 開発者 | エンジニア | 機能ブランチの作成・プッシュ、PRの作成 |
| レビュアー | シニアエンジニア | PRのレビュー・承認 |
| QA | テスターエンジニア | テスト環境へのアクセス、バグ報告 |
| デプロイ担当 | DevOpsエンジニア | 本番環境へのデプロイ権限 |

### 保護ブランチ設定

| ブランチ | 保護ルール |
|---------|-----------|
| main | PRレビュー必須（最低1名）、CIパス必須、管理者のみマージ可能 |
| production | PRレビュー必須（最低2名）、CIパス必須、管理者のみマージ可能、手動承認必須 |
| develop | PRレビュー必須（最低1名）、CIパス必須 |
| release/* | PRレビュー必須（最低1名）、CIパス必須、QA承認必須 |

## リポジトリ管理ツール

### 使用ツール

- **バージョン管理**: Git
- **リポジトリホスティング**: GitHub
- **CI/CD**: GitHub Actions
- **プロジェクト管理**: GitHub Projects
- **コードレビュー**: GitHub Pull Requests
- **ドキュメント**: Markdown + GitHub Pages

### 自動化設定

- コミット時の自動リンティング
- PRテンプレートの使用
- 自動テスト実行
- 自動ビルド検証
- コードカバレッジレポート
- 依存関係の脆弱性チェック

## バージョニング

### セマンティックバージョニング

- **メジャーバージョン（X）**: 互換性のない変更
- **マイナーバージョン（Y）**: 後方互換性のある機能追加
- **パッチバージョン（Z）**: 後方互換性のあるバグ修正

例: v1.2.3

### リリースタグ付け

```bash
# リリースタグの作成
git tag -a v1.2.3 -m "Release v1.2.3"

# タグのプッシュ
git push origin v1.2.3
```

## モノレポ vs マルチレポ

本プロジェクトでは、マルチレポジトリアプローチを採用しています。その理由は以下の通りです：

1. **明確な責任分担**: 各システムごとに独立したリポジトリにすることで、責任範囲が明確になる
2. **スケーラビリティ**: チーム規模の拡大に合わせて、リポジトリごとに担当チームを割り当てやすい
3. **デプロイの独立性**: 各システムを独立してデプロイ可能
4. **パフォーマンス**: 大規模なモノレポよりも、小規模なリポジトリの方がGit操作が高速

ただし、以下の課題に対処するための施策も実施しています：

1. **共通コードの管理**: hotel-commonリポジトリで共通コードを管理
2. **依存関係の管理**: パッケージ公開とバージョン管理
3. **クロスリポジトリの変更**: 変更影響範囲の明確な文書化と連携PRの作成

## コードレビュープロセス

### レビュー基準

- コーディング規約への準拠
- アーキテクチャ設計との整合性
- パフォーマンスとスケーラビリティ
- セキュリティ上の考慮
- テストの充実度
- ドキュメントの更新

### レビュープロセス

1. PR作成者はPRの説明、変更内容、テスト方法を記載
2. レビュアーはコメントを追加し、改善点を指摘
3. PR作成者は指摘事項に対応し、コメントに返信
4. レビュアーが承認するまで2-3を繰り返す
5. 承認後、マージ担当者がマージを実施

## 責任者

- **リポジトリ管理責任者**: [役職名]
- **コードレビュー責任者**: [役職名]
- **リリース管理責任者**: [役職名]
- **ドキュメント管理責任者**: [役職名]

## 定期的なメンテナンス

### 週次タスク

- 未解決PRのレビュー
- 長期間放置されたブランチの確認
- CIパイプラインの健全性確認

### 月次タスク

- 依存関係の更新
- セキュリティ脆弱性のチェック
- コード品質メトリクスの確認

### 四半期タスク

- リポジトリ構造の見直し
- 不要なブランチのクリーンアップ
- 管理プロセスの改善検討

---

本ドキュメントは定期的にレビューし、必要に応じて更新してください。最終更新日: 2025-09-12