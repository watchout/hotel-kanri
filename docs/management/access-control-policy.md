# アクセス制御ポリシー

## 概要

本ドキュメントでは、omotenasuai.comプロジェクトのリポジトリに対するアクセス制御ポリシーを定義します。このポリシーは、適切な権限管理によるコードの品質保護と効率的な開発プロセスの両立を目的としています。

## ロールと権限

### ロールの定義

| ロール | 説明 |
|--------|------|
| 管理者（Administrator） | プロジェクト全体の管理権限を持つ。技術リード、プロジェクトマネージャーが該当。 |
| 開発者（Developer） | コード開発を行うエンジニア。機能ブランチの作成と開発を担当。 |
| レビュアー（Reviewer） | コードレビューを担当するシニアエンジニア。PRの承認権限を持つ。 |
| QA（Quality Assurance） | テストとバグ報告を担当。テスト環境へのアクセス権を持つ。 |
| デプロイ担当（Deployer） | 本番環境へのデプロイ権限を持つDevOpsエンジニア。 |
| 閲覧者（Viewer） | リポジトリの閲覧のみ可能。外部コンサルタントや新メンバーが該当。 |

### 権限マトリックス

| 操作 | 管理者 | 開発者 | レビュアー | QA | デプロイ担当 | 閲覧者 |
|------|--------|--------|------------|-------|------------|--------|
| リポジトリ閲覧 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| Issue作成 | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| ブランチ作成 | ✅ | ✅ | ✅ | ❌ | ✅ | ❌ |
| PR作成 | ✅ | ✅ | ✅ | ❌ | ✅ | ❌ |
| PRレビュー | ✅ | ✅ | ✅ | ✅ | ✅ | ❌ |
| PR承認 | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ |
| developブランチマージ | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ |
| mainブランチマージ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| productionブランチマージ | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ |
| リポジトリ設定変更 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| Webhook管理 | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ |
| シークレット管理 | ✅ | ❌ | ❌ | ❌ | ✅ | ❌ |

## ブランチ保護ルール

### mainブランチ

- 直接プッシュ禁止
- PRによるマージのみ許可
- 最低1名のレビュー承認が必要
- CIパイプラインのパスが必要
- 管理者のみがマージ可能

### productionブランチ

- 直接プッシュ禁止
- PRによるマージのみ許可
- 最低2名のレビュー承認が必要
- CIパイプラインのパスが必要
- 手動承認プロセスが必要
- 管理者またはデプロイ担当のみがマージ可能

### developブランチ

- 直接プッシュ禁止
- PRによるマージのみ許可
- 最低1名のレビュー承認が必要
- CIパイプラインのパスが必要

### releaseブランチ

- 直接プッシュ禁止
- PRによるマージのみ許可
- 最低1名のレビュー承認が必要
- CIパイプラインのパスが必要
- QA承認が必要

## リポジトリ別アクセス設定

### hotel-kanri

| チーム/ロール | アクセスレベル |
|--------------|--------------|
| 管理者 | Admin |
| 開発者 | Write |
| レビュアー | Write |
| QA | Read |
| デプロイ担当 | Write |
| 閲覧者 | Read |

### hotel-common

| チーム/ロール | アクセスレベル |
|--------------|--------------|
| 管理者 | Admin |
| 開発者 | Write |
| レビュアー | Write |
| QA | Read |
| デプロイ担当 | Write |
| 閲覧者 | Read |

### hotel-saas

| チーム/ロール | アクセスレベル |
|--------------|--------------|
| 管理者 | Admin |
| SaaS開発チーム | Write |
| レビュアー | Write |
| QA | Read |
| デプロイ担当 | Write |
| 閲覧者 | Read |

### hotel-pms

| チーム/ロール | アクセスレベル |
|--------------|--------------|
| 管理者 | Admin |
| PMS開発チーム | Write |
| レビュアー | Write |
| QA | Read |
| デプロイ担当 | Write |
| 閲覧者 | Read |

### hotel-member

| チーム/ロール | アクセスレベル |
|--------------|--------------|
| 管理者 | Admin |
| Member開発チーム | Write |
| レビュアー | Write |
| QA | Read |
| デプロイ担当 | Write |
| 閲覧者 | Read |

## 実装手順

### GitHub設定

1. **チーム作成**
   ```
   管理者チーム
   開発者チーム
   レビュアーチーム
   QAチーム
   デプロイチーム
   閲覧者チーム
   ```

2. **ブランチ保護ルール設定**
   - Settings > Branches > Branch protection rules > Add rule
   - 各ブランチに対して上記の保護ルールを設定

3. **リポジトリ権限設定**
   - Settings > Manage access > Add teams
   - 各チームに適切な権限を付与

4. **デフォルトブランチ設定**
   - Settings > Branches > Default branch
   - `develop`をデフォルトブランチに設定

### PRテンプレート設定

`hotel-kanri/.github/PULL_REQUEST_TEMPLATE.md`を作成し、以下の内容を設定:

```markdown
## 変更内容

<!-- 変更内容の概要を記載してください -->

## 変更理由

<!-- なぜこの変更が必要なのかを記載してください -->

## テスト方法

<!-- この変更をテストする方法を記載してください -->

## スクリーンショット（必要な場合）

<!-- UIの変更がある場合はスクリーンショットを添付してください -->

## チェックリスト

- [ ] コーディング規約に準拠している
- [ ] 適切なテストが追加されている
- [ ] ドキュメントが更新されている
- [ ] リンターエラーがない
- [ ] CIパイプラインが通過している

## 関連Issue

<!-- 関連するIssueがあれば記載してください -->
```

### Issueテンプレート設定

`hotel-kanri/.github/ISSUE_TEMPLATE/`ディレクトリに以下のテンプレートを作成:

1. **機能リクエスト**
   ```markdown
   ---
   name: 機能リクエスト
   about: 新機能の提案
   title: '[FEATURE] '
   labels: enhancement
   assignees: ''
   ---

   ## 機能概要

   ## 目的・背景

   ## 提案内容

   ## 代替案

   ## その他の情報
   ```

2. **バグ報告**
   ```markdown
   ---
   name: バグ報告
   about: バグの報告
   title: '[BUG] '
   labels: bug
   assignees: ''
   ---

   ## バグ内容

   ## 再現手順

   ## 期待される動作

   ## 実際の動作

   ## 環境情報

   ## スクリーンショット
   ```

## 運用ルール

### アクセス権付与プロセス

1. チームリーダーまたはプロジェクトマネージャーが権限付与申請を行う
2. 管理者が申請を確認し承認
3. GitHubチームへのメンバー追加
4. 権限付与の通知

### アクセス権レビュープロセス

1. 四半期ごとに全アクセス権の棚卸しを実施
2. 不要なアクセス権の削除
3. 権限変更の記録

### 緊急アクセス権付与プロセス

1. 緊急時の一時的なアクセス権付与申請
2. 管理者の承認（口頭または電子メールでも可）
3. 一時的なアクセス権付与（最大72時間）
4. アクセス権の自動失効または明示的な削除

## セキュリティ考慮事項

1. **最小権限の原則**: 必要最小限の権限のみを付与
2. **定期的な監査**: アクセス権の定期的な見直し
3. **監視**: 重要なブランチへの変更は通知を設定
4. **2要素認証**: 全メンバーに2要素認証を義務付け
5. **アクセスキー管理**: 個人アクセスキーの定期的なローテーション

## 責任者

- **アクセス制御ポリシー責任者**: [役職名]
- **権限付与承認者**: [役職名]
- **監査責任者**: [役職名]

---

本ドキュメントは定期的にレビューし、必要に応じて更新してください。最終更新日: 2025-09-12