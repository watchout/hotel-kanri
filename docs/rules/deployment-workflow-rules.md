# デプロイワークフロールール

**日付**: 2023年8月17日
**作成者**: hotel-kanri

## 基本原則

1. **GitHub Actions経由のデプロイを絶対原則とする**
   - すべてのデプロイはGitHub Actions経由で行う
   - 手動デプロイは緊急時のみ、かつ事後に必ずGitHub Actionsフローを修復する

2. **短絡的解決の禁止**
   - 一時的な解決策よりも根本的な問題解決を優先する
   - デプロイ問題が発生した場合、CI/CDパイプラインの修復を最優先する

3. **問題解決の順序**
   - 問題発生時は以下の順序で対応する：
     1. GitHub Actionsのログを詳細に分析し、失敗の原因を特定
     2. 特定した問題を修正し、CI/CDパイプラインを復旧
     3. 問題の再発防止策を文書化
     4. 必要に応じてワークフローを改善

4. **デプロイ問題の分類と対応**
   - **認証問題**: SSH鍵、シークレット、権限設定の確認と修正
   - **環境問題**: Node.jsバージョン、依存関係、環境変数の確認と修正
   - **コード問題**: ビルドエラー、構文エラーの確認と修正
   - **サーバー問題**: サーバー設定、ディレクトリ権限の確認と修正

## 具体的なルール

1. **デプロイフローの一貫性**
   - ローカル開発 → GitHubリポジトリ → GitHub Actions → 開発サーバー
   - このフローを厳格に守り、ショートカットを許可しない

2. **手動デプロイの厳格な制限**
   - 手動デプロイは以下の条件をすべて満たす場合のみ許可：
     - CI/CDの修復に48時間以上かかる見込み
     - ビジネス上の緊急性がある
     - CTO/開発責任者の承認がある
     - 手動デプロイ後、必ずCI/CDの修復を行う

3. **デプロイ問題の文書化**
   - デプロイ問題が発生した場合、以下を文書化する：
     - 問題の詳細な説明
     - 原因の分析
     - 解決策
     - 再発防止策

4. **CI/CD修復の優先順位**
   - CI/CDパイプラインの問題は最優先で解決する
   - 他の開発作業よりも優先して対応する

5. **定期的なCI/CDパイプラインのテスト**
   - 週に1回、小さな変更をプッシュしてCI/CDパイプラインをテストする
   - 問題があれば即座に対応する

## 違反時の対応

1. ルール違反が発生した場合、以下の対応を行う：
   - 違反の詳細を文書化
   - 根本原因の分析
   - 再発防止策の策定
   - 必要に応じてルールの改善

2. 緊急時にルールを一時的に緩和する場合、以下の条件を満たす必要がある：
   - 開発責任者の承認
   - 緩和の期間と範囲を明確に定義
   - 通常のルールに戻るための計画を策定

## 責任者

- デプロイワークフローの監視と改善：統合管理者（Iza）
- ルール遵守の確認：各システム担当AI（Sun, Luna, Suno）
- ルールの定期的な見直し：全開発チーム
