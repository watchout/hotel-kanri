# 🔐 OWASP ASVS L2 セキュリティチェックリスト

**ドキュメントID**: SEC-ASVS-L2-001  
**バージョン**: 1.0.0  
**作成日**: 2025-10-21  
**最終更新**: 2025-10-21  
**準拠基準**: OWASP Application Security Verification Standard (ASVS) 4.0 Level 2  
**対象システム**: hotel-kanri 全システム（hotel-saas/common/pms/member）

---

## 📋 目次

1. [概要](#概要)
2. [V1: アーキテクチャ・設計・脅威モデリング](#v1-アーキテクチャ設計脅威モデリング)
3. [V2: 認証](#v2-認証)
4. [V3: セッション管理](#v3-セッション管理)
5. [V4: アクセス制御](#v4-アクセス制御)
6. [V5: 入力検証・サニタイゼーション](#v5-入力検証サニタイゼーション)
7. [V6: 暗号化](#v6-暗号化)
8. [V7: エラーハンドリング・ロギング](#v7-エラーハンドリングロギング)
9. [V8: データ保護](#v8-データ保護)
10. [V9: 通信](#v9-通信)
11. [V10: 悪意あるコード](#v10-悪意あるコード)
12. [V11: ビジネスロジック](#v11-ビジネスロジック)
13. [V12: ファイル・リソース](#v12-ファイルリソース)
14. [V13: API・Webサービス](#v13-apiwebサービス)
15. [V14: 設定](#v14-設定)

---

## 概要

### OWASP ASVS とは

**OWASP Application Security Verification Standard (ASVS)** は、Webアプリケーションのセキュリティ要件を体系的に定義した国際標準です。

### Level 2 の位置づけ

- **Level 1**: 基本的なセキュリティ（全てのアプリケーション必須）
- **Level 2**: 機密性の高いデータを扱うアプリケーション ← **hotel-kanri はここ**
- **Level 3**: 高度な防御が必要なアプリケーション（金融・医療等）

### チェック方法

- ✅ 実装済み・合格
- ⚠️ 部分的実装・要改善
- ❌ 未実装・不合格
- N/A 適用対象外

---

## V1: アーキテクチャ・設計・脅威モデリング

### V1.1 セキュアSDLC

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 1.1.1 | セキュリティ要件の文書化 | ✅ | `NFR-QAS.md`, `SSOT_*_SECURITY.md` |
| 1.1.2 | 脅威モデリングの実施 | ⚠️ | TODO: 脅威モデル作成 |
| 1.1.3 | セキュリティ設計の文書化 | ✅ | ADR, SSOT |
| 1.1.4 | コンポーネント責任の定義 | ✅ | `.cursorrules` システム境界定義 |

### V1.2 認証アーキテクチャ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 1.2.1 | 統一認証メカニズム | ✅ | Session認証（Redis + HttpOnly Cookie） |
| 1.2.2 | 強力な認証コントロール | ✅ | `SSOT_SAAS_ADMIN_AUTHENTICATION.md` |
| 1.2.3 | パスワードライフサイクル | ✅ | bcrypt, ソルトラウンド12 |

### V1.4 アクセス制御アーキテクチャ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 1.4.1 | 信頼境界の定義 | ✅ | システム境界（saas/common/pms/member） |
| 1.4.2 | 最小権限の原則 | ✅ | `SSOT_SAAS_PERMISSION_SYSTEM.md` |
| 1.4.3 | ロールベースアクセス制御 | ✅ | `roles`, `permissions` テーブル |

---

## V2: 認証

### V2.1 パスワードセキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.1.1 | パスワード最小長12文字 | ✅ | `Zod validation: z.string().min(12)` |
| 2.1.2 | パスワード最大長128文字 | ✅ | `Zod validation: z.string().max(128)` |
| 2.1.3 | 文字種混在要求なし | ✅ | NIST推奨に準拠 |
| 2.1.4 | 辞書攻撃対策 | ⚠️ | TODO: 一般的なパスワードの拒否リスト |
| 2.1.5 | パスワード変更機能 | ✅ | `PUT /api/v1/admin/staff/:id/password` |
| 2.1.6 | 侵害されたパスワードの拒否 | ❌ | TODO: Have I Been Pwned API連携 |
| 2.1.7 | パスワードヒント禁止 | ✅ | 未実装（良好） |
| 2.1.8 | パスワードの最終変更日表示 | ✅ | `staff.password_changed_at` |
| 2.1.9 | bcrypt使用（ソルトラウンド12以上） | ✅ | `bcrypt.hash(password, 12)` |
| 2.1.10 | パスワード履歴（直近使用禁止） | ❌ | TODO: パスワード履歴テーブル |

### V2.2 一般的認証セキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.2.1 | アンチオートメーション対策 | ⚠️ | TODO: レートリミット強化 |
| 2.2.2 | ブルートフォース対策 | ✅ | 5回失敗で15分ロック |
| 2.2.3 | クレデンシャルスタッフィング対策 | ⚠️ | TODO: デバイスフィンガープリント |
| 2.2.4 | 列挙攻撃対策 | ✅ | 「メールまたはパスワードが間違っています」 |
| 2.2.5 | 自動復旧メカニズム | ✅ | パスワードリセット機能 |

### V2.3 認証情報の復旧

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.3.1 | パスワードリセットトークン（ランダム） | ✅ | `crypto.randomBytes(32)` |

### V2.4 クレデンシャルストレージ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.4.1 | ソルト付きハッシュ（bcrypt） | ✅ | bcrypt使用 |
| 2.4.2 | パスワード平文保存禁止 | ✅ | `staff.password_hash` のみ |

### V2.5 クレデンシャル復旧

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.5.1 | リセットリンク有効期限（15分） | ✅ | `expires_at` 確認 |
| 2.5.2 | ワンタイムトークン | ✅ | 使用後削除 |
| 2.5.3 | パスワードリセット通知 | ✅ | メール送信 |
| 2.5.4 | ランダムURL（推測不可） | ✅ | 32バイトランダム |

### V2.7 Out of Band認証

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.7.1 | OTP有効期限（5分） | N/A | 2FA未実装 |

### V2.8 単一要素・多要素認証

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 2.8.1 | TOTP/U2F対応 | ❌ | TODO: 2FA実装 |
| 2.8.2 | 多要素認証の強制（管理者） | ❌ | TODO: 管理者2FA必須化 |

---

## V3: セッション管理

### V3.1 基本的セッション管理セキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 3.1.1 | 認証後の新セッションID発行 | ✅ | ログイン成功時に新規Session作成 |

### V3.2 セッションバインディング

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 3.2.1 | セッション無効化（ログアウト） | ✅ | `DELETE /api/v1/auth/logout` |
| 3.2.2 | 一定時間後の自動ログアウト | ✅ | 24時間（Redis TTL） |
| 3.2.3 | 非アクティブタイムアウト | ⚠️ | TODO: 30分非アクティブでログアウト |

### V3.3 Cookieベースセッション管理

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 3.3.1 | HttpOnly | ✅ | `setCookie(event, 'hotel_session', token, { httpOnly: true })` |
| 3.3.2 | SameSite=Lax | ✅ | `sameSite: 'lax'` |
| 3.3.3 | Secure（HTTPS） | ✅ | 本番環境で `secure: true` |
| 3.3.4 | Path属性 | ✅ | `path: '/'` |

### V3.4 トークンベースセッション管理

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 3.4.1 | トークン無効化（ログアウト） | ✅ | Redis削除 |
| 3.4.2 | リフレッシュトークン | N/A | Session認証（JWT不使用） |
| 3.4.3 | トークン有効期限 | ✅ | 24時間（Redis TTL） |

---

## V4: アクセス制御

### V4.1 一般的アクセス制御設計

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 4.1.1 | デフォルト拒否 | ✅ | 認証チェック必須 |
| 4.1.2 | 安全な参照（IDOR対策） | ✅ | `tenant_id`フィルタ必須 |
| 4.1.3 | 最小権限の原則 | ✅ | ロール・権限システム |
| 4.1.4 | アクセス制御の一元管理 | ✅ | `hotel-common`で権限チェック |
| 4.1.5 | 属性ベースアクセス制御 | ✅ | `tenant_id`, `role`, `permissions` |

### V4.2 オペレーションレベルアクセス制御

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 4.2.1 | センシティブデータへのアクセス記録 | ⚠️ | TODO: アクセスログ強化 |
| 4.2.2 | 低価値リソースへのアクセス制御 | ✅ | 全APIで認証必須 |

### V4.3 他のアクセス制御

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 4.3.1 | 管理インターフェースの分離 | ✅ | `/admin/*` パス分離 |
| 4.3.2 | クロステナントアクセス禁止 | ✅ | 全クエリに`tenant_id`フィルタ |

---

## V5: 入力検証・サニタイゼーション

### V5.1 入力検証

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 5.1.1 | ホワイトリスト検証 | ✅ | Zodスキーマ定義 |
| 5.1.2 | 強い型付け | ✅ | TypeScript strict mode |
| 5.1.3 | 最大長・最小長検証 | ✅ | Zod: `z.string().min().max()` |
| 5.1.4 | 数値範囲検証 | ✅ | Zod: `z.number().min().max()` |
| 5.1.5 | 日付形式検証 | ✅ | Zod: `z.coerce.date()` |

### V5.2 サニタイゼーション・サンドボックス化

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 5.2.1 | HTMLコンテキストエスケープ | ✅ | Vue 3自動エスケープ |
| 5.2.2 | JavaScriptコンテキストエスケープ | ✅ | Vue 3 + CSP |
| 5.2.3 | SQLインジェクション対策 | ✅ | Prisma（プレースホルダー） |
| 5.2.4 | OSコマンドインジェクション対策 | ✅ | コマンド実行なし |
| 5.2.5 | XPath/XMLインジェクション対策 | N/A | XML未使用 |
| 5.2.6 | SSRF対策 | ⚠️ | TODO: URL検証強化 |
| 5.2.7 | LDAPインジェクション対策 | N/A | LDAP未使用 |
| 5.2.8 | NoSQLインジェクション対策 | N/A | PostgreSQLのみ |

### V5.3 出力エンコーディング・インジェクション防止

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 5.3.1 | 文脈に応じたエスケープ | ✅ | Vue 3自動エスケープ |
| 5.3.2 | XSS対策 | ✅ | CSP, エスケープ |
| 5.3.3 | テンプレートインジェクション対策 | ✅ | Vue 3安全なテンプレート |
| 5.3.4 | SSTI対策 | ✅ | サーバーサイドテンプレート未使用 |
| 5.3.5 | XPath対策 | N/A | XPath未使用 |
| 5.3.6 | XXE対策 | N/A | XML未使用 |
| 5.3.7 | JSON出力エンコーディング | ✅ | `JSON.stringify`使用 |
| 5.3.8 | データベース出力エンコーディング | ✅ | Prisma型安全 |
| 5.3.9 | OSコマンド出力エンコーディング | N/A | コマンド実行なし |
| 5.3.10 | XXE対策 | N/A | XML未使用 |

### V5.4 メモリ・文字列・非管理コード

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 5.4.1 | バッファオーバーフロー対策 | ✅ | Node.js（メモリ安全） |
| 5.4.2 | フォーマット文字列攻撃対策 | ✅ | パラメータ化クエリ |
| 5.4.3 | 整数オーバーフロー対策 | ✅ | JavaScript（BigInt使用） |

### V5.5 逆シリアル化防止

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 5.5.1 | 信頼できないデータの逆シリアル化禁止 | ✅ | `JSON.parse`のみ使用 |
| 5.5.2 | 整合性チェック | ✅ | Zodスキーマ検証 |

---

## V6: 暗号化

### V6.1 データ分類

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 6.1.1 | データ分類（Public/Private/Sensitive） | ⚠️ | TODO: データ分類表作成 |
| 6.1.2 | PII識別 | ⚠️ | TODO: PIIフィールドのマッピング |

### V6.2 暗号アルゴリズム

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 6.2.1 | 承認された暗号のみ使用 | ✅ | bcrypt, AES-256-CBC |
| 6.2.2 | 初期化ベクトル（IV）のランダム生成 | ✅ | `crypto.randomBytes(16)` |
| 6.2.3 | ブロック暗号モード（CBC/GCM） | ✅ | AES-256-CBC |
| 6.2.4 | 鍵管理（環境変数） | ✅ | `process.env.ENCRYPTION_KEY` |
| 6.2.5 | 安全な乱数生成器 | ✅ | `crypto.randomBytes` |
| 6.2.6 | パスワードハッシュ（bcrypt） | ✅ | ソルトラウンド12 |

### V6.3 ランダム値

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 6.3.1 | CSPRNG使用 | ✅ | `crypto.randomBytes` |
| 6.3.2 | ランダムGUID/UUID | ✅ | `cuid()` |
| 6.3.3 | ランダムファイル名 | ✅ | `${timestamp}-${randomBytes(8)}` |

---

## V7: エラーハンドリング・ロギング

### V7.1 ログ内容

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 7.1.1 | セキュリティイベントのログ記録 | ⚠️ | TODO: セキュリティログ強化 |
| 7.1.2 | エラー詳細の適切な記録 | ✅ | `console.error(error)` |
| 7.1.3 | タイムスタンプ記録 | ✅ | ISO 8601形式 |
| 7.1.4 | センシティブデータのマスキング | ⚠️ | TODO: パスワード・トークンのマスキング |

### V7.2 ログ処理

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 7.2.1 | ログインジェクション対策 | ✅ | 構造化ログ（JSON） |
| 7.2.2 | ログ改ざん防止 | ⚠️ | TODO: ログ署名 |

### V7.3 ログ保護

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 7.3.1 | ログへのアクセス制御 | ✅ | ファイルパーミッション600 |
| 7.3.2 | ログの定期バックアップ | ⚠️ | TODO: ログローテーション |
| 7.3.3 | ログの暗号化 | ❌ | TODO: ログ暗号化 |
| 7.3.4 | タイムソース同期 | ✅ | NTP使用 |

### V7.4 エラーハンドリング

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 7.4.1 | 一般的なエラーメッセージ | ✅ | 詳細情報を隠蔽 |
| 7.4.2 | スタックトレースの非公開 | ✅ | 本番環境でスタックトレース非表示 |
| 7.4.3 | null参照例外の適切な処理 | ✅ | TypeScript strict null checks |

---

## V8: データ保護

### V8.1 一般的データ保護

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 8.1.1 | センシティブデータのキャッシュ禁止 | ✅ | `Cache-Control: no-store` |
| 8.1.2 | メモリ上のセンシティブデータの削除 | ⚠️ | TODO: メモリクリア |
| 8.1.3 | GET パラメータにセンシティブデータ禁止 | ✅ | POSTボディ使用 |

### V8.2 クライアントサイド

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 8.2.1 | localStorage に PII 禁止 | ✅ | Session のみ使用 |
| 8.2.2 | オートコンプリート無効（機密） | ✅ | `autocomplete="off"` |
| 8.2.3 | ブラウザキャッシュ無効（機密） | ✅ | `Cache-Control` ヘッダー |

### V8.3 センシティブプライベートデータ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 8.3.1 | PII の暗号化（保存時） | ⚠️ | TODO: フィールドレベル暗号化 |
| 8.3.2 | PII の暗号化（通信時） | ✅ | HTTPS |
| 8.3.3 | PII の最小化 | ✅ | 必要最小限のデータのみ |
| 8.3.4 | PII の保持期間 | ⚠️ | TODO: データ保持ポリシー |
| 8.3.5 | PII の削除（ユーザー要求） | ⚠️ | TODO: GDPR対応削除機能 |
| 8.3.6 | 監査ログ | ⚠️ | TODO: 監査ログテーブル |
| 8.3.7 | センシティブデータの画面マスキング | ✅ | パスワード `type="password"` |
| 8.3.8 | クレジットカード番号のマスキング | N/A | クレカ情報保存なし |

---

## V9: 通信

### V9.1 クライアント通信セキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 9.1.1 | TLS使用（全通信） | ✅ | 本番環境HTTPS強制 |
| 9.1.2 | TLS 1.2以上 | ✅ | Dokku/Nginx設定 |
| 9.1.3 | 暗号スイート（強力なもののみ） | ✅ | Nginx設定 |

### V9.2 サーバー通信セキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 9.2.1 | 信頼できる証明書のみ | ✅ | Let's Encrypt |
| 9.2.2 | 暗号化された接続（DB） | ⚠️ | TODO: PostgreSQL SSL |
| 9.2.3 | サーバー間通信の認証 | ✅ | APIキー使用 |
| 9.2.4 | 最小権限（APIキー） | ✅ | システム別APIキー |

---

## V10: 悪意あるコード

### V10.1 コード整合性

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 10.1.1 | Subresource Integrity（SRI） | ❌ | TODO: CDN SRI |

### V10.2 悪意あるコード検索

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 10.2.1 | 依存関係の脆弱性スキャン | ⚠️ | `npm audit` 定期実行 |
| 10.2.2 | コードレビュー | ✅ | PR必須 |
| 10.2.3 | 自動化されたビルド | ✅ | GitHub Actions |

### V10.3 アプリケーション整合性

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 10.3.1 | コード署名 | ❌ | TODO: リリース署名 |
| 10.3.2 | ビルド再現性 | ⚠️ | Docker使用 |
| 10.3.3 | ソースコード保護 | ✅ | GitHub private repo |

---

## V11: ビジネスロジック

### V11.1 ビジネスロジックセキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 11.1.1 | ステップの順序検証 | ✅ | ステートマシン実装 |
| 11.1.2 | 時間制約の検証 | ⚠️ | TODO: タイムアウト実装 |
| 11.1.3 | 同時実行制御 | ⚠️ | TODO: 楽観的ロック |
| 11.1.4 | 重複処理の防止 | ⚠️ | TODO: 冪等性キー |
| 11.1.5 | 自動化攻撃の検知 | ⚠️ | TODO: レートリミット |
| 11.1.6 | ビジネスロジックの境界チェック | ✅ | Zod検証 |
| 11.1.7 | トランザクション整合性 | ✅ | Prismaトランザクション |
| 11.1.8 | 異常な値の検知 | ⚠️ | TODO: 異常検知 |

---

## V12: ファイル・リソース

### V12.1 ファイルアップロード

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 12.1.1 | ファイルサイズ制限 | ✅ | Multer設定（50MB） |
| 12.1.2 | ファイルタイプ検証（MIME） | ✅ | `file-type`ライブラリ使用 |
| 12.1.3 | ファイル名サニタイズ | ✅ | ランダムファイル名生成 |
| 12.1.4 | パストラバーサル対策 | ✅ | `path.resolve`使用 |

### V12.2 ファイル整合性

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 12.2.1 | ファイルの信頼性検証 | ⚠️ | TODO: ウイルススキャン |

### V12.3 ファイル実行

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 12.3.1 | アップロードファイルの実行禁止 | ✅ | 実行権限なし |
| 12.3.2 | ファイルメタデータの検証 | ✅ | `sharp`で画像検証 |
| 12.3.3 | XMLファイルの検証 | N/A | XML未使用 |
| 12.3.4 | 静的ファイルの分離 | ✅ | `/var/lib/hotel-unified/media/` |
| 12.3.5 | 信頼できないファイルの検証 | ✅ | MIMEタイプチェック |

### V12.4 ファイルストレージ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 12.4.1 | アップロードディレクトリの分離 | ✅ | `/var/lib/hotel-unified/media/` |
| 12.4.2 | アクセス制御 | ✅ | 認証必須 |

### V12.5 ファイルダウンロード

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 12.5.1 | パストラバーサル対策 | ✅ | `path.resolve`使用 |
| 12.5.2 | ダウンロード権限チェック | ✅ | `tenant_id`フィルタ |

### V12.6 SSRF対策

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 12.6.1 | URL検証（ホワイトリスト） | ⚠️ | TODO: URL検証強化 |

---

## V13: API・Webサービス

### V13.1 一般的Webサービスセキュリティ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 13.1.1 | 認証スキーム（全API） | ✅ | Session認証必須 |
| 13.1.2 | セッショントークン（Cookie） | ✅ | HttpOnly, SameSite |
| 13.1.3 | RESTful APIのHTTPメソッド | ✅ | GET/POST/PUT/DELETE |
| 13.1.4 | Authorization ヘッダー | N/A | Cookie使用 |

### V13.2 RESTful Webサービス

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 13.2.1 | CSRF対策（状態変更） | ✅ | SameSite Cookie |
| 13.2.2 | Content-Type検証 | ✅ | `application/json` |
| 13.2.3 | スキーマ検証 | ✅ | Zod |
| 13.2.4 | RESTエンドポイントのメッセージペイロード | ✅ | JSON |
| 13.2.5 | レート制限 | ⚠️ | TODO: レートリミット強化 |
| 13.2.6 | REST APIドキュメント | ⚠️ | TODO: OpenAPI完全版 |

### V13.3 SOAP Webサービス

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 13.3.1 | XSD検証 | N/A | SOAP未使用 |

### V13.4 GraphQL

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 13.4.1 | GraphQL クエリ深さ制限 | N/A | GraphQL未使用 |

---

## V14: 設定

### V14.1 ビルド・デプロイ

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 14.1.1 | ビルドプロセスの自動化 | ✅ | GitHub Actions |
| 14.1.2 | コンパイラフラグ（セキュリティ） | ✅ | TypeScript strict |
| 14.1.3 | 署名されたビルド | ❌ | TODO: リリース署名 |

### V14.2 依存関係

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 14.2.1 | 依存関係の脆弱性スキャン | ⚠️ | `npm audit` 定期実行 |
| 14.2.2 | 依存関係のライセンス確認 | ⚠️ | TODO: ライセンスチェック |
| 14.2.3 | 信頼できるリポジトリ | ✅ | npm公式のみ |
| 14.2.4 | ソフトウェア部品表（SBOM） | ❌ | TODO: SBOM生成 |
| 14.2.5 | 未使用依存関係の削除 | ⚠️ | TODO: 定期クリーンアップ |

### V14.3 意図しない情報公開

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 14.3.1 | Webルートの最小化 | ✅ | `/public/` のみ公開 |
| 14.3.2 | デバッグモード無効（本番） | ✅ | `NODE_ENV=production` |
| 14.3.3 | HTTPヘッダー（セキュリティ） | ⚠️ | TODO: セキュリティヘッダー強化 |
| 14.3.4 | CORS ポリシー | ✅ | 同一オリジンのみ |

### V14.4 HTTPセキュリティヘッダー

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 14.4.1 | Content-Security-Policy | ⚠️ | TODO: CSP設定 |
| 14.4.2 | X-Content-Type-Options | ✅ | `nosniff` |
| 14.4.3 | Strict-Transport-Security | ✅ | HSTS有効 |
| 14.4.4 | Referrer-Policy | ⚠️ | TODO: `strict-origin-when-cross-origin` |
| 14.4.5 | X-Frame-Options | ✅ | `DENY` |

### V14.5 HTTPリクエストヘッダー検証

| ID | 要件 | 状態 | 証跡 |
|:---|:-----|:----:|:-----|
| 14.5.1 | Content-Type検証 | ✅ | `application/json` |
| 14.5.2 | Content-Length検証 | ✅ | Multer設定 |
| 14.5.3 | URLスキーマ検証 | ✅ | HTTPS強制 |
| 14.5.4 | Accept ヘッダー検証 | ⚠️ | TODO: Accept検証 |

---

## 📊 総合評価

### 達成状況

| カテゴリ | 合計 | ✅ 合格 | ⚠️ 要改善 | ❌ 不合格 | N/A | 達成率 |
|:--------|:----:|:------:|:--------:|:--------:|:---:|:-----:|
| V1: アーキテクチャ | 9 | 7 | 1 | 0 | 1 | 87.5% |
| V2: 認証 | 25 | 17 | 3 | 5 | 0 | 68.0% |
| V3: セッション管理 | 13 | 10 | 2 | 0 | 1 | 83.3% |
| V4: アクセス制御 | 9 | 7 | 2 | 0 | 0 | 77.8% |
| V5: 入力検証 | 30 | 25 | 1 | 0 | 4 | 96.2% |
| V6: 暗号化 | 17 | 13 | 2 | 0 | 2 | 86.7% |
| V7: ログ・エラー | 15 | 10 | 4 | 1 | 0 | 66.7% |
| V8: データ保護 | 16 | 11 | 5 | 0 | 0 | 68.8% |
| V9: 通信 | 7 | 6 | 1 | 0 | 0 | 85.7% |
| V10: 悪意あるコード | 8 | 3 | 3 | 2 | 0 | 37.5% |
| V11: ビジネスロジック | 8 | 3 | 5 | 0 | 0 | 37.5% |
| V12: ファイル | 19 | 14 | 2 | 0 | 3 | 87.5% |
| V13: API | 15 | 9 | 3 | 0 | 3 | 75.0% |
| V14: 設定 | 20 | 10 | 7 | 3 | 0 | 50.0% |
| **総合** | **211** | **145** | **41** | **11** | **14** | **73.0%** |

### 優先度別TODO

#### 🔴 High Priority（すぐに対応すべき）

1. 2FA実装（V2.8.1, V2.8.2）
2. パスワード侵害チェック（V2.1.6）
3. レートリミット強化（V2.2.1, V13.2.5）
4. セキュリティログ強化（V7.1.1, V7.1.4）
5. PII暗号化（V8.3.1）
6. CSP設定（V14.4.1）

#### 🟡 Medium Priority（計画的に対応）

1. データ分類表（V6.1.1）
2. 監査ログ（V8.3.6）
3. PostgreSQL SSL（V9.2.2）
4. SBOM生成（V14.2.4）
5. セキュリティヘッダー強化（V14.4系）

#### 🟢 Low Priority（機会があれば対応）

1. ログ署名（V7.2.2）
2. SRI（V10.1.1）
3. コード署名（V10.3.1）
4. ウイルススキャン（V12.2.1）

---

ここまで読み込んだらまず「OWASP-ASVS-L2-CHECKLIST.md 読了」と表示すること







