# レイアウトシステム機能仕様書

## 概要

レイアウトシステムは、ホテルSaaSにおけるページレイアウトを柔軟に作成・管理するための機能です。ドラッグ&ドロップインターフェースを使用して、コードを書くことなく直感的にページを作成できます。

## 主要機能

### 1. レイアウト作成方式

レイアウトの作成は以下の3つの方式をサポートしています：

#### 1.1 空白から作成
- 何もない状態から新しくレイアウトを作成
- 基本的な要素を自由に配置してオリジナルのレイアウトを構築
- 完全にカスタマイズされたページを作成したい場合に使用

#### 1.2 テンプレートから作成
- 事前に用意されたテンプレートをベースに作成
- テンプレート一覧から選択してカスタマイズ
- 効率的にプロフェッショナルなレイアウトを作成可能

#### 1.3 既存レイアウトを複製
- 既存のレイアウトをコピーして新しいレイアウトを作成
- 類似したページを作成する際に効率的
- 既存のカスタマイズを活用して時間を節約

### 2. レイアウトタイプ

#### 2.1 ページ（Page）
- 実際に表示される通常のページ
- 公開・非公開の管理が可能
- SEO設定やURL設定が可能

#### 2.2 テンプレート（Template）
- 他のレイアウト作成時のベースとして使用
- 再利用可能なデザインパターンを保存
- カテゴリ別に分類して管理

#### 2.3 コンポーネント（Component）
- 部分的な要素として他のレイアウトに埋め込み可能
- ヘッダー、フッター、サイドバーなどの共通要素
- 複数のページで一貫性を保つために使用

### 3. カテゴリ分類

レイアウトは以下のカテゴリで分類されます：

- **TOPページ**: ホテルのメインページ用レイアウト
- **インフォメーション**: お知らせや情報表示用レイアウト
- **カスタム**: その他のカスタム用途のレイアウト

### 4. 要素タイプ

#### 4.1 基本要素
- **テキスト**: 見出し、段落、リストなどのテキスト要素
- **画像**: 写真、イラスト、アイコンなどの画像要素
- **ボタン**: CTA（Call to Action）ボタン要素

#### 4.2 レイアウト要素
- **コンテナ**: 他の要素をグループ化するボックス
- **セクション**: ページの区切りとなる大きなブロック
- **グリッド**: 複数の要素を格子状に配置

#### 4.3 装飾要素
- **スペーサー**: 要素間のスペースを調整
- **区切り線**: セクション間の視覚的な区切り
- **バナー**: 特別な告知や宣伝用のバナー

#### 4.4 高度な要素
- **カード**: 情報をカード形式で表示
- **カスタムHTML**: 独自のHTMLコードを埋め込み

### 5. スタイリング機能

#### 5.1 レイアウト設定
- **サイズ**: 幅、高さの設定
- **位置**: マージン、パディング、配置
- **フレックスボックス**: モダンなレイアウト設定
- **グリッドレイアウト**: 格子状のレイアウト設定

#### 5.2 装飾設定
- **背景**: 色、画像、グラデーション
- **ボーダー**: 枠線の太さ、色、スタイル
- **影**: ボックスシャドウ、テキストシャドウ
- **エフェクト**: 透明度、フィルター、変形

#### 5.3 テキスト設定
- **フォント**: 書体、サイズ、太さ
- **色**: テキストカラー
- **配置**: 左寄せ、中央寄せ、右寄せ、両端揃え
- **装飾**: 下線、取り消し線、装飾線

#### 5.4 レスポンシブ対応
- **デスクトップ**: PC画面用の設定
- **タブレット**: タブレット画面用の設定
- **モバイル**: スマートフォン画面用の設定

### 6. 編集機能

#### 6.1 ドラッグ&ドロップ操作
- 要素パレットからキャンバスへの要素追加
- キャンバス内での要素の移動と配置
- 要素の親子関係の設定

#### 6.2 選択と編集
- 単一要素の選択とプロパティ編集
- 複数要素の同時選択と一括編集
- 要素のコピー、貼り付け、削除

#### 6.3 履歴管理
- 編集操作の取り消し（Undo）
- 取り消し操作のやり直し（Redo）
- 変更履歴の確認

#### 6.4 プレビュー機能
- リアルタイムプレビュー
- デバイス別プレビュー
- 公開前のテスト表示

### 7. 状態管理

#### 7.1 保存状態
- **下書き**: 編集中の未公開状態
- **公開**: 実際にサイトで表示される状態
- **アーカイブ**: 無効化された状態

#### 7.2 バージョン管理
- 編集履歴の自動保存
- 特定のバージョンへの巻き戻し
- 変更内容のコメント記録

### 8. 権限管理

#### 8.1 作成者権限
- レイアウトの作成、編集、削除
- 公開・非公開の切り替え
- テンプレート化の設定

#### 8.2 管理者権限
- 全レイアウトの管理
- ユーザー権限の設定
- システム設定の変更

### 9. SEO機能

#### 9.1 基本設定
- ページタイトル
- メタディスクリプション
- メタキーワード

#### 9.2 構造化データ
- Schema.orgマークアップの自動生成
- 検索エンジン向けの構造化情報

### 10. アセット管理

#### 10.1 ファイル管理
- 画像、動画、ドキュメントのアップロード
- ファイルの分類とタグ付け
- 使用状況の追跡

#### 10.2 最適化
- 画像の自動圧縮
- レスポンシブ画像の生成
- CDN配信対応

## データベース設計

### 主要テーブル

#### Layoutテーブル
```sql
- id: 主キー
- name: レイアウト名
- slug: URL用スラッグ
- description: 説明
- type: タイプ（page/template/component）
- category: カテゴリ
- status: 状態（draft/published/archived）
- data: レイアウトデータ（JSON）
- settings: 設定データ（JSON）
- isTemplate: テンプレートフラグ
- templateId: 元テンプレートID
- authorId: 作成者ID
- version: バージョン番号
- 作成・更新日時
```

#### LayoutRevisionテーブル
```sql
- id: 主キー
- layoutId: レイアウトID
- version: バージョン番号
- data: その時点のデータ
- changeLog: 変更ログ
- createdBy: 作成者
- 作成日時
```

#### LayoutAssetテーブル
```sql
- id: 主キー
- layoutId: レイアウトID
- fileName: ファイル名
- filePath: ファイルパス
- fileSize: ファイルサイズ
- mimeType: MIMEタイプ
- fileType: ファイルタイプ
- 作成日時・作成者
```

## API設計

### エンドポイント一覧

#### レイアウト管理
- `GET /api/v1/admin/layouts` - レイアウト一覧取得
- `GET /api/v1/admin/layouts/:id` - レイアウト詳細取得
- `POST /api/v1/admin/layouts` - レイアウト作成
- `PUT /api/v1/admin/layouts/:id` - レイアウト更新
- `DELETE /api/v1/admin/layouts/:id` - レイアウト削除
- `POST /api/v1/admin/layouts/:id/duplicate` - レイアウト複製

#### テンプレート管理
- `GET /api/v1/admin/layouts/templates` - テンプレート一覧
- `POST /api/v1/admin/layouts/:id/template` - テンプレート化

#### バージョン管理
- `GET /api/v1/admin/layouts/:id/revisions` - 履歴一覧
- `POST /api/v1/admin/layouts/:id/restore/:version` - バージョン復元

#### アセット管理
- `POST /api/v1/admin/layouts/assets` - アセットアップロード
- `GET /api/v1/admin/layouts/assets` - アセット一覧
- `DELETE /api/v1/admin/layouts/assets/:id` - アセット削除

## 使用方法

### 1. 新規レイアウト作成

1. 管理画面のレイアウト管理に移動
2. 「新規作成」ボタンをクリック
3. 作成方式を選択（空白/テンプレート/複製）
4. 基本情報を入力（名前、カテゴリ等）
5. 「作成」ボタンでレイアウトエディタに移動

### 2. レイアウト編集

1. 要素パレットから使用したい要素を選択
2. キャンバスにドラッグ&ドロップで配置
3. 配置した要素をクリックして選択
4. プロパティパネルでスタイルを調整
5. プレビューで確認
6. 保存して公開

### 3. テンプレート活用

1. レイアウト編集画面で「テンプレートとして保存」を選択
2. テンプレート名と説明を入力
3. カテゴリを選択して保存
4. 新規作成時にテンプレート選択で利用可能

## 技術仕様

### フロントエンド
- **Framework**: Vue 3 + Nuxt 3
- **UI Library**: Tailwind CSS
- **ドラッグ&ドロップ**: Vue Draggable Plus
- **アイコン**: Heroicons
- **状態管理**: Pinia

### バックエンド
- **Runtime**: Node.js
- **Framework**: Nuxt 3 Server API
- **ORM**: Prisma
- **Database**: SQLite (開発) / PostgreSQL (本番)
- **File Storage**: ローカル / S3互換

### セキュリティ
- **認証**: JWT ベース
- **認可**: ロールベースアクセス制御
- **CSRFトークン**: 全POST/PUT/DELETEリクエスト
- **XSS対策**: HTMLサニタイゼーション

## 今後の拡張予定

### Phase 2
- **A/Bテスト機能**: 複数バージョンの比較テスト
- **多言語対応**: 国際化対応の強化
- **アニメーション**: 要素のアニメーション設定
- **フォーム要素**: 問い合わせフォーム等の追加

### Phase 3
- **外部連携**: 外部サービスとの連携（SNS、分析ツール等）
- **カスタムコンポーネント**: 独自コンポーネントの開発機能
- **マーケットプレイス**: テンプレートの共有・販売機能
- **AI支援**: AIによるレイアウト提案機能

## 制限事項

### 現在の制限
- **要素数**: 1ページあたり最大100要素
- **ファイルサイズ**: アップロード可能なファイルは最大10MB
- **同時編集**: 複数ユーザーによる同時編集は非対応
- **ブラウザ**: IE非対応（モダンブラウザのみ）

### パフォーマンス
- **レスポンス時間**: API応答時間は平均200ms以下
- **ファイル配信**: CDN経由での高速配信
- **キャッシュ**: 静的リソースの積極的キャッシュ

## サポート・メンテナンス

### 定期メンテナンス
- **バックアップ**: 日次自動バックアップ
- **セキュリティアップデート**: 月次セキュリティパッチ適用
- **パフォーマンス最適化**: 四半期ごとの最適化作業

### トラブルシューティング
- **ログ記録**: 詳細なエラーログとアクセスログ
- **監視**: リアルタイムシステム監視
- **復旧手順**: 障害時の迅速な復旧プロセス