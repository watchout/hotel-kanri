# プラン別テンプレートシステム設計

## 概要
エコノミープランでは固定テンプレートで簡単操作、上位プランでは段階的なカスタマイズ機能を提供

## プラン別機能定義

### エコノミープラン（¥19,800/月）
```typescript
interface EconomyPlanFeatures {
  templates: {
    available: ['facility-guide', 'campaign', 'menu-showcase']
    customization: 'content-only'  // コンテンツ変更のみ
    layoutModification: false
    blockAddition: false
    designCustomization: false
  }
  
  contentManagement: {
    basicInfoInput: true
    imageUpload: true
    textEditing: true
    autoDataFill: true
  }
  
  display: {
    multiDevice: true  // TV/Web/Mobile対応
    responsive: true
    slideShow: true
  }
}
```

### プロフェッショナルプラン（¥49,800/月）
```typescript
interface ProfessionalPlanFeatures {
  templates: {
    available: 'all'
    customization: 'layout-adjustable'
    layoutModification: true
    blockAddition: true
    designCustomization: 'basic'  // 色・フォント変更
  }
  
  contentManagement: {
    ...EconomyPlanFeatures.contentManagement,
    blockReordering: true
    conditionalDisplay: true
    scheduledPublishing: true
  }
  
  advanced: {
    customBlocks: 'limited'  // 基本的なカスタムブロック
    integrations: 'standard'
    analytics: true
  }
}
```

### エンタープライズプラン（¥99,800/月）
```typescript
interface EnterprisePlanFeatures {
  templates: {
    available: 'all'
    customization: 'full'
    layoutModification: true
    blockAddition: true
    designCustomization: 'advanced'
    customTemplateCreation: true
  }
  
  contentManagement: {
    ...ProfessionalPlanFeatures.contentManagement,
    customBlocks: 'unlimited'
    apiIntegrations: 'advanced'
    workflowAutomation: true
  }
  
  advanced: {
    customCSS: true
    customJavaScript: true
    thirdPartyIntegrations: true
    advancedAnalytics: true
  }
}
```

## 実装アーキテクチャ

### 1. 共通テンプレートエンジン
```typescript
interface TemplateEngine {
  renderTemplate(
    templateId: string, 
    data: any, 
    plan: PlanType,
    device: DeviceType
  ): RenderedTemplate
  
  getAvailableFeatures(plan: PlanType): PlanFeatures
  validateCustomization(customization: any, plan: PlanType): boolean
  applyPlanRestrictions(content: any, plan: PlanType): any
}

class UnifiedTemplateEngine implements TemplateEngine {
  private planRestrictions = {
    economy: {
      allowedTemplates: ['facility-guide', 'campaign', 'menu-showcase'],
      allowedCustomizations: ['content'],
      blockedFeatures: ['layout-modification', 'block-addition', 'design-customization']
    },
    professional: {
      allowedTemplates: 'all',
      allowedCustomizations: ['content', 'layout', 'basic-design'],
      blockedFeatures: ['custom-css', 'custom-js']
    },
    enterprise: {
      allowedTemplates: 'all',
      allowedCustomizations: 'all',
      blockedFeatures: []
    }
  }
  
  renderTemplate(templateId: string, data: any, plan: PlanType, device: DeviceType) {
    // プラン制限チェック
    if (!this.isTemplateAllowed(templateId, plan)) {
      throw new Error(`Template ${templateId} not available for ${plan} plan`)
    }
    
    // デバイス別最適化
    const deviceConfig = this.getDeviceConfig(device)
    
    // テンプレート生成
    const template = this.generateTemplate(templateId, data, deviceConfig)
    
    // プラン制限適用
    return this.applyPlanRestrictions(template, plan)
  }
}
```

### 2. エコノミープラン用固定テンプレート
```typescript
// 館内施設案内テンプレート（エコノミープラン）
const facilityGuideEconomy = {
  id: 'facility-guide-economy',
  name: '館内施設案内',
  plan: 'economy',
  
  // 固定レイアウト
  layout: {
    modifiable: false,
    blocks: [
      {
        id: 'hero',
        type: 'hero-section',
        locked: true,
        content: {
          title: '{{hotelName}}の施設案内',
          subtitle: '{{welcomeMessage}}',
          backgroundImage: 'default-facility.jpg'
        }
      },
      {
        id: 'facilities',
        type: 'facility-grid',
        locked: true,
        content: {
          autoFill: true,
          displayMode: 'card',
          showHours: true,
          showImages: true,
          facilityTypes: 'all'
        }
      },
      {
        id: 'contact',
        type: 'contact-info',
        locked: true,
        content: {
          autoFill: true,
          showPhone: true,
          showEmail: true,
          showHours: true
        }
      }
    ]
  },
  
  // 編集可能項目
  editableFields: [
    {
      field: 'hotelName',
      type: 'text',
      label: 'ホテル名',
      required: true
    },
    {
      field: 'welcomeMessage',
      type: 'textarea',
      label: 'ウェルカムメッセージ',
      required: true
    },
    {
      field: 'heroImage',
      type: 'image',
      label: 'メイン画像',
      required: false
    }
  ],
  
  // 自動生成項目
  autoGenerated: [
    'facilityList',
    'operatingHours',
    'contactInfo',
    'floorMap'
  ]
}

// キャンペーンテンプレート（エコノミープラン）
const campaignEconomy = {
  id: 'campaign-economy',
  name: 'キャンペーン告知',
  plan: 'economy',
  
  layout: {
    modifiable: false,
    blocks: [
      {
        id: 'campaign-hero',
        type: 'campaign-hero',
        locked: true,
        content: {
          title: '{{campaignTitle}}',
          description: '{{campaignDescription}}',
          validUntil: '{{validUntil}}',
          showCountdown: true,
          ctaText: '今すぐ予約'
        }
      },
      {
        id: 'offer-details',
        type: 'offer-details',
        locked: true,
        content: {
          autoFill: true,
          showTerms: true,
          showPricing: true
        }
      },
      {
        id: 'booking-cta',
        type: 'booking-cta',
        locked: true,
        content: {
          autoFill: true,
          buttonText: 'ご予約・お問い合わせ',
          showContact: true
        }
      }
    ]
  },
  
  editableFields: [
    {
      field: 'campaignTitle',
      type: 'text',
      label: 'キャンペーンタイトル',
      required: true
    },
    {
      field: 'campaignDescription',
      type: 'textarea',
      label: 'キャンペーン説明',
      required: true
    },
    {
      field: 'validUntil',
      type: 'date',
      label: '有効期限',
      required: true
    },
    {
      field: 'campaignImage',
      type: 'image',
      label: 'キャンペーン画像',
      required: false
    }
  ]
}
```

### 3. プラン制限システム
```typescript
interface PlanRestrictionSystem {
  checkFeatureAccess(feature: string, plan: PlanType): boolean
  getAvailableTemplates(plan: PlanType): Template[]
  validateCustomization(customization: any, plan: PlanType): ValidationResult
  applyPlanLimitations(content: any, plan: PlanType): any
}

class PlanRestrictionManager implements PlanRestrictionSystem {
  private restrictions = {
    economy: {
      templates: ['facility-guide', 'campaign', 'menu-showcase'],
      customization: ['content-edit'],
      blocked: ['layout-modification', 'block-addition', 'design-customization']
    },
    professional: {
      templates: 'all',
      customization: ['content-edit', 'layout-adjustment', 'basic-design'],
      blocked: ['custom-css', 'custom-js', 'advanced-integrations']
    },
    enterprise: {
      templates: 'all',
      customization: 'all',
      blocked: []
    }
  }
  
  checkFeatureAccess(feature: string, plan: PlanType): boolean {
    const planRestrictions = this.restrictions[plan]
    return !planRestrictions.blocked.includes(feature)
  }
  
  validateCustomization(customization: any, plan: PlanType): ValidationResult {
    const errors = []
    
    // エコノミープランの制限チェック
    if (plan === 'economy') {
      if (customization.layoutModification) {
        errors.push('レイアウト変更はプロフェッショナルプラン以上で利用可能です')
      }
      if (customization.blockAddition) {
        errors.push('ブロック追加はプロフェッショナルプラン以上で利用可能です')
      }
      if (customization.designCustomization) {
        errors.push('デザインカスタマイズはプロフェッショナルプラン以上で利用可能です')
      }
    }
    
    return {
      valid: errors.length === 0,
      errors
    }
  }
}
```

### 4. 段階的機能解放UI
```vue
<template>
  <div class="template-editor">
    <!-- プラン表示 -->
    <div class="plan-indicator">
      <span class="current-plan">{{ currentPlan }}プラン</span>
      <button v-if="hasUpgradeOptions" @click="showUpgradeModal = true">
        アップグレード
      </button>
    </div>
    
    <!-- テンプレート選択 -->
    <div class="template-selection">
      <div 
        v-for="template in availableTemplates" 
        :key="template.id"
        class="template-option"
        @click="selectTemplate(template)"
      >
        <div class="template-preview">
          <img :src="template.preview" />
        </div>
        <div class="template-info">
          <h3>{{ template.name }}</h3>
          <p>{{ template.description }}</p>
        </div>
      </div>
    </div>
    
    <!-- エディタ -->
    <div class="editor-container">
      <!-- エコノミープラン：簡単入力フォーム -->
      <div v-if="currentPlan === 'economy'" class="simple-editor">
        <h3>基本情報を入力</h3>
        <form @submit.prevent="generatePage">
          <div 
            v-for="field in selectedTemplate.editableFields" 
            :key="field.field"
            class="form-group"
          >
            <label>{{ field.label }}</label>
            <input 
              v-if="field.type === 'text'"
              v-model="formData[field.field]"
              type="text"
              :required="field.required"
            />
            <textarea 
              v-else-if="field.type === 'textarea'"
              v-model="formData[field.field]"
              :required="field.required"
            />
            <input 
              v-else-if="field.type === 'date'"
              v-model="formData[field.field]"
              type="date"
              :required="field.required"
            />
            <ImageUpload 
              v-else-if="field.type === 'image'"
              v-model="formData[field.field]"
            />
          </div>
          
          <button type="submit" class="generate-button">
            ページを生成
          </button>
        </form>
      </div>
      
      <!-- プロフェッショナル+：カスタマイズエディタ -->
      <div v-else class="advanced-editor">
        <NoCodeEditor 
          :template="selectedTemplate"
          :restrictions="planRestrictions"
          :initial-data="formData"
          @save="savePage"
        />
        
        <!-- 制限機能の案内 -->
        <div class="restricted-features">
          <h4>さらに高度な機能</h4>
          <div 
            v-for="feature in restrictedFeatures" 
            :key="feature.id"
            class="restricted-feature"
          >
            <Icon :name="feature.icon" />
            <span>{{ feature.name }}</span>
            <button @click="showUpgradeModal = true">
              アップグレード
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- アップグレードモーダル -->
    <UpgradeModal 
      v-if="showUpgradeModal"
      :current-plan="currentPlan"
      :target-feature="targetFeature"
      @close="showUpgradeModal = false"
    />
  </div>
</template>

<script setup>
const { currentPlan, checkFeatureAccess } = usePlanFeatures()
const planRestrictions = computed(() => getPlanRestrictions(currentPlan.value))

const availableTemplates = computed(() => {
  return templates.filter(template => 
    checkFeatureAccess(`template:${template.id}`)
  )
})

const restrictedFeatures = computed(() => {
  const features = [
    { id: 'custom-css', name: 'カスタムCSS', icon: 'heroicons:code' },
    { id: 'custom-blocks', name: 'カスタムブロック', icon: 'heroicons:cube' },
    { id: 'advanced-integrations', name: '外部連携', icon: 'heroicons:link' }
  ]
  
  return features.filter(feature => 
    !checkFeatureAccess(feature.id)
  )
})
</script>
```

## 実装フェーズ

### Phase 1: エコノミープラン固定テンプレート（1週間）
- [ ] 3つの基本テンプレート実装
- [ ] 簡単入力フォーム
- [ ] 自動生成機能
- [ ] マルチデバイス対応

### Phase 2: プラン制限システム（1週間）
- [ ] プラン判定機能
- [ ] 機能制限チェック
- [ ] アップグレード案内
- [ ] 段階的機能解放

### Phase 3: 上位プランカスタマイズ機能（1週間）
- [ ] レイアウト調整機能
- [ ] ブロック追加・削除
- [ ] デザインカスタマイズ
- [ ] 高度な機能統合

この設計により、エコノミープランでは「5分で美しいページ完成」、上位プランでは「自由度の高いカスタマイズ」を両立できます。 