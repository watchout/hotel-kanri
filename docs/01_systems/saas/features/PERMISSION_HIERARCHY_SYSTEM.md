# OmotenasuAI æ¨©é™éšå±¤ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

## æ¦‚è¦

OmotenasuAIã§ã¯ã€3å±¤ã®æ¨©é™éšå±¤ã«ã‚ˆã£ã¦ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚
å„æ¨©é™ãƒ¬ãƒ™ãƒ«ã§é©åˆ‡ãªæ©Ÿèƒ½åˆ¶é™ã¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’å®Ÿè£…ã—ã€ã‚»ã‚­ãƒ¥ã‚¢ãªãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆç’°å¢ƒã‚’æä¾›ã—ã¾ã™ã€‚

## æ¨©é™éšå±¤æ§‹é€ 

### 1. ğŸ¢ SuperAdmin (é–‹ç™ºå…ƒãƒ»å½“ç¤¾)
**å½¹å‰²**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®çµ±æ‹¬ç®¡ç†
**æ¨©é™ãƒ¬ãƒ™ãƒ«**: `super_admin`

#### ä¸»è¦æ¨©é™
- âœ… **ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†**
  - AIãƒ¢ãƒ‡ãƒ«è¨­å®šãƒ»ä¾¡æ ¼èª¿æ•´
  - ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆè¨­å®š
  - ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®è¨­å®šå¤‰æ›´

- âœ… **ä»£ç†åº—ç®¡ç†**
  - ä»£ç†åº—ç™»éŒ²ãƒ»å‰Šé™¤
  - ãƒ©ãƒ³ã‚¯è¨­å®šãƒ»ãƒãƒ¼ã‚¸ãƒ³èª¿æ•´
  - å£²ä¸Šåˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ

- âœ… **ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†**
  - å…¨ãƒ†ãƒŠãƒ³ãƒˆã®ç›£è¦–ãƒ»ç®¡ç†
  - ãƒ—ãƒ©ãƒ³å¤‰æ›´ãƒ»èª²é‡‘è¨­å®š
  - ã‚·ã‚¹ãƒ†ãƒ åˆ©ç”¨çŠ¶æ³åˆ†æ

- âœ… **æŠ€è¡“ç®¡ç†**
  - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
  - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§

#### ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‚¨ãƒªã‚¢
```
/admin/system/*          # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
/admin/agents/*          # ä»£ç†åº—ç®¡ç†
/admin/tenants/*         # ãƒ†ãƒŠãƒ³ãƒˆç®¡ç†
/admin/analytics/*       # å…¨ä½“åˆ†æ
/admin/billing/*         # èª²é‡‘ç®¡ç†
```

### 2. ğŸ¤ Agent (ä»£ç†åº—)
**å½¹å‰²**: æ‹…å½“ãƒ›ãƒ†ãƒ«ã®å–¶æ¥­ãƒ»ã‚µãƒãƒ¼ãƒˆ
**æ¨©é™ãƒ¬ãƒ™ãƒ«**: `agent`

#### ä¸»è¦æ¨©é™
- âœ… **æ‹…å½“ãƒ›ãƒ†ãƒ«ç®¡ç†**
  - æ–°è¦ãƒ›ãƒ†ãƒ«ç™»éŒ²
  - å¥‘ç´„ç®¡ç†ãƒ»æ›´æ–°
  - ãƒ—ãƒ©ãƒ³å¤‰æ›´ã‚µãƒãƒ¼ãƒˆ

- âœ… **å£²ä¸Šç®¡ç†**
  - è‡ªç¤¾å£²ä¸Šãƒ»ãƒãƒ¼ã‚¸ãƒ³ç¢ºèª
  - æœˆæ¬¡ãƒ»å¹´æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ
  - ãƒ©ãƒ³ã‚¯é€²æ—ç¢ºèª

- âœ… **é¡§å®¢ã‚µãƒãƒ¼ãƒˆ**
  - æ‹…å½“ãƒ›ãƒ†ãƒ«ã®æŠ€è¡“ã‚µãƒãƒ¼ãƒˆ
  - è¨­å®šå¤‰æ›´ä»£è¡Œ
  - å•ã„åˆã‚ã›å¯¾å¿œ

#### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
- âŒ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´ä¸å¯
- âŒ ä»–ä»£ç†åº—ã®æƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- âŒ ä¾¡æ ¼ãƒ»ãƒãƒ¼ã‚¸ãƒ³è¨­å®šå¤‰æ›´ä¸å¯

#### ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‚¨ãƒªã‚¢
```
/agent/dashboard         # ä»£ç†åº—ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
/agent/hotels/*          # æ‹…å½“ãƒ›ãƒ†ãƒ«ç®¡ç†
/agent/sales/*           # å£²ä¸Šãƒ»ãƒãƒ¼ã‚¸ãƒ³
/agent/support/*         # ã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½
```

### 3. ğŸ¨ Hotel (ãƒ›ãƒ†ãƒ«ç®¡ç†è€…)
**å½¹å‰²**: è‡ªãƒ›ãƒ†ãƒ«ã®é‹å–¶ç®¡ç†
**æ¨©é™ãƒ¬ãƒ™ãƒ«**: `admin`

#### ä¸»è¦æ¨©é™
- âœ… **ãƒ›ãƒ†ãƒ«é‹å–¶**
  - ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†
  - æ³¨æ–‡ç®¡ç†ãƒ»å±¥æ­´
  - ãƒ‡ãƒã‚¤ã‚¹è¨­å®š

- âœ… **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†**
  - é¤¨å†…æ–½è¨­æ¡ˆå†…
  - ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³è¨­å®š
  - å¤šè¨€èªå¯¾å¿œ

- âœ… **åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ**
  - å£²ä¸Šåˆ†æ
  - äººæ°—å•†å“åˆ†æ
  - åˆ©ç”¨çµ±è¨ˆ

#### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
- âŒ ä»–ãƒ›ãƒ†ãƒ«ã®æƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
- âŒ ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå¤‰æ›´ä¸å¯
- âŒ ä»£ç†åº—æƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯

#### ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã‚¨ãƒªã‚¢
```
/admin/menu/*            # ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†
/admin/orders/*          # æ³¨æ–‡ç®¡ç†
/admin/devices/*         # ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
/admin/info/*            # é¤¨å†…æ¡ˆå†…
/admin/statistics/*      # åˆ†æãƒ»çµ±è¨ˆ
```

## æŠ€è¡“å®Ÿè£…

### èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

#### 1. ãƒ†ãƒŠãƒ³ãƒˆè§£æ±ºãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
```typescript
// middleware/01-tenant-resolver.ts
export default defineNuxtRouteMiddleware(async (to) => {
  const host = to.headers?.host
  const tenant = await resolveTenantFromHost(host)
  
  if (tenant) {
    setTenantContext(tenant.id)
  }
})
```

#### 2. æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
```typescript
// server/middleware/auth.ts
export default defineEventHandler(async (event) => {
  const session = await getServerSession(event)
  const userRole = session?.user?.role
  
  // æ¨©é™ãƒ¬ãƒ™ãƒ«ãƒã‚§ãƒƒã‚¯
  if (requiresSuperAdmin(event.path) && userRole !== 'super_admin') {
    throw createError({ statusCode: 403, statusMessage: 'SuperAdminæ¨©é™ãŒå¿…è¦ã§ã™' })
  }
  
  if (requiresAgent(event.path) && !['agent', 'super_admin'].includes(userRole)) {
    throw createError({ statusCode: 403, statusMessage: 'ä»£ç†åº—æ¨©é™ãŒå¿…è¦ã§ã™' })
  }
})
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢

#### ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ã‚¯ã‚¨ãƒª
```typescript
// server/utils/tenant-context.ts
export function withTenantIsolation<T>(
  handler: (event: H3Event, tenantId: string) => Promise<T>
) {
  return async (event: H3Event): Promise<T> => {
    const tenantId = await getTenantIdFromRequest(event)
    
    // Prismaã‚¯ã‚¨ãƒªã«ãƒ†ãƒŠãƒ³ãƒˆæ¡ä»¶ã‚’è‡ªå‹•è¿½åŠ 
    return handler(event, tenantId)
  }
}
```

## ãƒ—ãƒ©ãƒ³åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ 

### Economy Planåˆ¶é™
```typescript
// composables/usePlanRestrictions.ts
export const usePlanRestrictions = () => {
  const restrictions = {
    economy: {
      maxDevices: 30,
      aiConcierge: false,
      layoutEditor: false,
      multilingual: false,
      maxMonthlyOrders: 1000
    },
    professional: {
      maxDevices: 100,
      aiConcierge: true,
      layoutEditor: true,
      multilingual: true,
      maxMonthlyOrders: 5000
    },
    enterprise: {
      maxDevices: -1, // ç„¡åˆ¶é™
      aiConcierge: true,
      layoutEditor: true,
      multilingual: true,
      maxMonthlyOrders: -1 // ç„¡åˆ¶é™
    }
  }
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 1. ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢**: å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã«ãƒ†ãƒŠãƒ³ãƒˆIDãƒ•ã‚£ãƒ«ã‚¿ã‚’è‡ªå‹•é©ç”¨
- **APIåˆ†é›¢**: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«ã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: JWTãƒ™ãƒ¼ã‚¹ã®ã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼

### 2. ç›£æŸ»ãƒ­ã‚°
```typescript
// æ¨©é™å¤‰æ›´ãƒ»é‡è¦æ“ä½œã®ãƒ­ã‚°è¨˜éŒ²
interface AuditLog {
  userId: number
  userRole: string
  action: string
  resource: string
  tenantId?: string
  timestamp: Date
  ipAddress: string
}
```

### 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™
- APIå‘¼ã³å‡ºã—é »åº¦åˆ¶é™
- ãƒ—ãƒ©ãƒ³ã«å¿œã˜ãŸæ©Ÿèƒ½åˆ¶é™
- ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œçŸ¥

## ä»£ç†åº—ãƒ©ãƒ³ã‚¯ã‚·ã‚¹ãƒ†ãƒ 

### ãƒ©ãƒ³ã‚¯éšå±¤
| Rank | Initial Margin | Continuing Margin | å¹´é–“å£²ä¸Šæ¡ä»¶ | å¹´é–“å¥‘ç´„æ¡ä»¶ |
|------|---------------|-------------------|------------|------------|
| **Bronze** | 35% | 15% | Â¥0-Â¥4,000,000 | 3+ contracts |
| **Silver** | 45% | 20% | Â¥4,000,000+ | 6+ contracts |
| **Gold** | 55% | 25% | Â¥12,000,000+ | 12+ contracts |
| **Platinum** | 65% | 30% | Â¥30,000,000+ | 24+ contracts |
| **Diamond** | 75% | 35% | Â¥50,000,000+ | 50+ contracts |

### è‡ªå‹•ãƒ©ãƒ³ã‚¯è©•ä¾¡
```typescript
// server/api/v1/admin/agents/[id]/rank-evaluation.post.ts
export default defineEventHandler(async (event) => {
  const agentId = getRouterParam(event, 'id')
  const performance = await calculateAgentPerformance(agentId)
  
  const newRank = evaluateRank(performance)
  await updateAgentRank(agentId, newRank)
  
  return { rank: newRank, performance }
})
```

## é‹ç”¨ãƒ•ãƒ­ãƒ¼

### 1. æ–°è¦ãƒ›ãƒ†ãƒ«ç™»éŒ²
```
SuperAdmin â†’ ä»£ç†åº—ç™»éŒ² â†’ ä»£ç†åº— â†’ ãƒ›ãƒ†ãƒ«ç™»éŒ² â†’ è‡ªå‹•ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°
```

### 2. æ¨©é™æ˜‡æ ¼
```
ç”³è«‹ â†’ SuperAdminæ‰¿èª â†’ æ¨©é™å¤‰æ›´ â†’ ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²
```

### 3. å•é¡Œå¯¾å¿œ
```
ãƒ›ãƒ†ãƒ« â†’ ä»£ç†åº— â†’ SuperAdmin (ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
```

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### Phase 2: è©³ç´°æ¨©é™åˆ¶å¾¡
- æ©Ÿèƒ½ãƒ¬ãƒ™ãƒ«ã§ã®ç´°ã‹ã„æ¨©é™è¨­å®š
- ã‚«ã‚¹ã‚¿ãƒ æ¨©é™ãƒ­ãƒ¼ãƒ«ä½œæˆ
- ä¸€æ™‚çš„æ¨©é™ä»˜ä¸æ©Ÿèƒ½

### Phase 3: é«˜åº¦ãªåˆ†æ
- æ¨©é™ä½¿ç”¨çŠ¶æ³åˆ†æ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯è©•ä¾¡
- è‡ªå‹•æ¨©é™æœ€é©åŒ–

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´1æœˆ15æ—¥
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æ‹…å½“**: OmotenasuAIé–‹ç™ºãƒãƒ¼ãƒ  