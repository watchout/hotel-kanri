# ガチャメニュー結果表示オプション仕様書

## 概要
ガチャメニュー機能に「結果表示タイプ」の設定を追加し、ガチャの結果をすぐに表示するか、商品が届くまで非表示にするかを選択できるようにする機能です。

## 背景
ガチャメニューの醍醐味として、注文した商品が届くまで何が当たったかわからない「サプライズ」タイプのガチャを提供したいというユーザー要望があります。現在のシステムでは、ガチャを引いた時点で結果が表示されますが、この変更により、ホテルの運営方針に応じて結果表示方法を選択できるようになります。

## 実装方法

### データベース変更（申請中）
GachaMenuテーブルに新しいフィールドを追加する予定です：

```prisma
model GachaMenu {
  // 既存フィールド

  // 追加予定フィールド
  resultDisplayType String   @default("immediate") // "immediate" または "surprise"
}
```

### 暫定対応
データベーススキーマ変更が承認されるまでの暫定対応として、フロントエンドでの表示制御を実装します：

1. ガチャメニューのメタデータとして表示タイプ情報を保持
2. ガチャ実行時にクライアント側で表示/非表示を制御

### 表示タイプの種類

1. **即時表示（immediate）**
   - ガチャを引いた直後に結果を表示
   - ユーザーはすぐに何が当たったかを確認できる
   - カートに追加する前に結果を確認できる

2. **サプライズ表示（surprise）**
   - ガチャを引いた時点では結果を表示しない
   - 「???(お楽しみ)」などの表示でカートに追加
   - 商品が届いて初めて何が当たったかがわかる
   - 注文履歴画面でも結果を非表示にする

## ユーザーインターフェース
ガチャメニュー管理画面に「結果表示タイプ」の選択肢を追加します：

- ラジオボタン形式で選択
  - [ ] 即時表示（引いた直後に結果を表示）
  - [ ] サプライズ表示（届くまで結果を非表示）

## ユーザー体験フロー

### 即時表示タイプの場合
1. ユーザーがガチャを引く
2. 結果画面で当選商品が表示される
3. ユーザーは結果を見てからカートに追加するか決める
4. カートには通常商品として表示（当選商品名が表示される）

### サプライズ表示タイプの場合
1. ユーザーがガチャを引く
2. 「ガチャ成功！何が当たるかはお届け時のお楽しみ」などのメッセージを表示
3. カートには「〇〇ガチャ（お楽しみ）」として表示
4. 注文確定後も結果は非表示
5. 商品が届いて初めて何が当たったかがわかる

## 技術的な実装方針

### フロントエンド（暫定対応）
1. ガチャメニューオブジェクトに `displayType` プロパティを追加（UI用）
2. ガチャ実行コンポーネントで表示タイプに応じた分岐処理
3. カート表示ロジックの変更（サプライズタイプの場合は商品名を隠す）

### バックエンド（DB変更後）
1. GachaMenu モデルに `resultDisplayType` フィールドを追加
2. ガチャ実行APIで表示タイプに応じたレスポンス制御
3. 注文履歴APIでも表示タイプに応じた情報制御

## 注意事項
- サプライズタイプの場合でも、キッチン/スタッフ向け画面では実際の商品情報を表示する必要がある
- アレルギー情報などの安全性に関わる情報は常に表示する
- 注文履歴のエクスポートや管理者画面では実際の商品情報を表示する

## 今後の拡張可能性
- 複数のサプライズ演出パターンの追加
- ガチャ結果の共有機能
- 当選確率の表示オプション
