# キャンペーン機能テストガイド

## 概要

このドキュメントでは、hotel-saasプロジェクトに実装されたキャンペーン機能のテスト手順を説明します。キャンペーン機能は、hotel-common側のAPIを使用して実装されており、以下の主要コンポーネントから構成されています：

1. キャンペーン管理画面
2. 商品カードでのキャンペーン価格表示
3. トップページのキャンペーンバナー
4. ウェルカムスクリーン

## テスト環境の準備

### 1. 環境変数の設定

`.env`ファイルに以下の設定が含まれていることを確認してください：

```
# 統合サーバー接続設定
HOTEL_COMMON_API_URL=http://localhost:3400/api/v1

# キャンペーン機能設定
ENABLE_CAMPAIGN=true

# ウェルカムスクリーン設定
ENABLE_WELCOME_SCREEN=true
```

### 2. hotel-common APIサーバーの起動

キャンペーン機能はhotel-common側のAPIに依存しているため、APIサーバーが起動していることを確認してください：

```bash
cd /Users/kaneko/hotel-common
npm run dev
```

### 3. hotel-saasの起動

```bash
cd /Users/kaneko/hotel-saas
npm run dev
```

## テスト項目

### 1. キャンペーン管理画面テスト

#### 1.1. キャンペーン一覧画面

1. 管理者としてログイン
2. `/admin/campaigns`にアクセス
3. キャンペーン一覧が表示されることを確認
4. フィルタリングとソート機能が正常に動作することを確認

**期待される結果**: キャンペーン一覧が表示され、フィルタリングとソートが機能する

#### 1.2. キャンペーン作成

1. キャンペーン一覧画面で「新規キャンペーン」ボタンをクリック
2. 以下の情報を入力：
   - キャンペーン名: `テストキャンペーン`
   - 説明: `テスト用のキャンペーンです`
   - 開始日時: 現在から1日後
   - 終了日時: 現在から30日後
   - 割引タイプ: `percentage`
   - 割引値: `20`
   - ステータス: 有効
3. 「作成」ボタンをクリック

**期待される結果**: キャンペーンが作成され、編集画面に遷移する

#### 1.3. キャンペーン編集

1. 作成したキャンペーンの編集画面で情報を変更：
   - 説明: `更新されたテスト用キャンペーン`
   - 割引値: `25`
2. 「保存」ボタンをクリック

**期待される結果**: キャンペーン情報が更新され、一覧画面に遷移する

#### 1.4. キャンペーン削除

1. キャンペーン一覧で作成したキャンペーンの削除ボタンをクリック
2. 確認ダイアログで「削除する」をクリック

**期待される結果**: キャンペーンが削除され、一覧から消える

### 2. 商品カードでのキャンペーン価格表示テスト

#### 2.1. キャンペーン設定

1. 管理者画面でキャンペーンを作成（開始日時は現在日時より前、終了日時は後）
2. 特定のカテゴリーに適用されるよう設定

#### 2.2. 商品カード表示確認

1. `/menu`にアクセス
2. キャンペーン対象カテゴリーの商品カードを確認

**期待される結果**:
- キャンペーン対象商品に割引バッジが表示される
- 通常価格が打ち消し線で表示され、キャンペーン価格が赤色で表示される

### 3. トップページのキャンペーンバナーテスト

#### 3.1. アクティブキャンペーンがある場合

1. アクティブなキャンペーンを作成
2. トップページ（`/`）にアクセス

**期待される結果**: アクティブなキャンペーンがバナーとして表示される

#### 3.2. アクティブキャンペーンがない場合

1. すべてのキャンペーンを無効化または削除
2. トップページにアクセス

**期待される結果**: デフォルトのキャンペーンカードが表示される

### 4. ウェルカムスクリーンテスト

#### 4.1. ウェルカムスクリーン表示

1. ウェルカムスクリーン設定を作成
2. `/welcome-screen?deviceId=test-device&roomId=test-room`にアクセス

**期待される結果**: ウェルカムスクリーンが表示される

#### 4.2. 多言語テスト

1. ウェルカムスクリーンに多言語設定を追加
2. 言語を切り替えて表示を確認

**期待される結果**: 選択した言語でコンテンツが表示される

## テスト自動化

### APIテスト

キャンペーンAPIの自動テストを実行するには：

```bash
npm run test:api -- --filter=campaign
```

### E2Eテスト

キャンペーン機能のE2Eテストを実行するには：

```bash
npm run test:e2e -- --spec=campaign
```

## トラブルシューティング

### APIエラーの場合

1. hotel-common APIサーバーが起動していることを確認
2. `.env`ファイルの`HOTEL_COMMON_API_URL`が正しく設定されていることを確認
3. ブラウザのコンソールでネットワークエラーを確認

### 表示の問題

1. キャンペーンが有効期間内であることを確認
2. キャンペーンのステータスが「有効」に設定されていることを確認
3. ブラウザのキャッシュをクリア

### コンポーネントエラーの対処

管理画面で以下のエラーが表示される場合：

```
Failed to resolve component: LoadingBlock
Failed to resolve component: ConfirmModal
```

これらは共通コンポーネントへのパス解決エラーです。以下の対処法を試してください：

1. **共通コンポーネントのインポート**

   管理画面コンポーネントで明示的にインポートを追加します：

   ```vue
   <script setup>
   import LoadingBlock from '~/components/common/LoadingBlock.vue'
   import ConfirmModal from '~/components/common/ConfirmModal.vue'
   </script>
   ```

2. **代替コンポーネントの使用**

   独自のローディングコンポーネントやモーダルを実装することで問題を回避できます。

3. **Nuxtの自動インポート設定の確認**

   `nuxt.config.ts`の`components`設定を確認し、必要に応じて更新します：

   ```typescript
   export default defineNuxtConfig({
     components: {
       dirs: [
         '~/components',
         '~/components/common'
       ]
     }
   })
   ```

## 注意事項

- キャンペーン機能はhotel-common側のAPIに依存しているため、APIサーバーが起動していない場合、機能は動作しません
- キャンペーンの日時は、サーバーのタイムゾーンに依存します
- 多言語対応は、`locales/ja.json`と`locales/en.json`に定義されています
