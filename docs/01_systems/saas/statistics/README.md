# 統計・分析機能 ドキュメント

## 📊 概要

Hotel SaaSプロジェクトの統計・分析機能は、ホテルオーダーシステムから収集されるデータを経営の視点からマーケティング活用するために設計された包括的な分析ツールです。

## 🎯 目的

1. **経営判断支援**: データドリブンな意思決定を支援
2. **マーケティング活用**: 顧客動向の把握と戦略策定
3. **運営効率化**: オペレーション最適化のための洞察提供
4. **収益最大化**: 利益構造の分析と改善策の発見

## 📋 機能一覧

### ✅ **実装済み機能（フェーズ1）**

#### **1. ダッシュボード - KPI概要**
- 総注文数
- 総売上
- 平均客単価
- アクティブ客室数

#### **2. 基本統計API**
- `/api/v1/admin/statistics/kpis.get.ts` - KPI統計取得
- `/api/v1/admin/statistics/popular-products.get.ts` - 商品分析

#### **3. 商品分析**
- 注文数ベースのランキング
- 売上貢献度の可視化
- 期間指定での分析（7日・30日・90日）

### 🚧 **実装予定機能（フェーズ2-4）**

#### **フェーズ2: 時間帯・曜日分析**
- [ ] 時間帯別注文分析（朝・昼・夕・深夜）
- [ ] 曜日別注文傾向
- [ ] 季節別分析
- [ ] ピーク時間帯の特定

#### **フェーズ3: 客室・顧客分析**
- [ ] 客室ランク別注文傾向
- [ ] 宿泊期間別注文パターン
- [ ] リピーター分析
- [ ] チェックイン・アウト時間との関連分析

#### **フェーズ4: 高度な分析機能**
- [ ] クロスセル・アップセル分析
- [ ] 顧客満足度関連データ
- [ ] パーソナライズドマーケティングデータ
- [ ] 予測分析（AI/機械学習）

## 🔧 技術仕様

### **データベース構造**

```sql
-- 主要テーブル
Order (注文)
├── id, roomId, placeId, status, total, createdAt
└── items (JSON), paidAt, isDeleted

OrderItem (注文詳細)
├── orderId, menuItemId, name, price, quantity
└── status, deliveredAt, createdAt

MenuItem (商品)
├── id, name_ja, price, categoryId
└── isDeleted, showRanking*, createdAt

Place (客室/プレイス)
├── id, code, name, placeTypeId
└── attributes (JSON), capacity, area

DeviceAccessLog (アクセスログ)
└── deviceId, accessTime, pagePath, sessionId
```

### **API エンドポイント**

#### **実装済み**
```typescript
GET /api/v1/admin/statistics/kpis
// パラメータ: period (7|30|90)
// レスポンス: { totalOrders, totalRevenue, averageOrderValue, activeRooms }

GET /api/v1/admin/statistics/popular-products  
// パラメータ: period, limit
// レスポンス: [{ id, name, orderCount, revenue, orderFrequency }]
```

#### **実装予定**
```typescript
GET /api/v1/admin/statistics/time-analysis
GET /api/v1/admin/statistics/room-analysis
GET /api/v1/admin/statistics/cross-sell-analysis
GET /api/v1/admin/statistics/customer-satisfaction
```

## 📊 分析データ項目詳細

### **1. 基本注文データ**
| 項目 | 説明 | 実装状況 |
|------|------|----------|
| 注文日時・時間帯 | 24時間での注文パターン分析 | 🚧 予定 |
| 曜日・季節別傾向 | 週次・月次での需要変動 | 🚧 予定 |
| 客室番号・ランク | 客室属性と注文傾向の関連 | 🚧 予定 |
| 注文アイテム | 商品レベルでの詳細分析 | ✅ 完了 |

### **2. 売上分析データ**
| 項目 | 説明 | 実装状況 |
|------|------|----------|
| 売上金額 | 期間別総売上・平均客単価 | ✅ 完了 |
| 利益率分析 | 商品別原価率・利益構造 | 🚧 予定 |
| セット商品効果 | バンドル販売の効果測定 | 🚧 予定 |

### **3. 商品分析**
| 項目 | 説明 | 実装状況 |
|------|------|----------|
| 人気商品ランキング | 注文数・売上ベース | ✅ 完了 |
| 季節限定商品評価 | 期間限定商品の効果測定 | 🚧 予定 |
| 廃棄率・返品率 | 品質・提供問題の発見 | 🚧 予定 |

### **4. クロスセル分析**
| 項目 | 説明 | 実装状況 |
|------|------|----------|
| 注文組み合わせ | 一緒に注文される商品パターン | 🚧 予定 |
| 追加注文タイミング | リピート注文の行動分析 | 🚧 予定 |

## 🎨 UI/UX設計

### **ダッシュボード構成**
```
統計・分析ダッシュボード
├── ヘッダー（期間選択・更新ボタン）
├── KPI概要カード（4項目）
└── 分析タブ
    ├── 時間帯別分析
    ├── 商品分析
    └── 客室分析
```

### **デザインパターン**
- **カラーテーマ**: Blue系統（統一感）
- **レスポンシブ**: モバイル対応
- **アクセシビリティ**: WCAG 2.1準拠
- **データ可視化**: Chart.js/D3.js使用予定

## 🚀 実装ロードマップ

### **Phase 1: 基本機能** (✅ 完了)
- [x] ダッシュボード画面作成
- [x] KPI統計API実装
- [x] 商品分析
- [x] サイドバー統合

### **Phase 2: 時間分析** (📅 次期)
- [ ] 時間帯別分析API
- [ ] 曜日別分析機能
- [ ] グラフ表示機能（Chart.js導入）
- [ ] CSV エクスポート機能

### **Phase 3: 客室分析** (📅 予定)
- [ ] 客室別注文分析
- [ ] プレイスタイプ別分析
- [ ] 宿泊期間との関連分析

### **Phase 4: 高度分析** (📅 予定)
- [ ] クロスセル分析
- [ ] 顧客満足度分析
- [ ] 予測分析（機械学習）
- [ ] レコメンド機能

## 💼 活用例

### **経営戦略への活用**
1. **需要予測**: 過去データから将来の需要を予測
2. **価格戦略**: 人気商品の価格最適化
3. **商品開発**: 顧客ニーズに基づく新商品企画
4. **マーケティング**: ターゲット顧客の特定と施策設計

### **オペレーション改善**
1. **スタッフ配置**: ピーク時間に合わせた人員計画
2. **在庫管理**: 需要予測に基づく適正在庫
3. **メニュー最適化**: 売れ筋商品の露出強化
4. **サービス改善**: 配達時間・顧客満足度の改善

## 🔐 セキュリティ・プライバシー

### **データ保護**
- 個人情報の匿名化処理
- アクセス権限の階層管理
- 監査ログの記録
- GDPR準拠のデータ取扱い

### **アクセス制御**
- 管理者権限での統計機能アクセス
- API認証・認可の実装
- セッション管理の強化

## 📈 パフォーマンス最適化

### **データベース最適化**
- インデックス戦略
- クエリ最適化
- データアーカイブ戦略
- リアルタイム集計の実装

### **フロントエンド最適化**
- データの段階的読み込み
- キャッシュ戦略
- 非同期処理の活用

## 🧪 テスト戦略

### **単体テスト**
- API エンドポイントのテスト
- 統計計算ロジックの検証
- エラーハンドリングの確認

### **統合テスト**
- フロントエンド・バックエンド連携
- データ整合性の確認
- パフォーマンステスト

## 📚 参考資料

### **技術スタック**
- **フロントエンド**: Vue 3, Nuxt 3, TypeScript
- **バックエンド**: Nuxt Server API, Prisma ORM
- **データベース**: SQLite (開発), PostgreSQL (本番)
- **可視化**: Chart.js, D3.js (予定)

### **設計原則**
- データドリブン設計
- スケーラブルアーキテクチャ
- ユーザビリティ重視
- セキュリティファースト

---

## 📞 サポート・問い合わせ

実装に関する質問や要望については、開発チームまでお問い合わせください。

**更新履歴**
- 2024/XX/XX: 初版作成
- 2024/XX/XX: フェーズ1実装完了 