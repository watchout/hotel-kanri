# çµ±è¨ˆãƒ»åˆ†ææ©Ÿèƒ½ æŠ€è¡“ä»•æ§˜æ›¸

## ğŸ“‹ ç›®æ¬¡
1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
3. [APIä»•æ§˜](#apiä»•æ§˜)
4. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ)
5. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶)
6. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶)

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### **ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰   â”‚    â”‚    APIãƒ¬ã‚¤ãƒ¤ãƒ¼    â”‚    â”‚   ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ Vue 3 + Nuxt 3  â”‚â—„â”€â”€â–ºâ”‚ Nuxt Server API â”‚â—„â”€â”€â–ºâ”‚  SQLite/Prisma  â”‚
â”‚ TypeScript      â”‚    â”‚ TypeScript      â”‚    â”‚                 â”‚
â”‚ Chart.js        â”‚    â”‚ Prisma Client   â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ãƒ¬ã‚¤ãƒ¤ãƒ¼è²¬å‹™**

#### **ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤**
- çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤º
- ã‚°ãƒ©ãƒ•ãƒ»ãƒãƒ£ãƒ¼ãƒˆã®æç”»
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

#### **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤**
- çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®é›†è¨ˆãƒ»è¨ˆç®—
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é©ç”¨
- ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ»æ•´å½¢
- èªè¨¼ãƒ»èªå¯

#### **ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤**
- Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
- ã‚¯ã‚¨ãƒªæœ€é©åŒ–
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†
- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### **çµ±è¨ˆé–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«**

#### **æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ´»ç”¨**
```sql
-- æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼‰
Order {
  id: Int @id
  roomId: String        -- å®¢å®¤è­˜åˆ¥
  placeId: Int?         -- ãƒ—ãƒ¬ã‚¤ã‚¹é–¢é€£ï¼ˆãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°åˆ†æç”¨ï¼‰
  status: String        -- æ³¨æ–‡çŠ¶æ…‹
  total: Int           -- æ³¨æ–‡ç·é¡
  createdAt: DateTime  -- æ³¨æ–‡æ—¥æ™‚ï¼ˆé‡è¦ãªåˆ†æè»¸ï¼‰
  items: Json          -- æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ è©³ç´°
  isDeleted: Boolean
}

-- æ³¨æ–‡ã‚¢ã‚¤ãƒ†ãƒ è©³ç´°
OrderItem {
  id: Int @id
  orderId: Int
  menuItemId: Int      -- å•†å“IDï¼ˆäººæ°—å•†å“åˆ†æç”¨ï¼‰
  name: String         -- å•†å“å
  price: Int           -- å˜ä¾¡
  quantity: Int        -- æ•°é‡
  status: String
  deliveredAt: DateTime? -- é…é”å®Œäº†æ™‚åˆ»ï¼ˆé…é”æ™‚é–“åˆ†æç”¨ï¼‰
  createdAt: DateTime
}

-- å•†å“ãƒã‚¹ã‚¿
MenuItem {
  id: Int @id
  name_ja: String      -- æ—¥æœ¬èªå•†å“å
  price: Int           -- åŸºæº–ä¾¡æ ¼
  categoryId: Int?     -- ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥åˆ†æç”¨ï¼‰
  showRankingDay: Boolean    -- æ—¥æ¬¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºãƒ•ãƒ©ã‚°
  showRankingWeek: Boolean   -- é€±æ¬¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºãƒ•ãƒ©ã‚°
  showRankingMonth: Boolean  -- æœˆæ¬¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºãƒ•ãƒ©ã‚°
  isDeleted: Boolean
}

-- ãƒ—ãƒ¬ã‚¤ã‚¹æƒ…å ±
Place {
  id: Int @id
  code: String @unique  -- å®¢å®¤ç•ªå·
  name: String          -- è¡¨ç¤ºå
  placeTypeId: Int      -- ãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ï¼ˆå®¢å®¤ãƒ©ãƒ³ã‚¯åˆ†æç”¨ï¼‰
  attributes: Json?     -- è¿½åŠ å±æ€§ï¼ˆåå®¹äººæ•°ã€é¢ç©ç­‰ï¼‰
  capacity: Int?        -- åå®¹äººæ•°
  area: Float?          -- é¢ç©
}
```

#### **çµ±è¨ˆå°‚ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå°†æ¥è¿½åŠ äºˆå®šï¼‰**
```sql
-- æ—¥æ¬¡çµ±è¨ˆã‚µãƒãƒªãƒ¼ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šç”¨ï¼‰
DailyStatsSummary {
  id: Int @id
  date: DateTime @unique
  totalOrders: Int
  totalRevenue: Int
  averageOrderValue: Int
  activeRooms: Int
  topProductId: Int?
  createdAt: DateTime
}

-- æ™‚é–“å¸¯åˆ¥çµ±è¨ˆ
HourlyStats {
  id: Int @id
  date: DateTime
  hour: Int            -- 0-23
  orderCount: Int
  revenue: Int
  averageOrderValue: Int
  @@unique([date, hour])
}
```

### **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥**
```sql
-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
@@index([createdAt])           -- æ™‚ç³»åˆ—åˆ†æç”¨
@@index([roomId, createdAt])   -- å®¢å®¤åˆ¥æ™‚ç³»åˆ—åˆ†æç”¨
@@index([placeId])             -- ãƒ—ãƒ¬ã‚¤ã‚¹åˆ†æç”¨
@@index([menuItemId])          -- å•†å“åˆ†æç”¨
@@index([status])              -- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥åˆ†æç”¨
```

## ğŸ”Œ APIä»•æ§˜

### **å®Ÿè£…æ¸ˆã¿ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**

#### **KPIçµ±è¨ˆå–å¾—**
```typescript
GET /api/v1/admin/statistics/kpis

// ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
interface KpisQuery {
  period: '7' | '30' | '90'  // åˆ†ææœŸé–“ï¼ˆæ—¥æ•°ï¼‰
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface KpisResponse {
  totalOrders: number        // ç·æ³¨æ–‡æ•°
  totalRevenue: number       // ç·å£²ä¸Šï¼ˆå††ï¼‰
  averageOrderValue: number  // å¹³å‡å®¢å˜ä¾¡ï¼ˆå††ï¼‰
  activeRooms: number        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å®¢å®¤æ•°
}

// å®Ÿè£…è©³ç´°
// - æŒ‡å®šæœŸé–“å†…ã®æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
// - å‰Šé™¤æ¸ˆã¿æ³¨æ–‡ã¯é™¤å¤–
// - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å®¢å®¤ã¯æ³¨æ–‡å®Ÿç¸¾ã®ã‚ã‚‹å®¢å®¤ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
```

#### **äººæ°—å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚°**
```typescript
GET /api/v1/admin/statistics/popular-products

// ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
interface PopularProductsQuery {
  period: '7' | '30' | '90'  // åˆ†ææœŸé–“
  limit?: number             // å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ10ï¼‰
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface PopularProduct {
  id: number           // å•†å“ID
  name: string         // å•†å“åï¼ˆæ—¥æœ¬èªå„ªå…ˆï¼‰
  orderCount: number   // æ³¨æ–‡æ•°é‡ã®åˆè¨ˆ
  revenue: number      // å£²ä¸Šè²¢çŒ®åº¦
  orderFrequency: number // æ³¨æ–‡é »åº¦ï¼ˆæ³¨æ–‡å›æ•°ï¼‰
}

type PopularProductsResponse = PopularProduct[]
```

### **å®Ÿè£…äºˆå®šã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**

#### **æ™‚é–“å¸¯åˆ¥åˆ†æ**
```typescript
GET /api/v1/admin/statistics/time-analysis

interface TimeAnalysisQuery {
  period: '7' | '30' | '90'
  groupBy: 'hour' | 'dayOfWeek' | 'month'
}

interface TimeAnalysisResponse {
  timeSlots: Array<{
    period: string       // "0-1", "Monday", "2024-01" ãªã©
    orderCount: number
    revenue: number
    averageOrderValue: number
    popularProducts: PopularProduct[]
  }>
  peakHours: number[]   // ãƒ”ãƒ¼ã‚¯æ™‚é–“å¸¯
  trends: {
    growth: number      // æˆé•·ç‡
    seasonality: number // å­£ç¯€æ€§æŒ‡æ•°
  }
}
```

#### **å®¢å®¤åˆ†æ**
```typescript
GET /api/v1/admin/statistics/room-analysis

interface RoomAnalysisQuery {
  period: '7' | '30' | '90'
  placeTypeId?: number  // ç‰¹å®šãƒ—ãƒ¬ã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã®ã¿
}

interface RoomAnalysisResponse {
  roomStats: Array<{
    roomId: string
    roomName: string
    placeType: string
    orderCount: number
    revenue: number
    averageOrderValue: number
    lastOrderDate: string
  }>
  placeTypeComparison: Array<{
    placeTypeId: number
    placeTypeName: string
    averageRevenue: number
    orderFrequency: number
  }>
}
```

### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```typescript
// å…±é€šã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
interface ErrorResponse {
  statusCode: number
  statusMessage: string
  error?: string
}

// ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹
// 400: ä¸æ­£ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
// 401: èªè¨¼ã‚¨ãƒ©ãƒ¼
// 403: æ¨©é™ä¸è¶³
// 500: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
```

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­è¨ˆ

### **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ**
```
pages/admin/statistics/
â”œâ”€â”€ index.vue              -- ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”œâ”€â”€ time-analysis.vue      -- æ™‚é–“å¸¯åˆ¥åˆ†æï¼ˆäºˆå®šï¼‰
â”œâ”€â”€ room-analysis.vue      -- å®¢å®¤åˆ†æï¼ˆäºˆå®šï¼‰
â””â”€â”€ components/
    â”œâ”€â”€ KpiCards.vue       -- KPIæ¦‚è¦ã‚«ãƒ¼ãƒ‰
    â”œâ”€â”€ PopularProducts.vue -- äººæ°—å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«
    â”œâ”€â”€ TimeChart.vue      -- æ™‚é–“å¸¯åˆ¥ã‚°ãƒ©ãƒ•ï¼ˆäºˆå®šï¼‰
    â””â”€â”€ RoomChart.vue      -- å®¢å®¤åˆ†æã‚°ãƒ©ãƒ•ï¼ˆäºˆå®šï¼‰
```

### **çŠ¶æ…‹ç®¡ç†**
```typescript
// composables/useStatistics.ts
interface StatisticsState {
  // æœŸé–“é¸æŠ
  selectedPeriod: Ref<'7' | '30' | '90'>
  
  // ãƒ‡ãƒ¼ã‚¿
  kpis: Ref<KpisResponse | null>
  popularProducts: Ref<PopularProduct[]>
  
  // UIçŠ¶æ…‹
  loading: Ref<boolean>
  activeTab: Ref<string>
  error: Ref<string | null>
}

// ãƒ¡ã‚½ãƒƒãƒ‰
interface StatisticsMethods {
  loadKpis(): Promise<void>
  loadPopularProducts(): Promise<void>
  refreshData(): Promise<void>
  exportToCsv(): Promise<void>
}
```

### **UI/UXãƒ‘ã‚¿ãƒ¼ãƒ³**
```vue
<!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ -->
<div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
  <!-- KPIã‚«ãƒ¼ãƒ‰ -->
</div>

<!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<nav class="-mb-px flex">
  <button :class="tabClass">æ™‚é–“å¸¯åˆ¥åˆ†æ</button>
  <!-- ... -->
</nav>

<!-- ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« -->
<table class="min-w-full divide-y divide-gray-200">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ãƒœãƒ‡ã‚£ -->
</table>
```

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶

### **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ç›®æ¨™**
| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ç›®æ¨™æ™‚é–“ | æœ€å¤§è¨±å®¹æ™‚é–“ |
|-------------|---------|------------|
| KPIçµ±è¨ˆ | < 200ms | < 500ms |
| äººæ°—å•†å“ | < 300ms | < 800ms |
| æ™‚é–“å¸¯åˆ¥åˆ†æ | < 500ms | < 1500ms |

### **æœ€é©åŒ–æˆ¦ç•¥**

#### **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**
```sql
-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_orders_created_at ON Order(createdAt);
CREATE INDEX idx_orders_room_created ON Order(roomId, createdAt);
CREATE INDEX idx_order_items_menu_id ON OrderItem(menuItemId);

-- ã‚¯ã‚¨ãƒªæœ€é©åŒ–ä¾‹
-- æ‚ªã„ä¾‹ï¼šN+1ã‚¯ã‚¨ãƒª
-- è‰¯ã„ä¾‹ï¼šJOINã«ã‚ˆã‚‹ä¸€æ‹¬å–å¾—
SELECT oi.*, mi.name_ja 
FROM OrderItem oi
JOIN MenuItem mi ON oi.menuItemId = mi.id
WHERE oi.orderId IN (...)
```

#### **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**
```typescript
// APIãƒ¬ãƒ™ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
const cacheKey = `kpis:${period}:${date}`
const cached = await redis.get(cacheKey)
if (cached) return JSON.parse(cached)

// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥
const { data, refresh } = await useLazyFetch('/api/v1/admin/statistics/kpis', {
  key: `kpis-${period}`,
  server: false
})
```

#### **ãƒ‡ãƒ¼ã‚¿é‡åˆ¶é™**
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯éåŒæœŸå‡¦ç†
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã¯ WebSocketä½¿ç”¨æ¤œè¨

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

### **èªè¨¼ãƒ»èªå¯**
```typescript
// ç®¡ç†ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
definePageMeta({
  layout: 'admin',
  middleware: ['auth', 'admin-only']  // ç®¡ç†è€…æ¨©é™å¿…é ˆ
})

// APIèªè¨¼
export default defineEventHandler(async (event) => {
  // JWTãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
  const token = getCookie(event, 'auth-token')
  const user = await verifyToken(token)
  
  if (!user || !user.isAdmin) {
    throw createError({
      statusCode: 403,
      statusMessage: 'ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“'
    })
  }
  
  // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å‡¦ç†...
})
```

### **ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼**
```typescript
// å€‹äººæƒ…å ±ã®é™¤å¤–
const anonymizedData = {
  roomId: order.roomId,           // OK: å®¢å®¤ç•ªå·ã¯åˆ†æã«å¿…è¦
  customerName: undefined,        // NG: å€‹äººåã¯é™¤å¤–
  customerPhone: undefined,       // NG: é›»è©±ç•ªå·ã¯é™¤å¤–
  revenue: order.total,           // OK: å£²ä¸Šãƒ‡ãƒ¼ã‚¿
  items: order.items.map(item => ({
    name: item.name,              // OK: å•†å“å
    quantity: item.quantity,      // OK: æ•°é‡
    // å€‹äººç‰¹å®šæƒ…å ±ã¯é™¤å¤–
  }))
}
```

### **ç›£æŸ»ãƒ­ã‚°**
```typescript
// çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¥æ­´
await prisma.adminAccessLog.create({
  data: {
    path: '/api/v1/admin/statistics/kpis',
    method: 'GET',
    userId: user.id,
    ipAddress: getClientIP(event),
    userAgent: getHeader(event, 'user-agent'),
    createdAt: new Date()
  }
})
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆä»•æ§˜

### **å˜ä½“ãƒ†ã‚¹ãƒˆ**
```typescript
// tests/api/statistics.test.ts
describe('Statistics API', () => {
  test('KPIçµ±è¨ˆå–å¾—', async () => {
    const response = await $fetch('/api/v1/admin/statistics/kpis?period=7')
    
    expect(response).toMatchObject({
      totalOrders: expect.any(Number),
      totalRevenue: expect.any(Number),
      averageOrderValue: expect.any(Number),
      activeRooms: expect.any(Number)
    })
    
    expect(response.totalOrders).toBeGreaterThanOrEqual(0)
    expect(response.averageOrderValue).toBeGreaterThanOrEqual(0)
  })
})
```

### **çµ±åˆãƒ†ã‚¹ãƒˆ**
```typescript
// tests/integration/statistics.test.ts
describe('çµ±è¨ˆæ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆ', () => {
  test('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º', async () => {
    // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
    await createTestOrders(10)
    
    // ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹
    const page = await browser.newPage()
    await page.goto('/admin/statistics')
    
    // KPIã‚«ãƒ¼ãƒ‰è¡¨ç¤ºç¢ºèª
    await expect(page.locator('[data-testid="kpi-total-orders"]')).toBeVisible()
    await expect(page.locator('[data-testid="kpi-total-revenue"]')).toBeVisible()
    
    // ãƒ‡ãƒ¼ã‚¿æ›´æ–°ç¢ºèª
    await page.click('[data-testid="refresh-button"]')
    await page.waitForLoadState('networkidle')
  })
})
```

## ğŸ“Š ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ç›£è¦–

### **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**
```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
const startTime = Date.now()
const result = await statisticsCalculation()
const duration = Date.now() - startTime

// ãƒ¡ãƒˆãƒªã‚¯ã‚¹é€ä¿¡ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
await sendMetrics({
  name: 'statistics.kpis.duration',
  value: duration,
  tags: { period }
})
```

### **ã‚¨ãƒ©ãƒ¼ç›£è¦–**
```typescript
// ã‚¨ãƒ©ãƒ¼è¿½è·¡
try {
  return await calculateStatistics()
} catch (error) {
  console.error('çµ±è¨ˆè¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error)
  
  // ã‚¨ãƒ©ãƒ¼é€šçŸ¥ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
  await notifyError({
    type: 'statistics_calculation_error',
    error: error.message,
    context: { period, userId }
  })
  
  throw createError({
    statusCode: 500,
    statusMessage: 'çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®è¨ˆç®—ã«å¤±æ•—ã—ã¾ã—ãŸ'
  })
}
```

---

## ğŸ“ å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|----------|
| 2024/XX/XX | v1.0 | åˆç‰ˆä½œæˆ |
| 2024/XX/XX | v1.1 | ãƒ•ã‚§ãƒ¼ã‚º1å®Ÿè£…å®Œäº† | 