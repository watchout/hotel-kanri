# ホテル会員システム開発プロジェクトルール

## 🚨 **【最重要】データベース保護ルール**

### 絶対に守るべき鉄則
- **データベースの削除・リセットは事前承認制**
  - 本番データベース: 絶対に削除禁止
  - 開発データベース: チーム承認が必要
  - テストデータベース: 作業前に必ず通知

### データベース操作の安全規約
```bash
# ❌ 絶対にやってはいけない操作
DROP DATABASE hotel_unified_db;
TRUNCATE TABLE users;
DELETE FROM users WHERE 1=1;

# ✅ 正しい操作手順
# 1. バックアップ作成
# 2. チーム通知
# 3. 作業実行
# 4. 検証完了
```

### データベース環境分離
- **本番環境**: `hotel_unified_db` - 絶対触れない
- **ステージング環境**: `hotel_unified_db` - 慎重に操作  
- **開発環境**: `hotel_unified_db` - 比較的自由だが通知必要
- **個人環境**: `hotel_unified_db` - 個人で管理

---

## 📋 **プロジェクト構成とファイルルール**

### ディレクトリ構造遵守
```
hotel-member/
├── fastapi-backend/           # FastAPI バックエンド
│   ├── app/                   # アプリケーションコード
│   ├── tests/                 # テストコード
│   └── requirements.txt       # 依存関係
├── nuxt-frontend/             # Nuxt.js フロントエンド
│   ├── pages/                 # ページコンポーネント
│   ├── components/            # 再利用可能コンポーネント
│   └── package.json           # 依存関係
├── docs/                      # ドキュメント
└── PROJECT_STATUS.md          # プロジェクト状況
```

### 設定ファイル管理
- **環境変数**: `.env.example`をベースに個人用`.env`作成
- **機密情報**: Gitコミット絶対禁止
- **設定変更**: チーム共有前に影響を確認

---

## 🔒 **セキュリティ・品質ルール**

### パスワード・認証
- **OTP開発時**: コンソール出力使用（メール送信は本番のみ）
- **JWT トークン**: 適切な有効期限設定（開発：長め、本番：短め）
- **テストデータ**: 実際のメールアドレス使用禁止

### コード品質基準
- **FastAPI**: 型ヒント必須、Pydanticモデル使用
- **Nuxt.js**: TypeScript有効、ESLint遵守
- **SQL**: パラメータ化クエリ必須、生SQL最小化

### セキュリティチェックリスト
- [ ] SQLインジェクション対策済み
- [ ] XSS攻撃対策済み
- [ ] 権限チェック実装済み
- [ ] 入力値検証済み
- [ ] エラーハンドリング適切

---

## 🚀 **開発フロー・ワークフロールール**

### Git操作規則
```bash
# ブランチ戦略
main           # 本番用（安定）
develop        # 開発統合用
feature/*      # 機能開発用
hotfix/*       # 緊急修正用

# コミットメッセージ規約
feat: ポイント履歴表示機能を追加
fix: OTP認証のバリデーション修正
docs: API仕様書を更新
refactor: ユーザー管理コードをリファクタリング
```

### 開発順序の遵守
1. **Phase 1**: データベース設計 + API実装
2. **Phase 2**: フロントエンド UI + 管理画面
3. **Phase 3**: 拡張機能（SMS、LINE連携など）

### レビュー必須事項
- データベース設計変更
- セキュリティ関連コード
- 本番環境設定変更
- API仕様変更

---

## 💾 **バックアップ・復旧ルール**

### 自動バックアップ必須
```bash
# データベースバックアップ（日次）
pg_dump hotel_unified_db > backup/hotel_unified_db_$(date +%Y%m%d).sql

# 設定ファイルバックアップ
cp .env backup/.env.$(date +%Y%m%d)
```

### 復旧手順書
1. **障害発生時**: 即座にチーム通知
2. **影響範囲確認**: データ損失の有無チェック
3. **バックアップ復元**: 最新の安全な状態に戻す
4. **原因調査**: 再発防止策の検討

---

## ⚡ **パフォーマンス・効率化ルール**

### 開発効率化
- **ホットリロード活用**: 開発サーバー常時起動
- **API文書自動生成**: FastAPI Swagger UI活用
- **テスト自動化**: CI/CD パイプライン整備

### リソース管理
- **ポート管理**: 
  - フロントエンド: `8080`
  - バックエンド API (member): `3200`  
  - データベース: `5432`
- **メモリ使用量**: 開発時のリソース監視

---

## 🤝 **チーム協力・コミュニケーションルール**

### 必須報告事項
- データベース構造変更
- API仕様変更
- 重要な設計決定
- エラー・障害発生

### 作業進捗共有
- **毎日**: 作業ログをPROJECT_STATUS.mdに記録
- **週次**: 主要な進捗と課題を共有
- **問題発生時**: 即座にチーム通知

### 知識共有
- **技術的な発見**: ドキュメント化して共有
- **設定変更**: 手順書として記録
- **トラブル事例**: 解決方法と共に記録

---

## 🔧 **技術スタック固有ルール**

### FastAPI
- **依存関係**: `requirements.txt`での厳密管理
- **環境分離**: 仮想環境必須使用
- **API設計**: RESTful原則遵守

### Nuxt.js
- **パッケージ管理**: `npm`使用（yarnやpnpm混在禁止）
- **コンポーネント設計**: 再利用性重視
- **状態管理**: Pinia使用、過度な状態避ける

### PostgreSQL
- **接続管理**: コネクションプール使用
- **クエリ最適化**: 定期的なパフォーマンス監視
- **インデックス**: 適切な設計と監視

---

## 📊 **監視・メトリクス**

### 品質メトリクス
- **コードカバレッジ**: 最低70%維持
- **API応答時間**: 平均500ms以下
- **エラー率**: 1%以下

### 定期点検項目
- [ ] データベースバックアップ動作確認
- [ ] セキュリティ設定レビュー  
- [ ] 依存関係脆弱性チェック
- [ ] パフォーマンス監視

---

## ⚠️ **違反時の対応**

### 重大違反（データ損失リスク）
- 即座に作業中断
- チーム緊急ミーティング
- 復旧作業の協力体制

### 軽微違反（コード品質等）
- コードレビューでの指摘
- 修正完了まで次作業停止
- 知識共有による改善

---

## 📝 **このルール書の更新**

- **更新頻度**: プロジェクト進行に応じて随時
- **更新権限**: チーム全員（合意が前提）
- **更新通知**: 必ずチーム全体に連絡

---

**最終更新**: $(date +%Y年%m月%d日)  
**対象プロジェクト**: ホテル会員システム (hotel-member)  
**技術スタック**: FastAPI + Nuxt 3 + PostgreSQL + Prisma ORM

> 💡 **重要**: このルールは「開発を加速する」ためのものです。  
> 形式的な遵守ではなく、チーム全体の生産性向上を目指しましょう。 