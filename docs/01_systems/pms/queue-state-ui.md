# 同期待ちキューのUI設計仕様

## OmotenasuAI PMS "Tsukuyomi"  
同期待ちキュー（非同期送信データ）のUI設計仕様

---

## 🎯 目的

このドキュメントは、Tsukuyomi PMS の**オフライン同期機構（asyncQueue）**において、  
未送信データの状態管理・再送・削除などをUIから安全かつ直感的に行うための**ユーザーインターフェース仕様**を定義します。

---

## 🧱 基本要素構成

### ■ 表示名称：
- **未送信データ一覧**
- メニュー：管理者用 →「同期状態管理」

---

### ■ 画面構成（3カラム構造）

| カラム名 | 内容 |
|----------|------|
| **① データ概要** | 処理種別（チェックイン/日報 etc.）<br>対象部屋番号・日時<br>ステータスラベル（例：queued/failed） |
| **② 詳細確認エリア** | JSON構造を簡易フォーマットで表示<br>差分確認ボタン（クラウドとの差分） |
| **③ 操作ボタン** | 🔁 再送信／🗑 削除／📋 コピー（管理用） |

---

### ■ ステータスラベル

| ステータス | 表示ラベル | 色 | 補足 |
|------------|------------|----|------|
| **queued** | 「未送信」 | グレー | 通信復旧待ち |
| **syncing** | 「送信中」 | 青 | 処理中は操作不可 |
| **synced** | 「同期済み」 | 緑 | 自動で非表示に移動可 |
| **failed** | 「送信失敗」 | 赤 | 手動再送が必要 |
| **conflict** | 「競合発生」 | 黄 | 差分選択が必要（差分確認へ遷移） |

---

### ■ 操作ボタンの仕様

| ボタン | 動作内容 |
|--------|----------|
| **🔁 再送信** | 選択データを即時再送（バックグラウンド処理）<br>成功時は「同期済み」へ移動 |
| **🗑 削除** | ローカルキューから削除（要2段階確認） |
| **📋 コピー** | JSON構造をクリップボードにコピー（問い合わせ・デバッグ用） |
| **👁 差分確認（競合時）** | クラウド側とローカル側のフィールド差分を比較表示 |

---

## 📊 表示項目サンプル（リストビュー）

| 種別 | 対象 | 日時 | ステータス | 操作 |
|------|------|------|------------|------|
| **チェックアウト** | 部屋305 | 2025/07/15 10:02 | 🟥 送信失敗 | 🔁 / 🗑 / 📋 |
| **日報** | フロント1 | 2025/07/14 05:33 | 🟨 競合発生 | 👁 / 🔁 / 🗑 |
| **客室状態更新** | 部屋204 | 2025/07/15 08:45 | ⬜ 未送信 | 🔁 / 🗑 |

---

## 📂 フィルター・ソート機能

- **ソート**: 日付順、種別別、部屋番号順
- **フィルター**: ステータス別絞り込み（未送信／失敗／競合）
- **検索**: 対象ID／部屋番号など

---

## 🔔 通知連携

### 未同期件数の表示
- **未同期件数が1件以上**ある場合：
  - ヘッダーアイコンに「🔔 未送信データあり」バッジ表示

### エラー発生時の通知
- **トースト通知** or **ポップアップ表示**
- **「詳細を見る」ボタン**で当該データをフォーカス表示

---

## 🛡 操作制御・権限

| 操作 | 権限必要 | 備考 |
|------|----------|------|
| **再送** | フロント以上 | 全ユーザーが可（誤操作防止あり） |
| **削除** | 管理者のみ | 要二重確認モーダル |
| **差分選択** | 支配人以上 | 「この変更を適用」「クラウドを優先」などの選択肢を表示 |

---

## ✅ 将来的な拡張（Phase 2〜）

- **同期状態のグラフ表示**（1日の同期件数・失敗率など）
- **一括同期ボタン**（管理画面から「全再送」）
- **同期ステータスのSlack／LINE通知連携**

---

## 📌 開発ノート

- **同期処理連動**: 非同期Queueと連動（sync-flow.md参照）
- **ローカルキャッシュ**: 通信状態が不安定でも描画されるよう、**ローカルキャッシュに基づく**
- **PC専用**: モバイルUI対応は当面不要、PC専用画面 