# Phase ① 利用シーン定義

## OmotenasuAI PMS "Tsukuyomi" ユーザー定義

---

## 🧑‍💼 ① プライマリユーザー（主要利用者）

| ユーザー種別 | 主な役割 | 権限レベル | 利用頻度・時間 | 特記事項 |
|-------------|----------|------------|----------------|----------|
| **フロントスタッフ** | チェックイン／チェックアウトの売上入力、精算、日報入力 | 中〜低 | 1日5〜10回（数分〜30分） | 夜勤スタッフ含む、交代制あり |
| **経理担当** | 日次・月次集計確認、帳票出力、支出入力、レポート作成 | 高 | 毎日30〜60分 | Excel操作がメインの人が多い |
| **マネージャー（支配人）** | 売上把握、稼働率確認、料金戦略判断、スタッフ指導 | 高 | 1日1〜2回（15分程度） | データ分析に弱い人も多い |
| **オーナー／経営者** | 経営判断、KPI確認、費用対効果確認、戦略検討 | 最上位（閲覧中心） | 週1〜月1（30分程度） | UIに簡潔さと説得力が必要 |

---

## 🧹 ② セカンダリユーザー（間接利用者）

| ユーザー種別 | 利用シーン | 利用形態 | 必須/任意 | 備考 |
|-------------|------------|----------|-----------|------|
| **清掃スタッフ** | チェックアウト一覧で部屋状況確認 | 閲覧のみ（スマホor紙出力） | 任意 | タブレットやスマホで参照できると便利 |
| **レストランスタッフ** | 宿泊者数・予約数の参考情報 | 閲覧のみ（人数データ） | 任意 | システム側で人数統計を共有できると◎ |
| **設備保守担当** | 稼働状況やシステムエラー把握 | システムログ参照 or 通知 | 任意 | 自動通知・アラート機能があると理想 |

---

## 🧠 ③ ユーザーのITスキルレベルと教育設計

| ユーザー | ITスキルレベル | 既存システム経験 | トレーニング必要性 |
|----------|----------------|------------------|-------------------|
| **フロント** | ★★☆☆☆（低～中） | 紙台帳または古いPMS | 操作ガイド＋初回レクチャー必須 |
| **経理担当** | ★★★☆☆（中） | Excel／レジ／PMS帳票のみ | 帳票系UIはExcel風に設計 |
| **支配人** | ★★☆☆☆（低～中） | 経験にばらつきあり | グラフやダッシュボードで可視化重視 |
| **経営者** | ★☆☆☆☆（低） | 数字は得意だがUI苦手 | データサマリーや要約レポート中心 |
| **清掃・保守** | ★☆☆☆☆（ほぼなし） | 端末操作に抵抗あり | モバイルUI or 紙出力サポート推奨 |

---

## 🔑 補足設計指針

- **UIは役割別に最適化**（≠一画面で全員共通）
- **ログイン権限は最低でも4段階**（閲覧・入力・管理・経営者）
- **一部モバイル画面対応**（清掃・速報系）
- **チュートリアル搭載** or QRコードで操作動画

---

## 🎯 ユーザー定義から見えた重要ポイント

### UI設計への影響
1. **役割別UI設計**：各ユーザーに最適化された画面構成
2. **権限管理**：4段階以上の詳細な権限設定
3. **モバイル対応**：清掃スタッフ等のモバイル利用

### 機能設計への影響
1. **Excel風UI**：経理担当向けの帳票系インターフェース
2. **可視化重視**：支配人・経営者向けダッシュボード
3. **通知機能**：保守担当向けアラート機能

### 教育・サポート設計への影響
1. **操作ガイド**：ITスキルレベルに応じた説明
2. **チュートリアル**：初回利用者向けガイド
3. **動画説明**：QRコードでのアクセス

---

## 🔧 画面一覧マッピング（Phase 1対応）

### 基本画面一覧（用途・ユーザー別）

| 画面名 | 主な機能 | 利用ユーザー | 想定端末 | 備考 |
|--------|----------|-------------|----------|------|
| **ホームダッシュボード** | 売上、稼働率、客室状況の要約 | 支配人、経営者、経理 | PC（事務所） | サマリ形式、レスポンシブ |
| **チェックイン処理画面** | 宿泊者情報入力、精算、部屋割当 | フロントスタッフ | PC（フロント） | 立ち作業前提、キーボード入力中心 |
| **チェックアウト処理画面** | 追加料金入力、領収書発行 | フロントスタッフ | PC（フロント） | 連続チェックアウト対応UI |
| **日報入力画面** | 日次売上入力、現金過不足入力 | フロント or 経理 | PC（フロント/事務） | 1日1回使用、使いやすさ重視 |
| **日次集計画面** | 売上・部屋別利用実績の確認 | 経理、支配人 | PC（事務） | CSV出力・Excel互換UI |
| **宿泊データ一覧** | 過去の宿泊履歴・編集 | 経理、支配人 | PC | 検索・絞り込みUX重要 |
| **稼働状況一覧（客室ビュー）** | 今日の客室の稼働状況 | フロント、清掃 | タブレット、モバイル | 清掃スタッフ共有も可 |
| **マスタ設定画面** | 料金、部屋タイプ、サービス品目設定 | 支配人、管理者 | PC | 権限制御必須 |
| **アラート・異常通知画面** | 計上漏れ、満室アラートなど | 支配人、経理 | PC + モバイル通知 | LINE通知やポップアップ可 |
| **レポート・帳票出力** | 月次レポート、会計出力 | 経理、経営者 | PC | PDF・CSV出力、印刷用レイアウト |

### 画面一覧から見えた重要ポイント

#### 端末利用パターン
1. **PC中心**：大部分の画面はPC想定
2. **モバイル対応**：稼働状況一覧、通知機能
3. **立ち作業対応**：フロント画面のUI設計

#### 利用頻度パターン
1. **高頻度**：チェックイン/アウト処理
2. **日次**：日報入力、集計確認
3. **随時**：稼働状況確認、通知対応
4. **低頻度**：マスタ設定、月次レポート

---

## 📅 詳細利用状況定義

### 1. 時間帯別利用パターン

#### 1.1 チェックイン処理
- **集中時間帯：** 平日 19:00〜23:00／週末 18:00〜25:00
- **同時利用数：** 1〜2名（フロント）
- **UI要件：**
  - 1画面完結型（タブ切り替え不要）
  - 操作ステップは極力少なく（3クリック以内）

#### 1.2 チェックアウト処理
- **集中時間帯：** 6:00〜11:00
- **連続処理数：** 最大15件/30分（=1件あたり2分以内）
- **UI要件：**
  - 複数チェックアウト処理機能
  - 紙出力のスピードと連携も考慮

#### 1.3 夜勤時の利用
- **主な操作：**
  - 深夜チェックイン
  - 翌日分の仮入力・下書き
  - 緊急アラートの初期対応
- **環境要件：**
  - 暗所でも見やすいダークモード
  - 操作音・通知音の抑制

#### 1.4 日報入力
- **タイミング：** 翌朝 5:00〜9:00
- **締め時間：** 5:00または6:00（任意設定可）
- **担当：** 夜勤者または朝番フロント・経理
- **UI要件：**
  - 自動計算・チェック機能
  - 入力補助・サジェスト機能

#### 1.5 集計確認
- **支配人：** 10:00〜11:00（朝礼・会議前）
- **経理：** 午後帯（13:00〜16:00）
- **必要機能：**
  - 視認性の高いダッシュボード
  - CSV出力、PDF帳票出力

---

### 2. 端末・設置環境

#### 2.1 フロント端末（デスクトップPC）
- **端末構成：** 一体型 or デスクトップPC（21〜24インチ）
- **作業姿勢：** 基本は立ち作業
- **操作：**
  - 主にキーボード＋マウス
  - タッチパネル対応も将来的に検討
- **環境：**
  - 薄暗い照明環境（夜間・朝方）
  - 静音環境を前提としたUI配慮

#### 2.2 モバイル端末（清掃スタッフ等）
- **端末種別：** タブレット（8〜10インチ推奨）
- **通信環境：** Wi-Fiあり／一部死角あり（再同期機能推奨）
- **防水・堅牢性：** ケース使用／落下対策前提

---

### 3. パフォーマンス・同時利用要件

#### 3.1 同時利用・排他処理
- **想定最大同時ユーザー数：** 3〜5人（チェックアウト時）
- **操作重複シーン：**
  - 客室データ編集時の排他制御
  - 同一画面での連携通知対応

#### 3.2 応答速度目安
- **チェックイン/アウト処理：** 1件あたり10秒以内
- **日報入力：** 一画面内完結／補完自動化
- **検索・一覧系：** フィルタ操作から2秒以内に表示

---

### 4. 通知・アラート設計

#### 4.1 通知タイミング
- **日報未提出・未集計：** 翌朝5:00以降に通知
- **満室警告・売上急増：** 前日夜またはリアルタイム

#### 4.2 通知手段
- **管理者：** LINEまたはメール（選択制）
- **現場：** 画面内ポップアップ（全ユーザー共通）

#### 4.3 優先度分類（重要度フラグ）
- **高：** 即時通知＋ログ（例：未集計、金額不整合）
- **中：** ダッシュボード表示＋翌日メール
- **低：** 月次レポート内注記のみ

---

### 5. 実装優先度指針

- 各画面の使用頻度とタイミングをもとにUI/UXの優先実装順位を設定
- ダークモード／ライトモード切り替え機能はPhase 2以降に検討
- スマホサイズ対応は必要最小限（基本はタブレット・PC設計）

---

## 🌐 ネット接続・オフライン対応設計

### 3-1. オフライン対応範囲

#### 完全オフライン利用について
- **Yes（原則）**：基本的な会計処理と帳票系業務は完全オフライン対応を前提
- **技術構成**：ローカルアプリ or Electronベースを想定し、インターネット接続なしでも業務は滞らないことを保証

#### 絶対にオフラインで動作すべき機能

| 機能名 | オフライン対応 | 理由 |
|--------|----------------|------|
| ✅ **チェックイン/アウト処理** | 必須 | フロント業務が最優先、即時対応が必要 |
| ✅ **日報入力** | 必須 | 毎日の締め業務が止まってはいけない |
| ✅ **客室状況確認** | 必須 | 清掃・運営に直結、館内WLANでも動作 |
| 🔄 **AI分析** | 任意（オンライン時のみ） | LLM連携を想定、クラウド必須 |
| 🔔 **通知・連携** | 任意（接続時に処理） | LINE通知・メール通知は復旧時に送信 |

---

### 3-2. データ同期設計

#### 同期タイミング
- **基本**：自動同期（オンライン復旧時）
- **予備**：「手動同期ボタン」も搭載
- **判定方式**：タイムスタンプ＋変更履歴で差分判定

#### データ競合への対処
- **Conflict Handling 方式**：
  - 同一IDでのデータ編集が競合した場合、最新保存時刻を基準
  - 両者の内容を保持 → ユーザーが選択（「差分確認画面」UI予定）

#### 同期エラー対処
- **再試行ロジック**（自動リトライ3回＋ログ記録）
- **手動同期**で「再送信」ボタンを表示
- **非同期送信キュー設計**（IndexedDBまたはローカルファイル）

---

### 3-3. インフラ構成

#### ローカルサーバー構成
- **基本構成**：Electron + SQLite（単一端末）
- **オプション**：小規模LANでのNAS or Raspberry Pi型ローカルDB共有

#### クラウド連携
- **クラウドPMS連携**（Phase 3以降想定）：
  - Push式ではなく、Pull（定期同期）モデル
  - 宿泊データ・売上データを日次で送信

#### バックアップ方式
- **自動ローカルバックアップ**（毎日／JSONまたは暗号化zip）
- **クラウド同期設定**が有効な場合、Google Drive／S3へ自動送信

---

### 3-4. 通信障害時の運用

#### 通知機能
- **オフライン中**は通知を保留
- **復旧後**にまとめてLINE/メール通知送信
- **ローカル端末**では「重要通知一覧」ページで先行表示可能

#### 外部連携サービスの一時停止
- **hotel-saas連携**（予約・会員など）はオフライン中は完全停止
- **復旧時**に「同期処理待ち一覧」画面から個別 or 一括同期

#### 帳票出力
- **Yes**：オフライン時でも出力可
- **PDF出力**（Electron）または印刷機能（ローカル接続プリンタ）

---

### 🧠 オフライン設計アーキテクチャ

| 項目 | 実装方針 |
|------|----------|
| **DB** | SQLite or LowDB（ローカル軽量DB） |
| **UI** | Electronアプリ or PWA（IndexedDB利用） |
| **同期方式** | 差分同期（タイムスタンプ＋ID比較） |
| **バックアップ** | ローカルzip＋クラウドオプション |
| **通信復旧検知** | navigator.onLine + pingルーチン |
| **ログ管理** | 操作ログはすべてローカル保存→同期時送信 | 