# SSOT: ÂÆ¢ÂÆ§Á´ØÊú´WebView„Ç¢„Éó„É™ÔºàGUEST_DEVICE_APPÔºâ

**‰ΩúÊàêÊó•**: 2025-10-15  
**ÊúÄÁµÇÊõ¥Êñ∞**: 2025-10-15  
**„Éê„Éº„Ç∏„Éß„É≥**: v1.0.0  
**„Çπ„ÉÜ„Éº„Çø„Çπ**: ‚úÖ Á¢∫ÂÆö  
**ÂÑ™ÂÖàÂ∫¶**: üî¥ ÊúÄÈ´òÔºàPhase 2 Week 5Ôºâ

**Èñ¢ÈÄ£SSOT**:
- [SSOT_SAAS_DEVICE_AUTHENTICATION.md](../00_foundation/SSOT_SAAS_DEVICE_AUTHENTICATION.md) - „Éá„Éê„Ç§„ÇπË™çË®ºÔºàÂøÖË™≠Ôºâ
- [SSOT_GUEST_ROOM_SERVICE_UI.md](./SSOT_GUEST_ROOM_SERVICE_UI.md) - ÂÆ¢ÂÆ§UIÂÖ®‰Ωì
- [SSOT_GUEST_ORDER_FLOW.md](./SSOT_GUEST_ORDER_FLOW.md) - Ê≥®Êñá„Éï„É≠„Éº
- [SSOT_GUEST_MENU_VIEW.md](./SSOT_GUEST_MENU_VIEW.md) - „É°„Éã„É•„ÉºÈñ≤Ë¶ß
- [SSOT_SAAS_MULTITENANT.md](../00_foundation/SSOT_SAAS_MULTITENANT.md) - „Éû„É´„ÉÅ„ÉÜ„Éä„É≥„ÉàÂü∫Áõ§

**Ê≥®**: Êú¨SSOT„ÅØ**ÂÆ¢ÂÆ§Á´ØÊú´„ÅÆWebView„Ç¢„Éó„É™Âåñ**„ÇíÂÆöÁæ©„Åó„Åæ„Åô„ÄÇCapacitor + Nuxt 3„Å´„Çà„ÇãGoogle TV / Android TV„Ç¢„Éó„É™„ÅÆÊäÄË°ì‰ªïÊßò„Åß„Åô„ÄÇ

---

## üìã ÁõÆÊ¨°

1. [Ê¶ÇË¶Å](#Ê¶ÇË¶Å)
2. [„Ç∑„Çπ„ÉÜ„É†Â¢ÉÁïå](#„Ç∑„Çπ„ÉÜ„É†Â¢ÉÁïå)
3. [ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ](#ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ)
4. [ComposablesÂÆüË£Ö](#composablesÂÆüË£Ö)
5. [Middleware„ÉªAPI](#middlewareapi)
6. [TVÂêë„Åë„Éö„Éº„Ç∏](#tvÂêë„Åë„Éö„Éº„Ç∏)
7. [CapacitorË®≠ÂÆö](#capacitorË®≠ÂÆö)
8. [„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÈÄ£Âãï](#„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÈÄ£Âãï)
9. [WebSocketÈÄ£Êê∫](#websocketÈÄ£Êê∫)
10. [„Çª„Ç≠„É•„É™„ÉÜ„Ç£](#„Çª„Ç≠„É•„É™„ÉÜ„Ç£)
11. [ÂÆüË£Ö„Ç¨„Ç§„Éâ](#ÂÆüË£Ö„Ç¨„Ç§„Éâ)
12. [ÂÆüË£ÖÁä∂Ê≥Å](#ÂÆüË£ÖÁä∂Ê≥Å)

---

## üìñ Ê¶ÇË¶Å

### ÁõÆÁöÑ

hotel-saas„ÅÆÂÆ¢ÂÆ§UI„Çí**Capacitor WebView„Ç¢„Éó„É™**Âåñ„Åó„ÄÅGoogle TV / Android TV„ÅßÂãï‰Ωú„Åô„Çã**„É™„É¢„Ç≥„É≥ÂØæÂøú„Ç¢„Éó„É™**„ÇíGoogle Play„Çπ„Éà„Ç¢„Åã„ÇâÈÖç‰ø°„Åô„Çã„ÄÇ

### Âü∫Êú¨ÊñπÈáù

- **WebView‰∏≠ÂøÉ**: Êó¢Â≠ò„ÅÆNuxt 3 Web„Ç¢„Éó„É™„ÇíWebView„ÅßË°®Á§∫
- **„Éç„Ç§„ÉÜ„Ç£„ÉñÊ©üËÉΩÊúÄÂ∞èÈôê**: ÂøÖË¶ÅÊúÄÂ∞èÈôê„ÅÆ„Éç„Ç§„ÉÜ„Ç£„ÉñÊ©üËÉΩ„ÅÆ„ÅøÂÆüË£Ö
- **„É™„É¢„Ç≥„É≥ÊúÄÈÅ©Âåñ**: Google TV„É™„É¢„Ç≥„É≥„Åß„ÅÆÁõ¥ÊÑüÁöÑÊìç‰Ωú„ÇíÊúÄÂÑ™ÂÖà
- **Êú¨Áï™ÂêåÁ≠âÊÄß**: ÈñãÁô∫Áí∞Â¢É„ÉªÊú¨Áï™Áí∞Â¢É„ÅßÂêå‰∏Ä„ÅÆÂãï‰ΩúÔºà„É¢„ÉÉ„ÇØ„Éª„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁ¶ÅÊ≠¢Ôºâ
- **„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÈÄ£Âãï**: „Ç≤„Çπ„ÉàÊªûÂú®„Å´ÂÆåÂÖ®ÂêåÊúü

### „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£Ê¶ÇË¶Å

```
[ÂÆ¢ÂÆ§TV: Google TV / Android TV]
  ‚Üì Capacitor WebView
[hotel-saas Pages (Nuxt 3)]
  ‚îú‚îÄ /tv/concierge.vue (AI„Ç≥„É≥„Ç∑„Çß„É´„Ç∏„É•)
  ‚îú‚îÄ /tv/settings.vue (Ë®≠ÂÆöÁîªÈù¢)
  ‚îú‚îÄ /order/index.vue (Ê≥®Êñá„É°„Éã„É•„Éº)
  ‚îú‚îÄ /menu/index.vue („É°„Éã„É•„ÉºÈñ≤Ë¶ß)
  ‚îî‚îÄ / („Éõ„Éº„É†ÁîªÈù¢)
[hotel-saas Composables]
  ‚îú‚îÄ useWebView() (WebViewÊ§úÂá∫)
  ‚îú‚îÄ useTVFocus() („É™„É¢„Ç≥„É≥„Éï„Ç©„Éº„Ç´„Çπ)
  ‚îú‚îÄ useDeviceAuth() („Éá„Éê„Ç§„ÇπË™çË®º)
  ‚îú‚îÄ useDeviceCheckin() („ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Âá¶ÁêÜ)
  ‚îî‚îÄ useDeviceReset() („É™„Çª„ÉÉ„ÉàÂá¶ÁêÜ)
[hotel-saas Middleware]
  ‚îî‚îÄ device-guard.ts („Éá„Éê„Ç§„ÇπË™çË®º„Ç¨„Éº„Éâ)
[hotel-saas API (Proxy)]
  ‚Üì POST /api/v1/devices/check-status
  ‚Üì GET /api/v1/devices/client-ip
[hotel-common API (Core)]
  ‚Üì Prisma ORM
[PostgreSQL (Áµ±‰∏ÄDB)]
  ‚îî‚îÄ device_rooms „ÉÜ„Éº„Éñ„É´
```

---

## üéØ „Ç∑„Çπ„ÉÜ„É†Â¢ÉÁïå

### ÂØæË±°„Ç∑„Çπ„ÉÜ„É†

| „Ç∑„Çπ„ÉÜ„É† | ÂΩπÂâ≤ | ÂÆüË£ÖÁØÑÂõ≤ |
|:---------|:-----|:--------|
| **hotel-saas** | WebView„Ç¢„Éó„É™UI | ‚úÖ Pages, Components, Composables, Middleware |
| **hotel-common** | „Éá„Éê„Ç§„ÇπÁÆ°ÁêÜAPI | ‚úÖ „Éá„Éê„Ç§„ÇπË™çË®º„ÉªÁÆ°ÁêÜAPI |
| **Capacitor** | WebViewÁµ±Âêà | ‚úÖ Android WebView + JavaScript Interface |
| **Google Play** | „Ç¢„Éó„É™ÈÖç‰ø° | ‚úÖ AAB„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ |
| **hotel-pms** | Â∞ÜÊù•ÈÄ£Êê∫ | üîÑ ÂõΩÁ±ç„Éá„Éº„ÇøÈÄ£Êê∫ÔºàPhase 4Ôºâ|

### Ê©üËÉΩÁØÑÂõ≤

#### ‚úÖ Êú¨SSOT„ÅÆÂØæË±°

- WebView„Ç¢„Éó„É™ÂÆüË£ÖÔºàCapacitor + Nuxt 3Ôºâ
- „Éá„Éê„Ç§„ÇπË™çË®ºÔºàMAC/IP„Éô„Éº„ÇπÔºâ
- „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÈÄ£Âãï
- „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„Éº„Éª„Çµ„É≥„ÇØ„Çπ„É†„Éº„Éì„Éº
- TV„É™„É¢„Ç≥„É≥Êìç‰ΩúÔºàÂçÅÂ≠ó„Ç≠„Éº„ÉªÊ±∫ÂÆö„Éú„Çø„É≥Ôºâ
- „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„ÉàÔºàÂÄã‰∫∫ÊÉÖÂ†±ÂâäÈô§Ôºâ
- WebSocketÈÄ£Êê∫Ôºà„É™„Ç¢„É´„Çø„Ç§„É†ÈÄöÁü•Ôºâ
- Google PlayÈÖç‰ø°

#### ‚ùå Êú¨SSOT„ÅÆÂØæË±°Â§ñ

- Ê≥®Êñá„Éï„É≠„Éº ‚Üí [SSOT_GUEST_ORDER_FLOW.md](./SSOT_GUEST_ORDER_FLOW.md)
- „É°„Éã„É•„ÉºÈñ≤Ë¶ß ‚Üí [SSOT_GUEST_MENU_VIEW.md](./SSOT_GUEST_MENU_VIEW.md)
- ÁÆ°ÁêÜÁîªÈù¢ ‚Üí Âà•SSOTÔºàÁÆ°ÁêÜÁîªÈù¢Áî®Ôºâ

---

## üõ†Ô∏è ÊäÄË°ì„Çπ„Çø„ÉÉ„ÇØ

### „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ
- **Framework**: Nuxt 3ÔºàWebViewÂΩ¢ÂºèÔºâ
- **Capacitor**: 5.xÔºàWebViewÁµ±ÂêàÔºâ
- **Ë®ÄË™û**: TypeScriptÔºàstrict„É¢„Éº„ÉâÔºâ
- **„Çπ„Çø„Ç§„É™„É≥„Ç∞**: Tailwind CSS + Êó•Êú¨„ÅÆ‰ºùÁµ±Ëâ≤
- **Áä∂ÊÖãÁÆ°ÁêÜ**: ComposablesÔºàPinia‰∏ç‰ΩøÁî®Ôºâ

### WebViewÁí∞Â¢É
- **ÂØæË±°OS**: Android TV 8.0 (API 26) ‰ª•‰∏ä
- **Ë°®Á§∫URL**: `https://{hotel-saas-domain}` (Êó¢Â≠òWeb„Ç¢„Éó„É™„ÅÆHTTPS URL)
- **ÈÄö‰ø°**: SSL/TLSÂøÖÈ†à„ÄÅHTTPÈÄö‰ø°Á¶ÅÊ≠¢
- **Ê§úÂá∫ÊñπÊ≥ï**: UserAgent (`OmotenasuAI`, `wv`, `TV`)

### „Éá„Éê„Ç§„ÇπË™çË®º
- **ÊñπÂºè**: MAC/IP„Ç¢„Éâ„É¨„Çπ„Éô„Éº„ÇπÔºàhotel-commonÁµåÁî±Ôºâ
- **„Çπ„Éà„Ç¢**: PostgreSQL (`device_rooms`„ÉÜ„Éº„Éñ„É´)
- **Ë™çË®º„Éï„É≠„Éº**: „Éá„Éê„Ç§„ÇπËµ∑Âãï ‚Üí MAC/IPÂèñÂæó ‚Üí hotel-common API ‚Üí Ëá™ÂãïË™çË®º

### „É™„É¢„Ç≥„É≥Êìç‰Ωú
- **„Ç≠„Éº„Ç§„Éô„É≥„Éà**: D-pad (‰∏ä‰∏ãÂ∑¶Âè≥)„ÄÅÊ±∫ÂÆö„Éú„Çø„É≥„ÄÅÊàª„Çã„Éú„Çø„É≥
- **„Éï„Ç©„Éº„Ç´„ÇπÁÆ°ÁêÜ**: „Ç∞„É™„ÉÉ„Éâ„Éô„Éº„Çπ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
- **Ë¶ñË™çÊÄß**: `.tv-focused` „ÇØ„É©„ÇπÔºàÊã°Â§ß„ÄÅ„Ç∑„É£„Éâ„Ç¶Ôºâ

### WebSocket
- **„Éó„É≠„Éà„Ç≥„É´**: WebSocket over HTTPS
- **Êé•Á∂öÂÖà**: `wss://{hotel-saas-domain}/ws?type=room&id={roomId}`
- **„Ç§„Éô„É≥„Éà„Çø„Ç§„Éó**: `GUEST_CHECKIN`, `GUEST_CHECKOUT`, `CHECKOUT_WARNING` (Phase 4)

---

## üß© ComposablesÂÆüË£Ö

### 1. useWebView()

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `composables/useWebView.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: WebViewÁí∞Â¢É„ÅÆÊ§úÂá∫„ÉªÁÆ°ÁêÜ

#### ‰∏ªË¶ÅÊ©üËÉΩ

```typescript
interface WebViewInfo {
  isWebViewApp: boolean;          // WebView„Ç¢„Éó„É™„Åã„Å©„ÅÜ„Åã
  isAndroidWebView: boolean;      // Android WebView„Åã„Å©„ÅÜ„Åã
  isTVDevice: boolean;            // TV„Éá„Éê„Ç§„Çπ„Åã„Å©„ÅÜ„Åã
  hasAndroidInterface: boolean;   // JavaScript InterfaceÊúâÁÑ°
  screenInfo: {
    width: number;
    height: number;
    isSmallScreen: boolean;
    isTVResolution: boolean;
  };
  deviceType: 'tv' | 'tablet' | 'mobile' | 'desktop';
}

interface AndroidInterface {
  launchApp: (packageName: string) => void;
  getDeviceInfo: () => string;
  isRemoteControlSupported: () => boolean;
}
```

#### WebViewÊ§úÂá∫„É≠„Ç∏„ÉÉ„ÇØ

```typescript
const detectWebView = (): WebViewInfo => {
  const userAgent = navigator.userAgent;
  
  // WebView„Ç¢„Éó„É™Ê§úÂá∫
  const isWebViewApp = /OmotenasuAI/i.test(userAgent);
  const isAndroidWebView = /wv/i.test(userAgent);
  const isTVDevice = /TV|AndroidTV|GoogleTV/i.test(userAgent);
  
  // JavaScript InterfaceÁ¢∫Ë™ç
  const hasAndroidInterface = typeof window.Android !== 'undefined';
  
  // ÁîªÈù¢ÊÉÖÂ†±ÂèñÂæó
  const screenWidth = window.innerWidth;
  const screenHeight = window.innerHeight;
  const isTVResolution = screenWidth >= 1280 && (screenWidth / screenHeight) >= 1.7;
  
  return {
    isWebViewApp,
    isAndroidWebView,
    isTVDevice,
    hasAndroidInterface,
    screenInfo: { ... },
    deviceType: ...
  };
};
```

#### JavaScript InterfaceÈÄ£Êê∫

```typescript
// Google Play„Ç¢„Éó„É™Ëµ∑Âãï
const launchApp = (packageName: string): boolean => {
  try {
    if (typeof window.Android !== 'undefined') {
      window.Android.launchApp(packageName);
      return true;
    }
    return false;
  } catch (error) {
    console.error('Failed to launch app:', error);
    return false;
  }
};

// „Éá„Éê„Ç§„ÇπÊÉÖÂ†±ÂèñÂæó
const getDeviceInfo = (): string => {
  try {
    if (typeof window.Android !== 'undefined') {
      return window.Android.getDeviceInfo();
    }
    return 'Web';
  } catch (error) {
    return 'Unknown';
  }
};
```

---

### 2. useTVFocus()

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `composables/useTVFocus.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: TV/„É™„É¢„Ç≥„É≥„Éï„Ç©„Éº„Ç´„ÇπÁÆ°ÁêÜ

#### ‰∏ªË¶ÅÊ©üËÉΩ

```typescript
interface FocusableElement {
  element: HTMLElement;
  id: string;
  row: number;
  col: number;
  priority: number;
}

interface FocusGrid {
  rows: number;
  cols: number;
  elements: FocusableElement[][];
}
```

#### „Éï„Ç©„Éº„Ç´„Çπ„Ç∞„É™„ÉÉ„ÉâÊßãÁØâ

```typescript
const buildFocusGrid = (container?: HTMLElement) => {
  // 1. „Éï„Ç©„Éº„Ç´„ÇπÂèØËÉΩË¶ÅÁ¥†„ÇíÊ§úÂá∫
  const selector = [
    'button:not([disabled])',
    'input:not([disabled])',
    'a[href]',
    '[tabindex]:not([tabindex="-1"])',
    '.focusable:not([disabled])'
  ].join(', ');
  
  const elements = Array.from(container.querySelectorAll(selector));
  
  // 2. ‰ΩçÁΩÆÊÉÖÂ†±„ÇíÂèñÂæó„Åó„Å¶„Ç∞„É™„ÉÉ„ÉâÂåñ
  const elementsWithPosition = elements.map((el) => {
    const rect = el.getBoundingClientRect();
    const priority = parseInt(el.dataset.focusPriority || '0');
    
    return {
      element: el,
      x: rect.left,
      y: rect.top,
      priority
    };
  });
  
  // 3. YÂ∫ßÊ®ô„Åß„ÇΩ„Éº„Éà„Åó„Å¶„Ç∞„É™„ÉÉ„ÉâË°å„ÇíÊ±∫ÂÆö
  elementsWithPosition.sort((a, b) => a.y - b.y);
  
  // 4. Âêå„ÅòË°åÂÜÖ„ÅßXÂ∫ßÊ®ô„Åß„ÇΩ„Éº„Éà
  // 5. „Ç∞„É™„ÉÉ„ÉâÂ∫ßÊ®ôÔºàrow, colÔºâ„ÇíË®≠ÂÆö
};
```

#### „Ç≠„Éº„Éú„Éº„Éâ„Éª„É™„É¢„Ç≥„É≥„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©

```typescript
const handleKeyDown = (event: KeyboardEvent) => {
  if (!isEnabled.value) return;
  
  switch (event.key) {
    case 'ArrowUp':
    case 'Up':
      event.preventDefault();
      moveFocus('up');
      break;
    case 'ArrowDown':
    case 'Down':
      event.preventDefault();
      moveFocus('down');
      break;
    case 'ArrowLeft':
    case 'Left':
      event.preventDefault();
      moveFocus('left');
      break;
    case 'ArrowRight':
    case 'Right':
      event.preventDefault();
      moveFocus('right');
      break;
    case 'Enter':
    case ' ':
      event.preventDefault();
      if (currentFocus.value) {
        currentFocus.value.element.click();
      }
      break;
  }
  
  // Android TV„É™„É¢„Ç≥„É≥„ÅÆÁâπÊÆä„Ç≠„Éº
  switch (event.code) {
    case 'GoBack':
    case 'BrowserBack':
      event.preventDefault();
      window.history.back();
      break;
  }
};
```

#### „Éï„Ç©„Éº„Ç´„ÇπÁßªÂãï„É≠„Ç∏„ÉÉ„ÇØ

```typescript
const moveFocus = (direction: 'up' | 'down' | 'left' | 'right') => {
  if (!currentFocus.value) {
    setInitialFocus();
    return;
  }
  
  const { row, col } = currentFocus.value;
  let newRow = row;
  let newCol = col;
  
  switch (direction) {
    case 'up':
      newRow = Math.max(0, row - 1);
      break;
    case 'down':
      newRow = Math.min(focusGrid.value.rows - 1, row + 1);
      break;
    case 'left':
      newCol = Math.max(0, col - 1);
      break;
    case 'right':
      newCol = Math.min(focusGrid.value.elements[row]?.length - 1 || 0, col + 1);
      break;
  }
  
  const targetElement = focusGrid.value.elements[newRow]?.[newCol];
  if (targetElement) {
    setFocus(targetElement);
  }
};
```

---

### 3. useDeviceAuth()

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `composables/useDeviceAuth.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: „Éá„Éê„Ç§„ÇπË™çË®ºÔºàMAC/IP„Éô„Éº„ÇπÔºâ

#### ‰∏ªË¶ÅÊ©üËÉΩ

```typescript
// ÁèæÂú®„ÅÆroomId„ÇíÂèñÂæó„Åô„Çã
const getCurrentRoomId = () => {
  if (process.client) {
    const currentPlace = localStorage.getItem('currentPlace');
    if (currentPlace) {
      try {
        const place = JSON.parse(currentPlace);
        return place.code || '999'; // „Éó„É¨„Ç§„Çπ„Ç≥„Éº„Éâ„Åæ„Åü„ÅØ„Éá„Éï„Ç©„É´„Éà
      } catch (e) {
        console.warn('„Éó„É¨„Ç§„ÇπÊÉÖÂ†±„ÅÆËß£Êûê„Å´Â§±Êïó:', e);
      }
    }
  }
  return '999'; // „Éá„Éï„Ç©„É´„Éà„ÅÆÈÉ®Â±ãID
};
```

#### Ë™çË®º‰ªò„ÅçAPI„É™„ÇØ„Ç®„Çπ„Éà

```typescript
const authenticatedFetch = async (url: string, options: any = {}) => {
  try {
    const roomId = getCurrentRoomId();
    
    // AndroidË™çË®º„ÅÆÂ†¥Âêà
    if (process.client) {
      const currentPlace = localStorage.getItem('currentPlace');
      if (currentPlace) {
        const place = JSON.parse(currentPlace);
        if (place.androidAuth) {
          const authHeaders = {
            'x-android-auth': 'true',
            'x-room-id': roomId
          };
          
          return await $fetch(url, {
            ...options,
            headers: { ...options.headers, ...authHeaders }
          });
        }
      }
    }
    
    // Êó¢Â≠ò„ÅÆ„Éá„Éê„Ç§„ÇπË™çË®º
    const timestamp = Math.floor(Date.now() / 1000);
    
    // „Çµ„Éº„Éê„Éº„Çµ„Ç§„Éâ„Åß„Éà„Éº„ÇØ„É≥„ÇíÁîüÊàê
    const tokenResponse = await $fetch('/api/v1/device/generate-token', {
      method: 'POST',
      body: { roomId, timestamp }
    }) as { token: string };
    
    // Ë™çË®º„Éò„ÉÉ„ÉÄ„Éº„ÇíËøΩÂä†
    const authHeaders = {
      'x-device-token': tokenResponse.token,
      'x-room-id': roomId,
      'x-timestamp': timestamp.toString()
    };
    
    return await $fetch(url, {
      ...options,
      headers: { ...options.headers, ...authHeaders }
    });
  } catch (error) {
    console.error('Ë™çË®º‰ªò„ÅçAPI„É™„ÇØ„Ç®„Çπ„Éà„Ç®„É©„Éº:', error);
    throw error;
  }
};
```

---

### 4. useDeviceCheckin()

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `composables/useDeviceCheckin.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂá¶ÁêÜ„Éª„Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„Éº

#### Áä∂ÊÖãÁÆ°ÁêÜ

```typescript
interface CheckinState {
  isCheckedIn: boolean;
  guestCount: number;
  checkinDate: string | null;
  roomNumber: string | null;
  welcomeVideoPlayed: boolean;
}

interface WelcomeVideoConfig {
  shouldPlay: boolean;
  videoUrl: string;
  duration: number;
  autoSkip: boolean;
}
```

#### „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Âá¶ÁêÜ

```typescript
const handleCheckin = (data: any) => {
  console.log('üéâ „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Ç§„Éô„É≥„ÉàÂèó‰ø°:', data);
  
  checkinState.value = {
    isCheckedIn: true,
    guestCount: data.guestCount || 1,
    checkinDate: data.checkinDate || new Date().toISOString(),
    roomNumber: data.roomNumber,
    welcomeVideoPlayed: false
  };
  
  saveCheckinState(); // localStorage„Å´‰øùÂ≠ò
  
  // „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîü
  if (data.welcomeVideo?.shouldPlay) {
    playWelcomeVideo(data.welcomeVideo);
  }
  
  console.log('‚úÖ Á´ØÊú´„Åå„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Áä∂ÊÖã„Å´„Å™„Çä„Åæ„Åó„Åü');
};
```

#### „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîü

```typescript
const playWelcomeVideo = async (config: WelcomeVideoConfig) => {
  if (isPlayingWelcomeVideo.value) {
    console.log('‚ö†Ô∏è „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„Éº„ÅØÊó¢„Å´ÂÜçÁîü‰∏≠„Åß„Åô');
    return;
  }
  
  console.log('üé¨ „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîüÈñãÂßã:', config);
  isPlayingWelcomeVideo.value = true;
  
  try {
    // ÂãïÁîªË¶ÅÁ¥†„Çí‰ΩúÊàê
    const video = document.createElement('video');
    video.src = config.videoUrl;
    video.autoplay = true;
    video.muted = true; // Ëá™ÂãïÂÜçÁîü„ÅÆ„Åü„ÇÅ„Éü„É•„Éº„Éà
    video.style.position = 'fixed';
    video.style.top = '0';
    video.style.left = '0';
    video.style.width = '100vw';
    video.style.height = '100vh';
    video.style.objectFit = 'cover';
    video.style.zIndex = '9999';
    video.style.backgroundColor = '#000';
    
    welcomeVideoElement.value = video;
    
    // ÂãïÁîªÁµÇ‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜ
    video.onended = () => {
      finishWelcomeVideo();
    };
    
    // „Ç®„É©„ÉºÂá¶ÁêÜ
    video.onerror = (error) => {
      console.error('‚ùå „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîü„Ç®„É©„Éº:', error);
      finishWelcomeVideo();
    };
    
    // ÂãïÁîª„ÇíDOM„Å´ËøΩÂä†
    document.body.appendChild(video);
    
    // Ëá™Âãï„Çπ„Ç≠„ÉÉ„Éó„Çø„Ç§„Éû„Éº
    if (config.autoSkip && config.duration) {
      setTimeout(() => {
        if (isPlayingWelcomeVideo.value) {
          console.log('‚è∞ „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºËá™Âãï„Çπ„Ç≠„ÉÉ„Éó');
          finishWelcomeVideo();
        }
      }, config.duration);
    }
    
    // „Çπ„Ç≠„ÉÉ„Éó„Éú„Çø„É≥ËøΩÂä†
    addSkipButton();
  } catch (error) {
    console.error('‚ùå „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîüÊ∫ñÂÇô„Ç®„É©„Éº:', error);
    isPlayingWelcomeVideo.value = false;
  }
};
```

#### „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂá¶ÁêÜ

```typescript
const handleCheckout = () => {
  console.log('üëã „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Ç§„Éô„É≥„ÉàÂèó‰ø°');
  
  checkinState.value = {
    isCheckedIn: false,
    guestCount: 0,
    checkinDate: null,
    roomNumber: null,
    welcomeVideoPlayed: false
  };
  
  saveCheckinState();
  
  // „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„Éº„ÅåÂÜçÁîü‰∏≠„ÅÆÂ†¥Âêà„ÅØÂÅúÊ≠¢
  if (isPlayingWelcomeVideo.value) {
    finishWelcomeVideo();
  }
  
  console.log('‚úÖ Á´ØÊú´„Åå„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÁä∂ÊÖã„Å´„Å™„Çä„Åæ„Åó„Åü');
};
```

#### WebSocketÊé•Á∂ö

```typescript
const connectWebSocket = () => {
  if (!process.client) return;
  
  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  const wsUrl = `${protocol}//${window.location.host}/ws?type=room&id=301`; // „Éá„Éï„Ç©„É´„ÉàÈÉ®Â±ãÁï™Âè∑
  
  console.log(`üîå „Éá„Éê„Ç§„Çπ„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Áî®WebSocketÊé•Á∂ö: ${wsUrl}`);
  ws = new WebSocket(wsUrl);
  
  ws.onopen = () => {
    wsConnected.value = true;
    console.log('‚úÖ „Éá„Éê„Ç§„Çπ„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Áî®WebSocketÊé•Á∂öÊàêÂäü');
  };
  
  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);
      console.log('üì® WebSocket„É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°:', data);
      
      switch (data.type) {
        case 'GUEST_CHECKIN':
          handleCheckin(data.data);
          break;
        case 'GUEST_CHECKOUT':
          handleCheckout();
          break;
        default:
          console.log('üîç Êú™ÂØæÂøú„ÅÆWebSocket„Ç§„Éô„É≥„Éà:', data.type);
      }
    } catch (error) {
      console.error('‚ùå WebSocket„É°„ÉÉ„Çª„Éº„Ç∏Ëß£Êûê„Ç®„É©„Éº:', error);
    }
  };
  
  ws.onerror = (error) => {
    wsConnected.value = false;
    wsError.value = error as Error;
    console.error('‚ùå WebSocket„Ç®„É©„Éº:', error);
  };
  
  ws.onclose = () => {
    wsConnected.value = false;
    console.log('üîå WebSocketÊé•Á∂ö„ÅåÈñâ„Åò„Çâ„Çå„Åæ„Åó„Åü');
    
    // 5ÁßíÂæå„Å´ÂÜçÊé•Á∂ö
    setTimeout(() => {
      console.log('üîÑ WebSocketÂÜçÊé•Á∂ö„ÇíË©¶„Åø„Åæ„Åô...');
      connectWebSocket();
    }, 5000);
  };
};
```

---

### 5. useDeviceReset()

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `composables/useDeviceReset.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: „Éá„Éê„Ç§„Çπ„ÅÆ„É™„Çª„ÉÉ„Éà„ÉªÂÄã‰∫∫ÊÉÖÂ†±ÂâäÈô§

#### „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà

```typescript
const resetDevice = async (): Promise<boolean> => {
  if (isResetting.value) return false; // Êó¢„Å´„É™„Çª„ÉÉ„Éà‰∏≠„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
  
  try {
    isResetting.value = true;
    console.log('„Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„ÉàÈñãÂßã...');
    
    // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆ„ÇØ„É™„Ç¢
    localStorage.clear();
    sessionStorage.clear();
    console.log('„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å®„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„Çí„ÇØ„É™„Ç¢');
    
    // IndexedDB„ÅÆ„ÇØ„É™„Ç¢
    const dbs = await window.indexedDB.databases?.() || [];
    for (const db of dbs) {
      if (!db.name) continue;
      
      await new Promise<void>((resolve) => {
        const request = indexedDB.deleteDatabase(db.name!);
        request.onsuccess = () => {
          console.log(`IndexedDB "${db.name}" „ÇíÂâäÈô§`);
          resolve();
        };
        request.onerror = () => {
          console.error(`IndexedDB "${db.name}" „ÅÆÂâäÈô§„Å´Â§±Êïó`);
          resolve(); // „Ç®„É©„Éº„Åß„ÇÇÁ∂öË°å
        };
      });
    }
    
    // „Ç≠„É£„ÉÉ„Ç∑„É•„ÅÆ„ÇØ„É™„Ç¢
    if ('caches' in window) {
      const keys = await caches.keys();
      await Promise.all(keys.map(key => {
        console.log(`„Ç≠„É£„ÉÉ„Ç∑„É• "${key}" „ÇíÂâäÈô§`);
        return caches.delete(key);
      }));
    }
    
    // Service Worker„ÅÆÁôªÈå≤Ëß£Èô§
    if ('serviceWorker' in navigator) {
      const registrations = await navigator.serviceWorker.getRegistrations();
      await Promise.all(registrations.map(reg => {
        console.log(`Service Worker „ÇíÁôªÈå≤Ëß£Èô§: ${reg.scope}`);
        return reg.unregister();
      }));
    }
    
    // „Éõ„Éº„É†ÁîªÈù¢„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
    console.log('„Éõ„Éº„É†ÁîªÈù¢„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà');
    await navigateTo('/tv/concierge');
    
    // ÂÆåÂÖ®„Å´„É™„É≠„Éº„Éâ„Åó„Å¶Êñ∞„Åó„ÅÑÁä∂ÊÖã„Å´„Åô„Çã
    location.reload();
    
    return true;
  } catch (error) {
    console.error('„É™„Çª„ÉÉ„Éà„Ç®„É©„Éº:', error);
    return false;
  } finally {
    isResetting.value = false;
  }
};
```

#### WebSocket„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº

```typescript
onMounted(() => {
  if (!process.client) return;
  
  const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
  const wsUrl = `${protocol}//${window.location.host}/ws`;
  
  console.log(`WebSocketÊé•Á∂ö„ÇíÈñãÂßã: ${wsUrl}`);
  const ws = new WebSocket(wsUrl);
  
  ws.onopen = () => {
    wsConnected.value = true;
    console.log('WebSocketÊé•Á∂öÁ¢∫Á´ã');
  };
  
  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);
      console.log('WebSocket„É°„ÉÉ„Çª„Éº„Ç∏Âèó‰ø°:', data);
      
      // „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Ç§„Éô„É≥„ÉàÂá¶ÁêÜ
      if (data.type === 'GUEST_CHECKOUT') {
        console.log('„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Ç§„Éô„É≥„ÉàÂèó‰ø°„ÄÅ„Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„ÉàÈñãÂßã');
        resetDevice();
      }
    } catch (error) {
      console.error('WebSocket„É°„ÉÉ„Çª„Éº„Ç∏Ëß£Êûê„Ç®„É©„Éº:', error);
    }
  };
});
```

---

## üåê Middleware„ÉªAPI

### 1. device-guard.ts

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `server/middleware/device-guard.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: „Éö„Éº„Ç∏Ë°®Á§∫Ââç„Å´„Éá„Éê„Ç§„ÇπË™çË®º„ÇíÂº∑Âà∂„Åô„Çã„Çµ„Éº„Éê„Éº„Éü„Éâ„É´„Ç¶„Çß„Ç¢

#### „Çπ„Ç≠„ÉÉ„ÉóÊù°‰ª∂

```typescript
const isDevAsset = (
  path.startsWith('/_nuxt') ||
  url.includes('/_nuxt/') ||
  url.includes('/@id/') ||
  url.includes('/@vite') ||
  url.includes('?macro=') ||
  url.includes('?v=')
);

if (
  path.startsWith('/api') ||
  path.startsWith('/admin') ||
  path.startsWith('/assets') ||
  path.startsWith('/ws') ||
  path === '/favicon.ico' ||
  path === '/unauthorized-device' ||
  isDevAsset ||
  isWebSocketRequest
) {
  return;
}
```

#### „Éá„Éê„Ç§„ÇπË™çË®º„Éï„É≠„Éº

```typescript
const headers = getRequestHeaders(event);
const xff = (headers['x-forwarded-for'] as string) || '';
const pickFirst = (v: string) => v.split(',')[0].trim();
let ipAddress = pickFirst(xff) || getRequestIP(event, { xForwardedFor: true }) || '127.0.0.1';

// IPv6Ê≠£Ë¶èÂåñ
if (ipAddress === '::1') ipAddress = '127.0.0.1';
const v6mapped = ipAddress.match(/^::ffff:(\d+\.\d+\.\d+\.\d+)$/);
if (v6mapped) ipAddress = v6mapped[1];

const macAddress = (headers['x-device-mac'] || '') as string;
const userAgent = (headers['user-agent'] || '') as string;

// hotel-common „ÅÆÂÖ¨ÈñãAPI„Å´Á¢∫Ë™ç„ÇíÂßîË≠≤
const status = await deviceApi.checkDeviceStatus({
  macAddress: macAddress || undefined,
  ipAddress: ipAddress || undefined,
  userAgent,
  pagePath: path
});

// found=false „Åæ„Åü„ÅØ isActive=false „ÅØÊú™Ë™çË®ºÊâ±„ÅÑ
if (!status || status.found === false || status.isActive === false) {
  return sendRedirect(event, `/unauthorized-device?redirect=${encodeURIComponent(path)}`, 302);
}
```

---

### 2. „Éá„Éê„Ç§„ÇπAPI

#### POST /api/v1/devices/check-status

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `server/api/v1/devices/check-status.post.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: „Éá„Éê„Ç§„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„ÉÅ„Çß„ÉÉ„ÇØÔºàhotel-common APIÂëº„Å≥Âá∫„ÅóÔºâ

```typescript
export default defineEventHandler(async (event) => {
  try {
    // Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØÔºàÊú¨Áï™„É¨„Éô„É´ÂÆüË£ÖÔºâ
    const authUser = event.context.user;
    if (!authUser) {
      throw createError({
        statusCode: 401,
        statusMessage: '„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô'
      });
    }
    
    const body = await readBody(event);
    const { macAddress, ipAddress, userAgent, pagePath } = body;
    
    console.log('üì± „Éá„Éê„Ç§„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„ÉÅ„Çß„ÉÉ„ÇØ:', {
      macAddress: macAddress || '(Êú™Ë®≠ÂÆö)',
      ipAddress,
      userAgent: userAgent ? userAgent.substring(0, 30) + '...' : '(Êú™Ë®≠ÂÆö)',
      pagePath
    });
    
    // hotel-common„ÅÆAPI„ÇíË™çË®º‰ªò„Åç„ÅßÂëº„Å≥Âá∫„ÅôÔºàÊú¨Áï™„É¨„Éô„É´ÂÆüË£ÖÔºâ
    try {
      const response = await deviceApi.checkDeviceStatus({
        macAddress,
        ipAddress,
        userAgent,
        pagePath
      }, {
        'Content-Type': 'application/json'
      });
      
      return response;
    } catch (apiError: any) {
      console.error('‚ùå hotel-common „Éá„Éê„Ç§„ÇπAPIÂëº„Å≥Âá∫„Åó„Ç®„É©„Éº:', apiError);
      
      // hotel-common„ÅÆAPI„ÅåÊú™ÂÆüË£Ö„ÅÆÂ†¥Âêà„ÅÆÈÅ©Âàá„Å™„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞
      if (apiError.statusCode === 400 || apiError.statusCode === 404 || apiError.statusCode === 501) {
        console.log('‚ö†Ô∏è hotel-common„Éá„Éê„Ç§„ÇπAPIÊú™ÂÆüË£Ö - 501„É¨„Çπ„Éù„É≥„Çπ„ÇíËøî„Åó„Åæ„Åô');
        throw createError({
          statusCode: 501,
          statusMessage: 'Device API not implemented in hotel-common',
          data: {
            reason: 'hotel-common device API is not yet implemented',
            suggestedAction: 'Please implement device API in hotel-common first',
            originalError: apiError.statusCode
          }
        });
      }
      
      throw createError({
        statusCode: apiError.statusCode || 500,
        statusMessage: apiError.statusMessage || 'Device API Error',
        data: apiError.data
      });
    }
  } catch (error: any) {
    console.error('‚ùå „Éá„Éê„Ç§„Çπ„Çπ„ÉÜ„Éº„Çø„Çπ„ÉÅ„Çß„ÉÉ„ÇØ„Ç®„É©„Éº:', error);
    
    throw createError({
      statusCode: error.statusCode || 403,
      message: '„Éá„Éê„Ç§„ÇπË™çË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'
    });
  }
});
```

#### GET /api/v1/devices/client-ip

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `server/api/v1/devices/client-ip.get.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: „ÇØ„É©„Ç§„Ç¢„É≥„ÉàIP„Ç¢„Éâ„É¨„Çπ„ÇíÂèñÂæó

```typescript
export default defineEventHandler(async (event) => {
  try {
    // Ë™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
    const authUser = event.context.user;
    if (!authUser) {
      throw createError({
        statusCode: 401,
        statusMessage: '„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô'
      });
    }
    
    // „ÇØ„É©„Ç§„Ç¢„É≥„ÉàIP„Ç¢„Éâ„É¨„Çπ„ÇíÂèñÂæó
    const headers = getRequestHeaders(event);
    const xff = (headers['x-forwarded-for'] as string) || '';
    const xReal = (headers['x-real-ip'] as string) || '';
    const h3Ip = getRequestIP(event, { xForwardedFor: true }) || '';
    const remote = (event.node.req.socket.remoteAddress || '') as string;
    
    const pickFirst = (v: string) => v.split(',')[0].trim();
    
    let clientIp = pickFirst(xff) || xReal || h3Ip || remote || '127.0.0.1';
    
    // IPv6Ë°®Ë®ò„ÅÆÊ≠£Ë¶èÂåñ
    if (clientIp === '::1') clientIp = '127.0.0.1';
    const v6mapped = clientIp.match(/^::ffff:(\d+\.\d+\.\d+\.\d+)$/);
    if (v6mapped) clientIp = v6mapped[1];
    
    console.log('„ÇØ„É©„Ç§„Ç¢„É≥„ÉàIPÂèñÂæó:', {
      ip: clientIp,
      headers: {
        'x-forwarded-for': headers['x-forwarded-for'],
        'x-real-ip': headers['x-real-ip']
      }
    });
    
    try {
      // hotel-common„ÅÆAPI„ÇíË™çË®º‰ªò„Åç„ÅßÂëº„Å≥Âá∫„Åô
      const response = await deviceApi.getClientIp({
        'Content-Type': 'application/json'
      });
      
      return {
        ip: clientIp,            // ÁîªÈù¢Ë°®Á§∫„ÉªÂà§ÂÆö„ÅØÂ∏∏„Å´„Çµ„Éº„Éê„Éº„ÅßÊ≠£Ë¶èÂåñ„Åó„ÅüIP
        upstreamIp: response?.ip || null,
        source: response?.source || 'upstream',
        localIp: clientIp
      };
    } catch (apiError) {
      console.warn('‚ùå hotel-common API„Ç®„É©„Éº:', apiError);
      
      // APIÂëº„Å≥Âá∫„Åó„Å´Â§±Êïó„Åó„ÅüÂ†¥Âêà„Åß„ÇÇ„É≠„Éº„Ç´„É´„ÅßÂèñÂæó„Åó„ÅüIP„ÇíËøî„Åô
      return {
        ip: clientIp,
        localIp: clientIp,
        source: 'local'
      };
    }
  } catch (error: any) {
    console.error('‚ùå „ÇØ„É©„Ç§„Ç¢„É≥„ÉàIPÂèñÂæó„Ç®„É©„Éº:', error);
    
    throw createError({
      statusCode: error.statusCode || 500,
      message: '„ÇØ„É©„Ç§„Ç¢„É≥„ÉàIP„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'
    });
  }
});
```

---

### 3. webview-security.client.ts

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `plugins/webview-security.client.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: WebView„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉªÊúÄÈÅ©Âåñ„Éó„É©„Ç∞„Ç§„É≥

#### „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ë®≠ÂÆö

```typescript
const applySecuritySettings = () => {
  // HTTPSÁ¢∫Ë™ç
  if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
    console.warn('HTTPS required for production WebView');
    
    if (process.env.NODE_ENV === 'production') {
      console.error('Production environment requires HTTPS');
    }
  }
  
  // „Çª„Ç≠„É•„Ç¢„Å™„Éá„Éº„Çø‰øùÂ≠ò„ÅÆË®≠ÂÆö
  try {
    const testKey = 'webview-storage-test';
    const testData = 'test';
    
    localStorage.setItem(testKey, testData);
    const retrieved = localStorage.getItem(testKey);
    
    if (retrieved === testData) {
      localStorage.removeItem(testKey);
      console.log('localStorage working correctly');
    }
  } catch (error) {
    console.error('Storage test failed:', error);
  }
  
  // WebViewÂà∂Á¥Ñ„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ
  checkWebViewConstraints();
};
```

#### WebViewÂà∂Á¥Ñ„ÉÅ„Çß„ÉÉ„ÇØ

```typescript
const checkWebViewConstraints = () => {
  // „Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„ÉªÊñ∞„Åó„ÅÑ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅÆÂà∂Èôê
  const originalWindowOpen = window.open;
  window.open = function(...args) {
    console.warn('window.open is restricted in WebView environment');
    
    // WebViewÁí∞Â¢É„Åß„ÅØÂêå‰∏Ä„Ç¶„Ç£„É≥„Éâ„Ç¶„Åß„ÅÆÈÅ∑Áßª„ÇíÊé®Â•®
    if (args[0]) {
      window.location.href = args[0] as string;
    }
    
    return null;
  };
  
  // „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÅÆÂà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØ
  document.addEventListener('click', (event) => {
    const target = event.target as HTMLElement;
    const link = target.closest('a[download]');
    
    if (link && webViewInfo?.isAndroidWebView) {
      console.warn('File download may be restricted in WebView');
      event.preventDefault();
      alert('„Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÅØWebViewÁí∞Â¢É„Åß„ÅØÂà∂Èôê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
    }
  });
};
```

---

## üì∫ TVÂêë„Åë„Éö„Éº„Ç∏

### 1. /tv/concierge.vue

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `pages/tv/concierge.vue`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 95%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: AI„Ç≥„É≥„Ç∑„Çß„É´„Ç∏„É•ÔºàQ&A„ÉÑ„É™„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ôºâ

#### ‰∏ªË¶ÅÊ©üËÉΩ

- ‚úÖ „Ç´„ÉÜ„Ç¥„É™„ÉÑ„É™„ÉºË°®Á§∫
- ‚úÖ Ë≥™Âïè„ÉªÂõûÁ≠îË°®Á§∫
- ‚úÖ „Éë„É≥„Åè„Åö„É™„Çπ„Éà
- ‚úÖ „É™„É¢„Ç≥„É≥Êìç‰ΩúÂØæÂøúÔºàÂçÅÂ≠ó„Ç≠„Éº„ÉªÊ±∫ÂÆö„Éú„Çø„É≥Ôºâ
- ‚úÖ QR„Ç≥„Éº„ÉâÁîüÊàêÔºà„Çπ„Éû„ÉõÈÄ£Êê∫Ôºâ
- ‚úÖ Â§öË®ÄË™ûÂàá„ÇäÊõø„ÅàÔºàÊó•/Ëã±/‰∏≠/ÈüìÔºâ
- ‚úÖ WebSocketÈÄ£Êê∫Ôºà„Çª„ÉÉ„Ç∑„Éß„É≥ÂêåÊúüÔºâ

#### „É¨„Ç§„Ç¢„Ç¶„Éà

```vue
<template>
  <div class="tv-container">
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <div class="tv-header">
      <h1 class="text-2xl font-bold">AI„Ç≥„É≥„Ç∑„Çß„É´„Ç∏„É•</h1>
      <select v-model="currentLanguage" class="tv-select">
        <option value="ja">Êó•Êú¨Ë™û</option>
        <option value="en">English</option>
        <option value="zh-CN">‰∏≠Êñá</option>
        <option value="ko">ÌïúÍµ≠Ïñ¥</option>
      </select>
    </div>
    
    <!-- „Éë„É≥„Åè„Åö„É™„Çπ„Éà -->
    <div class="breadcrumb">
      <button @click="navigateToHome" data-focus-order="1">
        <Icon name="heroicons:home" /> „Éõ„Éº„É†
      </button>
      <template v-for="(crumb, index) in breadcrumbs">
        <Icon name="heroicons:chevron-right" />
        <button @click="navigateToBreadcrumb(crumb.id)">
          {{ crumb.title }}
        </button>
      </template>
    </div>
    
    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <div class="tv-content">
      <!-- „Ç´„ÉÜ„Ç¥„É™‰∏ÄË¶ß -->
      <div v-if="currentView === 'categories'" class="categories-grid">
        <div
          v-for="(category, index) in currentCategories"
          :key="category.id"
          class="category-card"
          :data-focus-order="index + 10"
          @click="navigateToCategory(category)"
        >
          <Icon :name="`heroicons:${category.icon}`" class="w-10 h-10" />
          <h3>{{ category.title }}</h3>
          <p>{{ category.description }}</p>
        </div>
      </div>
      
      <!-- Ë≥™Âïè‰∏ÄË¶ß -->
      <div v-else-if="currentView === 'questions'" class="questions-list">
        <div
          v-for="(question, index) in currentQuestions"
          :key="question.id"
          class="question-item"
          :data-focus-order="index + 10"
          @click="showAnswer(question)"
        >
          <Icon :name="`heroicons:${question.icon}`" />
          <span>{{ question.title }}</span>
          <Icon name="heroicons:chevron-right" />
        </div>
      </div>
      
      <!-- ÂõûÁ≠îË°®Á§∫ -->
      <div v-else-if="currentView === 'answer'" class="answer-container">
        <h2>{{ currentQuestion.title }}</h2>
        <div class="answer-content">
          <p>{{ currentQuestion.answer.text }}</p>
          
          <!-- Èñ¢ÈÄ£Ë≥™Âïè -->
          <div v-if="relatedQuestions.length > 0" class="related-questions">
            <h3>Èñ¢ÈÄ£„Åô„ÇãË≥™Âïè</h3>
            <div
              v-for="(question, index) in relatedQuestions"
              :key="question.id"
              :data-focus-order="index + 50"
              @click="showAnswer(question)"
            >
              {{ question.title }}
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- „Éï„ÉÉ„Çø„Éº -->
    <div class="tv-footer">
      <div class="navigation-help">
        <span>‚Üê Êàª„Çã</span>
        <span>‚Üë‚Üì‚Üí ÁßªÂãï</span>
        <span>‚≠ï ÈÅ∏Êäû</span>
      </div>
      <div class="qr-code-container">
        <div ref="qrCodeElement" class="qr-code"></div>
        <p>„Çπ„Éû„Éõ„ÅßÁ∂ö„Åë„Çã</p>
      </div>
    </div>
  </div>
</template>
```

---

### 2. /tv/settings.vue

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `pages/tv/settings.vue`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚úÖ 100%ÂÆåÊàê

**Ê©üËÉΩÊ¶ÇË¶Å**: Ë®≠ÂÆöÁîªÈù¢Ôºà„Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà„Éª„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØË®≠ÂÆöÔºâ

#### ‰∏ªË¶ÅÊ©üËÉΩ

- ‚úÖ „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà
- ‚úÖ „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØË®≠ÂÆöÔºàÈÅ∑Áßª„ÅÆ„ÅøÔºâ
- ‚úÖ „Çµ„Éº„Éê„ÉºË®≠ÂÆöÔºàÈÅ∑Áßª„ÅÆ„ÅøÔºâ
- ‚úÖ „É™„É¢„Ç≥„É≥Êìç‰ΩúÂØæÂøú
- ‚úÖ WebSocketÈÄ£Êê∫Ôºà„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÊôÇËá™Âãï„É™„Çª„ÉÉ„ÉàÔºâ

#### „É¨„Ç§„Ç¢„Ç¶„Éà

```vue
<template>
  <div class="settings-container">
    <h1 class="settings-title">Ë®≠ÂÆöÁîªÈù¢</h1>
    
    <div class="settings-grid">
      <!-- „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà -->
      <div class="setting-card" @click="resetDevice" data-focus-order="1">
        <Icon name="heroicons:arrow-path" class="setting-icon" />
        <h2>„Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà</h2>
        <p>„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÊ∂àÂéª„Åó„ÄÅÂàùÊúüÁä∂ÊÖã„Å´Êàª„Åó„Åæ„Åô</p>
      </div>
      
      <!-- „Éç„ÉÉ„Éà„ÉØ„Éº„ÇØË®≠ÂÆö -->
      <div class="setting-card" @click="configureNetwork" data-focus-order="2">
        <Icon name="heroicons:wifi" class="setting-icon" />
        <h2>„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØË®≠ÂÆö</h2>
        <p>Wi-FiË®≠ÂÆö„ÇíÂ§âÊõ¥„Åó„Åæ„Åô</p>
      </div>
      
      <!-- „Çµ„Éº„Éê„ÉºË®≠ÂÆö -->
      <div class="setting-card" @click="configureServer" data-focus-order="3">
        <Icon name="heroicons:server" class="setting-icon" />
        <h2>„Çµ„Éº„Éê„ÉºË®≠ÂÆö</h2>
        <p>Êé•Á∂öÂÖà„Çµ„Éº„Éê„Éº„ÇíË®≠ÂÆö„Åó„Åæ„Åô</p>
      </div>
      
      <!-- Êàª„Çã -->
      <div class="setting-card" @click="exitSettings" data-focus-order="4">
        <Icon name="heroicons:arrow-left" class="setting-icon" />
        <h2>Êàª„Çã</h2>
        <p>Ë®≠ÂÆö„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô</p>
      </div>
    </div>
    
    <!-- „É≠„Éº„Éá„Ç£„É≥„Ç∞„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div v-if="isResetting" class="loading-overlay">
      <div class="spinner"></div>
      <p>„É™„Çª„ÉÉ„Éà‰∏≠...</p>
    </div>
  </div>
</template>

<script setup>
import { useDeviceReset } from '~/composables/useDeviceReset';

definePageMeta({
  layout: 'blank'
});

const { resetDevice, isResetting } = useDeviceReset();

const configureNetwork = () => {
  navigateTo('/tv/settings/network');
};

const configureServer = () => {
  navigateTo('/tv/settings/server');
};

const exitSettings = () => {
  navigateTo('/tv/concierge');
};
</script>
```

---

## ‚öôÔ∏è CapacitorË®≠ÂÆö

### capacitor.config.ts

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `capacitor.config.ts`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚ùå Êú™‰ΩúÊàêÔºàPhase 2„ÅßÂÆüË£ÖÔºâ

**Ê©üËÉΩÊ¶ÇË¶Å**: CapacitorË®≠ÂÆö„Éï„Ç°„Ç§„É´

```typescript
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.hotelsaas.roomorder.tv',
  appName: 'Hotel Room Order TV',
  webDir: 'dist',
  server: {
    url: 'https://your-hotel-saas-domain.com',  // Êó¢Â≠òWeb„Ç¢„Éó„É™URL
    cleartext: false,  // HTTPSÂøÖÈ†à
    androidScheme: 'https'
  },
  plugins: {
    CapacitorHttp: {
      enabled: true
    }
  },
  android: {
    allowMixedContent: false,
    captureInput: true,
    webContentsDebuggingEnabled: false
  }
};

export default config;
```

---

### AndroidManifest.xmlÔºàTVÂêë„ÅëË®≠ÂÆöÔºâ

**„Éï„Ç°„Ç§„É´„Éë„Çπ**: `android/app/src/main/AndroidManifest.xml`

**ÂÆüË£ÖÁä∂Ê≥Å**: ‚ùå Êú™‰ΩúÊàêÔºàPhase 2„ÅßÂÆüË£ÖÔºâ

**Ê©üËÉΩÊ¶ÇË¶Å**: Android TVÂØæÂøúË®≠ÂÆö

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    
    <!-- TVÂØæÂøúÂÆ£Ë®Ä -->
    <uses-feature
        android:name="android.software.leanback"
        android:required="true" />
    
    <!-- „Çø„ÉÉ„ÉÅ„Çπ„ÇØ„É™„Éº„É≥‰∏çË¶Å -->
    <uses-feature
        android:name="android.hardware.touchscreen"
        android:required="false" />
    
    <!-- Ê®©Èôê -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <uses-permission android:name="android.permission.ACCESS_WIFI_STATE" />
    
    <application
        android:label="Hotel Room Order"
        android:icon="@mipmap/ic_launcher"
        android:banner="@drawable/tv_banner"
        android:theme="@style/AppTheme.Leanback">
        
        <activity
            android:name=".MainActivity"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|locale|smallestScreenSize|screenLayout|uiMode"
            android:label="@string/app_name"
            android:launchMode="singleTask"
            android:screenOrientation="landscape">
            
            <!-- „É©„É≥„ÉÅ„É£„Éº -->
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
                <category android:name="android.intent.category.LEANBACK_LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>
```

---

## üîÑ „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÈÄ£Âãï

### „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„Éï„É≠„Éº

#### Phase 1ÂÆüË£ÖÔºàÂÆå‰∫ÜÔºâ

```
hotel-pms („Éï„É≠„É≥„Éà„Éá„Çπ„ÇØ)
  ‚Üì „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÁôªÈå≤
hotel-common API
  ‚Üì WebSocketÈÖç‰ø°
hotel-saas (ÂÆ¢ÂÆ§Á´ØÊú´)
  ‚Üì GUEST_CHECKIN„Ç§„Éô„É≥„ÉàÂèó‰ø°
useDeviceCheckin.ts
  ‚îú‚îÄ „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Áä∂ÊÖã‰øùÂ≠òÔºàlocalStorageÔºâ
  ‚îú‚îÄ „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîü
  ‚îÇ  ‚îú‚îÄ ÂãïÁîªË¶ÅÁ¥†‰ΩúÊàêÔºàÂÖ®ÁîªÈù¢Ë°®Á§∫Ôºâ
  ‚îÇ  ‚îú‚îÄ Ëá™ÂãïÂÜçÁîüÔºà„Éü„É•„Éº„ÉàÔºâ
  ‚îÇ  ‚îú‚îÄ „Çπ„Ç≠„ÉÉ„Éó„Éú„Çø„É≥Ë°®Á§∫
  ‚îÇ  ‚îî‚îÄ ÁµÇ‰∫ÜÂæå„Å´„É°„Ç§„É≥UI„Å∏
  ‚îî‚îÄ WebSocketÊé•Á∂öÁ¢∫Á´ã
```

#### „Éá„Éº„ÇøÊßãÈÄ†

```typescript
// WebSocket„Ç§„Éô„É≥„Éà
{
  type: 'GUEST_CHECKIN',
  data: {
    roomNumber: '301',
    guestCount: 2,
    checkinDate: '2025-10-15T14:00:00Z',
    welcomeVideo: {
      shouldPlay: true,
      videoUrl: 'https://cdn.example.com/welcome.mp4',
      duration: 30000,  // 30Áßí
      autoSkip: true
    }
  }
}
```

#### Phase 4ÂÆüË£Ö‰∫àÂÆöÔºàPMSÈÄ£ÂãïÂæåÔºâ

```
hotel-pms („ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÁôªÈå≤)
  ‚Üì ÂõΩÁ±ç„ÉªË®ÄË™û„Éá„Éº„Çø‰ªò„Åç
hotel-common API
  ‚Üì WebSocketÈÖç‰ø°
hotel-saas (ÂÆ¢ÂÆ§Á´ØÊú´)
  ‚Üì GUEST_CHECKIN„Ç§„Éô„É≥„Éà + Ë®ÄË™û„Éá„Éº„Çø
useDeviceCheckin.ts
  ‚îî‚îÄ üÜï Ë®ÄË™ûËá™ÂãïË®≠ÂÆöÔºàlocale.value = data.languageÔºâ
```

#### Ë®ÄË™ûËá™ÂãïË®≠ÂÆöÔºàPhase 4ÂÆüË£Ö‰∫àÂÆöÔºâ

```typescript
// useDeviceCheckin.ts - Phase 4Âº∑ÂåñÁâà
const handleCheckin = (data: any) => {
  checkinState.value = {
    isCheckedIn: true,
    guestCount: data.guestCount,
    roomNumber: data.roomNumber,
    nationality: data.nationality,      // üÜï ÂõΩÁ±ç„Éá„Éº„Çø
    preferredLanguage: data.language,   // üÜï Êé®Â•®Ë®ÄË™û
  };
  
  // üÜï Ë®ÄË™ûËá™ÂãïË®≠ÂÆöÔºàPhase 4Ôºâ
  if (data.language) {
    locale.value = data.language; // 'ja', 'en', 'zh-CN', 'ko', etc.
    localStorage.setItem('preferred-language', data.language);
  }
  
  // „Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÂÜçÁîü
  if (data.welcomeVideo?.shouldPlay) {
    playWelcomeVideo(data.welcomeVideo);
  }
};
```

---

### „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Éï„É≠„Éº

#### Phase 1ÂÆüË£ÖÔºàÂÆå‰∫ÜÔºâ

```
hotel-pms („ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂá¶ÁêÜ)
  ‚Üì
hotel-common API
  ‚Üì WebSocketÈÖç‰ø°
hotel-saas (ÂÆ¢ÂÆ§Á´ØÊú´)
  ‚Üì GUEST_CHECKOUT„Ç§„Éô„É≥„ÉàÂèó‰ø°
useDeviceReset.ts
  ‚îú‚îÄ localStorage.clear()
  ‚îú‚îÄ sessionStorage.clear()
  ‚îú‚îÄ IndexedDBÂâäÈô§
  ‚îú‚îÄ CacheÂâäÈô§
  ‚îú‚îÄ Service WorkerÁôªÈå≤Ëß£Èô§
  ‚îî‚îÄ „Éõ„Éº„É†ÁîªÈù¢„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà + „É™„É≠„Éº„Éâ
```

#### „Éá„Éº„ÇøÊßãÈÄ†

```typescript
// WebSocket„Ç§„Éô„É≥„Éà
{
  type: 'GUEST_CHECKOUT',
  data: {
    roomNumber: '301',
    checkoutTime: '2025-10-16T11:00:00Z'
  }
}
```

#### Phase 3ÂÆüË£Ö‰∫àÂÆöÔºàPMS‰∏çË¶ÅÔºâ

```
hotel-saas (ÂÆ¢ÂÆ§Á´ØÊú´)
  ‚Üì GUEST_CHECKOUT„Ç§„Éô„É≥„ÉàÂèó‰ø°
useDeviceReset.ts (Âº∑ÂåñÁâà)
  ‚îú‚îÄ üÜï „Çµ„É≥„ÇØ„Çπ„É†„Éº„Éì„ÉºÂÜçÁîüÔºà3ÁßíÔºâ
  ‚îú‚îÄ üÜï „É™„Çª„ÉÉ„ÉàÈÄ≤ÊçóË°®Á§∫
  ‚îÇ  ‚îú‚îÄ „É≠„Éº„Ç´„É´„Éá„Éº„ÇøÂâäÈô§ (25%)
  ‚îÇ  ‚îú‚îÄ „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ (50%)
  ‚îÇ  ‚îú‚îÄ IndexedDBÂâäÈô§ (75%)
  ‚îÇ  ‚îî‚îÄ Service WorkerËß£Èô§ (100%)
  ‚îú‚îÄ „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà
  ‚îî‚îÄ üÜï „Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„É≠„Ç∞Ë®òÈå≤
```

#### „Çµ„É≥„ÇØ„Çπ„É†„Éº„Éì„ÉºÔºàPhase 3ÂÆüË£Ö‰∫àÂÆöÔºâ

```typescript
// useDeviceReset.ts - Phase 3Âº∑ÂåñÁâà
const handleCheckout = async () => {
  console.log('üëã „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Ç§„Éô„É≥„ÉàÂèó‰ø°');
  
  // üÜï „Çµ„É≥„ÇØ„Çπ„É†„Éº„Éì„ÉºÂÜçÁîüÔºàPhase 3Ôºâ
  if (tenantSettings.value?.thankYouVideoUrl) {
    await playThankYouVideo(tenantSettings.value.thankYouVideoUrl);
  }
  
  // „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà
  checkinState.value = { isCheckedIn: false, ... };
  saveCheckinState();
  
  // 3ÁßíÂæå„Å´ÂÆåÂÖ®„É™„Çª„ÉÉ„Éà
  setTimeout(() => {
    resetDevice();
  }, 3000);
};

const playThankYouVideo = async (videoUrl: string) => {
  return new Promise((resolve) => {
    const video = document.createElement('video');
    video.src = videoUrl;
    video.autoplay = true;
    video.muted = false; // üÜï Èü≥Â£∞ON
    video.style.position = 'fixed';
    video.style.top = '0';
    video.style.left = '0';
    video.style.width = '100vw';
    video.style.height = '100vh';
    video.style.zIndex = '10000';
    video.style.backgroundColor = '#000';
    
    video.onended = () => {
      video.remove();
      resolve(true);
    };
    
    document.body.appendChild(video);
  });
};
```

#### „É™„Çª„ÉÉ„ÉàÈÄ≤ÊçóË°®Á§∫ÔºàPhase 3ÂÆüË£Ö‰∫àÂÆöÔºâ

```typescript
// useDeviceReset.ts - Phase 3Âº∑ÂåñÁâà
const resetDevice = async (): Promise<boolean> => {
  if (isResetting.value) return false;
  
  try {
    isResetting.value = true;
    
    // üÜï ÈÄ≤ÊçóË°®Á§∫
    const steps = [
      { name: '„É≠„Éº„Ç´„É´„Éá„Éº„ÇøÂâäÈô§', progress: 0 },
      { name: '„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢', progress: 25 },
      { name: 'IndexedDBÂâäÈô§', progress: 50 },
      { name: 'Service WorkerËß£Èô§', progress: 75 },
      { name: 'ÂÆå‰∫Ü', progress: 100 }
    ];
    
    for (const step of steps) {
      updateResetProgress(step); // üÜï ÈÄ≤Êçó„É¢„Éº„ÉÄ„É´Êõ¥Êñ∞
      
      if (step.progress === 0) {
        localStorage.clear();
        sessionStorage.clear();
      } else if (step.progress === 25) {
        await clearCaches();
      } else if (step.progress === 50) {
        await clearIndexedDB();
      } else if (step.progress === 75) {
        await unregisterServiceWorkers();
      }
      
      await sleep(500); // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
    }
    
    await navigateTo('/tv/concierge');
    location.reload();
    
    return true;
  } catch (error) {
    console.error('„É™„Çª„ÉÉ„Éà„Ç®„É©„Éº:', error);
    return false;
  } finally {
    isResetting.value = false;
  }
};
```

#### Phase 4ÂÆüË£Ö‰∫àÂÆöÔºàPMSÈÄ£ÂãïÂæåÔºâ

```
hotel-pms („ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà‰∫àÂÆöÊôÇÂàªÁÆ°ÁêÜ)
  ‚Üì „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà15ÂàÜÂâç
hotel-common API
  ‚Üì WebSocketÈÖç‰ø°
hotel-saas (ÂÆ¢ÂÆ§Á´ØÊú´)
  ‚Üì üÜï CHECKOUT_WARNING„Ç§„Éô„É≥„ÉàÂèó‰ø°
useDeviceCheckin.ts
  ‚îî‚îÄ üÜï Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´Ë°®Á§∫
     „Äå„ÅÇ„Å®15ÂàÜ„Åß„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÊôÇÂàª„Åß„Åô„ÄÇ
      Ê≥®Êñá‰∏≠„ÅÆÂïÜÂìÅ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÅäÊó©„ÇÅ„Å´Á¢∫ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ„Äç
```

#### „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂâçÁ¢∫Ë™çÔºàPhase 4ÂÆüË£Ö‰∫àÂÆöÔºâ

```typescript
// useDeviceCheckin.ts - Phase 4Âº∑ÂåñÁâà
const handleCheckoutWarning = (data: any) => {
  const { checkoutTime, minutesRemaining } = data;
  
  if (minutesRemaining === 15) {
    showModal({
      title: '„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„ÅÆ„ÅîÊ°àÂÜÖ',
      message: '„ÅÇ„Å®15ÂàÜ„Åß„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÊôÇÂàª„Åß„Åô„ÄÇ\nÊ≥®Êñá‰∏≠„ÅÆÂïÜÂìÅ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÅäÊó©„ÇÅ„Å´Á¢∫ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
      icon: '‚è∞',
      buttons: [
        { label: 'Á¢∫Ë™ç', action: 'dismiss' },
        { label: 'Ê≥®ÊñáÁîªÈù¢„Å∏', action: () => navigateTo('/order/cart') }
      ]
    });
  }
};

// WebSocket„Ç§„Éô„É≥„ÉàËøΩÂä†ÔºàPhase 4Ôºâ
switch (data.type) {
  case 'GUEST_CHECKIN': handleCheckin(data.data); break;
  case 'CHECKOUT_WARNING': handleCheckoutWarning(data.data); break; // üÜï
  case 'GUEST_CHECKOUT': handleCheckout(); break;
}
```

---

## üåê WebSocketÈÄ£Êê∫

### Êé•Á∂öÂÖà

```
wss://{hotel-saas-domain}/ws?type=room&id={roomId}
```

### „Ç§„Éô„É≥„Éà„Çø„Ç§„Éó

| „Ç§„Éô„É≥„Éà„Çø„Ç§„Éó | Phase | ÂÆüË£ÖÁä∂Ê≥Å | Ë™¨Êòé |
|:-------------|:-----:|:--------|:-----|
| **GUEST_CHECKIN** | 1 | ‚úÖ | „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÂÆå‰∫Ü |
| **GUEST_CHECKOUT** | 1 | ‚úÖ | „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂÆå‰∫Ü |
| **CHECKOUT_WARNING** | 4 | ‚ùå | „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà15ÂàÜÂâçÔºàPMSÈÄ£ÂãïÂæåÔºâ |

### GUEST_CHECKIN

```json
{
  "type": "GUEST_CHECKIN",
  "data": {
    "roomNumber": "301",
    "guestCount": 2,
    "checkinDate": "2025-10-15T14:00:00Z",
    "nationality": "JP",
    "language": "ja",
    "welcomeVideo": {
      "shouldPlay": true,
      "videoUrl": "https://cdn.example.com/welcome.mp4",
      "duration": 30000,
      "autoSkip": true
    }
  }
}
```

### GUEST_CHECKOUT

```json
{
  "type": "GUEST_CHECKOUT",
  "data": {
    "roomNumber": "301",
    "checkoutTime": "2025-10-16T11:00:00Z"
  }
}
```

### CHECKOUT_WARNINGÔºàPhase 4ÂÆüË£Ö‰∫àÂÆöÔºâ

```json
{
  "type": "CHECKOUT_WARNING",
  "data": {
    "roomNumber": "301",
    "checkoutTime": "2025-10-16T11:00:00Z",
    "minutesRemaining": 15
  }
}
```

---

## üîê „Çª„Ç≠„É•„É™„ÉÜ„Ç£

### HTTPSÂøÖÈ†à

- **Êú¨Áï™Áí∞Â¢É**: HTTPSÂøÖÈ†àÔºàCapacitorË®≠ÂÆö„ÅßÂº∑Âà∂Ôºâ
- **ÈñãÁô∫Áí∞Â¢É**: localhost „ÅØHTTPË®±ÂèØ
- **Ë®ºÊòéÊõ∏Ê§úË®º**: Ëá™Â∑±ÁΩ≤ÂêçË®ºÊòéÊõ∏„ÅØÊãíÂê¶

### „Éá„Éê„Ç§„ÇπË™çË®º

- **ÊñπÂºè**: MAC/IP„Ç¢„Éâ„É¨„Çπ„Éô„Éº„Çπ
- **„Çπ„Éà„Ç¢**: PostgreSQL (`device_rooms`„ÉÜ„Éº„Éñ„É´)
- **Ë™çË®º„Éï„É≠„Éº**: ÂÖ®„Éö„Éº„Ç∏„Ç¢„ÇØ„Çª„ÇπÂâç„Å´`device-guard.ts`„Åß„ÉÅ„Çß„ÉÉ„ÇØ

### „Éá„Éº„Çø‰øùË≠∑

- **ÂÄã‰∫∫ÊÉÖÂ†±**: localStorage/IndexedDB„Å´‰øùÂ≠ò
- **„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÊôÇ**: ÂÖ®„Éá„Éº„ÇøËá™ÂãïÂâäÈô§
- **„ÉÜ„Éä„É≥„ÉàÂàÜÈõ¢**: `tenant_id`ÂøÖÈ†à„Éï„Ç£„É´„Çø

### WebViewÂà∂Á¥Ñ

```typescript
// window.open Âà∂Èôê
window.open = function(...args) {
  // WebViewÁí∞Â¢É„Åß„ÅØÂêå‰∏Ä„Ç¶„Ç£„É≥„Éâ„Ç¶„Åß„ÅÆÈÅ∑Áßª„ÅÆ„Åø
  if (args[0]) {
    window.location.href = args[0] as string;
  }
  return null;
};

// „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÂà∂Èôê
document.addEventListener('click', (event) => {
  const link = event.target.closest('a[download]');
  if (link && isAndroidWebView) {
    event.preventDefault();
    alert('„Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÅØWebViewÁí∞Â¢É„Åß„ÅØÂà∂Èôê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
  }
});
```

### XSSÂØæÁ≠ñ

- ‚úÖ Vue 3„ÅÆ„Éá„Éï„Ç©„É´„Éà„Ç®„Çπ„Ç±„Éº„ÉóÊ©üËÉΩ
- ‚úÖ `v-html`‰ΩøÁî®Á¶ÅÊ≠¢
- ‚úÖ „É¶„Éº„Ç∂„ÉºÂÖ•Âäõ„ÅÆ„Éê„É™„Éá„Éº„Ç∑„Éß„É≥

### CSRFÂØæÁ≠ñ

- ‚úÖ SameSite CookieÂ±ûÊÄß
- ‚úÖ Nuxt 3„ÅÆCSRF‰øùË≠∑

---

## üõ†Ô∏è ÂÆüË£Ö„Ç¨„Ç§„Éâ

### Phase 1: Êó¢Â≠òÊ©üËÉΩÂÆåÊàêÂ∫¶Á¢∫Ë™çÔºàÂÆå‰∫Ü - 85%Ôºâ

**ÂÆüË£ÖÊ∏à„Åø**:
- ‚úÖ useDeviceCheckin.tsÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„ÉºÔºâ
- ‚úÖ useDeviceReset.tsÔºà„Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„ÉàÔºâ
- ‚úÖ useWebView.tsÔºàWebViewÊ§úÂá∫Ôºâ
- ‚úÖ useTVFocus.tsÔºà„É™„É¢„Ç≥„É≥Êìç‰ΩúÔºâ
- ‚úÖ useDeviceAuth.tsÔºà„Éá„Éê„Ç§„ÇπË™çË®ºÔºâ
- ‚úÖ device-guard.tsÔºàË™çË®º„Éü„Éâ„É´„Ç¶„Çß„Ç¢Ôºâ
- ‚úÖ /tv/concierge.vueÔºàAI„Ç≥„É≥„Ç∑„Çß„É´„Ç∏„É•Ôºâ
- ‚úÖ /tv/settings.vueÔºàË®≠ÂÆöÁîªÈù¢Ôºâ

---

### Phase 2: Capacitor + Google PlayÈÖç‰ø°Ôºà2ÈÄ±ÈñìÔºâüî¥ ÊúÄÂÑ™ÂÖà

#### Week 1: CapacitorÂü∫Áõ§ÊßãÁØâ

**Day 1-2: CapacitorÂàùÊúüÂåñ**

```bash
# 1. Capacitor„Éó„É≠„Ç∏„Çß„ÇØ„ÉàÂàùÊúüÂåñ
npm install @capacitor/core @capacitor/cli
npm install @capacitor/android
npx cap init "Hotel Room Order TV" "com.hotelsaas.roomorder.tv"

# 2. Android TVÈñãÁô∫Áí∞Â¢É
# Android Studio „Ç§„É≥„Çπ„Éà„Éº„É´
# Android TV SDK „Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

# 3. „Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†ËøΩÂä†
npx cap add android
```

**Day 3-4: capacitor.config.ts‰ΩúÊàê**

```typescript
// capacitor.config.ts
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.hotelsaas.roomorder.tv',
  appName: 'Hotel Room Order TV',
  webDir: 'dist',
  server: {
    url: 'https://your-hotel-saas-domain.com',
    cleartext: false,
    androidScheme: 'https'
  },
  plugins: {
    CapacitorHttp: {
      enabled: true
    }
  },
  android: {
    allowMixedContent: false,
    captureInput: true,
    webContentsDebuggingEnabled: false
  }
};

export default config;
```

**Day 5: AndroidManifest.xml TVÂêë„ÅëË®≠ÂÆö**

```xml
<!-- android/app/src/main/AndroidManifest.xml -->
<manifest xmlns:android="http://schemas.android.com/apk/res/android">
    
    <!-- TVÂØæÂøúÂÆ£Ë®Ä -->
    <uses-feature
        android:name="android.software.leanback"
        android:required="true" />
    
    <!-- „Çø„ÉÉ„ÉÅ„Çπ„ÇØ„É™„Éº„É≥‰∏çË¶Å -->
    <uses-feature
        android:name="android.hardware.touchscreen"
        android:required="false" />
    
    <!-- Ê®©Èôê -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    
    <application
        android:label="Hotel Room Order"
        android:banner="@drawable/tv_banner"
        android:theme="@style/AppTheme.Leanback">
        
        <activity
            android:name=".MainActivity"
            android:screenOrientation="landscape">
            
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LEANBACK_LAUNCHER" />
            </intent-filter>
        </activity>
    </application>
</manifest>
```

**Day 6-7: „Éì„É´„Éâ„Éª„ÉÜ„Çπ„Éà**

```bash
# 1. Web„Ç¢„Éó„É™„Éì„É´„Éâ
npm run build

# 2. CapacitorÂêåÊúü
npx cap sync android

# 3. Android Studio„ÅßÈñã„Åè
npx cap open android

# 4. TVÁî®APK„Éì„É´„Éâ
# Build > Generate Signed Bundle/APK
```

#### Week 2: Google PlayÈÖç‰ø°Ê∫ñÂÇô

**Day 8-9: „Çπ„Éà„Ç¢Á¥†Êùê‰ΩúÊàê**

- TVÂêë„Åë„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„ÉàÔºà1920x1080„ÄÅ5ÊûöÔºâ
- TV„Éê„Éä„ÉºÁîªÂÉèÔºà1280x720Ôºâ
- „Ç¢„Éó„É™Ë™¨ÊòéÊñáÔºàÊó•Êú¨Ë™û„ÉªËã±Ë™ûÔºâ
- „Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„ÉºURL

**Day 10-11: AAB„Éï„Ç°„Ç§„É´ÁîüÊàê**

```bash
# „É™„É™„Éº„ÇπÁî®AAB„Éì„É´„Éâ
cd android
./gradlew bundleRelease

# Âá∫ÂäõÂÖà
# android/app/build/outputs/bundle/release/app-release.aab
```

**Day 12-13: Play ConsoleË®≠ÂÆö**

1. „Ç¢„Éó„É™‰ΩúÊàê
2. Android TVÂØæÂøú„ÇíÊúâÂäπÂåñ
3. „Çπ„Éà„Ç¢Êé≤ËºâÊÉÖÂ†±ÂÖ•Âäõ
4. AAB„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
5. ÂØ©ÊüªÁî≥Ë´ã

**Day 14: ÂØ©Êüª„Éª„É™„É™„Éº„Çπ**

---

### Phase 3: „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàUIÂº∑ÂåñÔºà1ÈÄ±ÈñìÔºâüü° ‰∏≠ÂÑ™ÂÖà

**Áã¨Á´ãÂÆüË£ÖÂèØËÉΩ„Å™Ê©üËÉΩÔºàPMSÈÄ£Âãï‰∏çË¶ÅÔºâ**:

#### Day 1-2: „Çµ„É≥„ÇØ„Çπ„É†„Éº„Éì„Éº

**„Éá„Éº„Çø„Éô„Éº„ÇπÊã°Âºµ**:

```prisma
model TenantSettings {
  // Êó¢Â≠ò„Éï„Ç£„Éº„É´„Éâ
  welcomeVideoUrl    String?  @map("welcome_video_url")
  
  // Phase 3ËøΩÂä†
  thankYouVideoUrl   String?  @map("thank_you_video_url")
  
  @@map("tenant_settings")
}
```

**„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥**:

```bash
# hotel-common„ÅßÂÆüË°å
cd /path/to/hotel-common
npx prisma migrate dev --name add_thank_you_video_url
```

**ÂÆüË£Ö**:

```typescript
// useDeviceReset.ts - playThankYouVideo() ËøΩÂä†
const playThankYouVideo = async (videoUrl: string) => {
  return new Promise((resolve) => {
    const video = document.createElement('video');
    video.src = videoUrl;
    video.autoplay = true;
    video.muted = false; // Èü≥Â£∞ON
    // ... (Ë©≥Á¥∞„ÅØ‰∏äË®òÂèÇÁÖß)
  });
};
```

#### Day 3: „É™„Çª„ÉÉ„ÉàÈÄ≤ÊçóË°®Á§∫

**ÂÆüË£Ö**:

```typescript
// useDeviceReset.ts - updateResetProgress() ËøΩÂä†
const steps = [
  { name: '„É≠„Éº„Ç´„É´„Éá„Éº„ÇøÂâäÈô§', progress: 0 },
  { name: '„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢', progress: 25 },
  { name: 'IndexedDBÂâäÈô§', progress: 50 },
  { name: 'Service WorkerËß£Èô§', progress: 75 },
  { name: 'ÂÆå‰∫Ü', progress: 100 }
];

for (const step of steps) {
  updateResetProgress(step);
  await executeStep(step);
  await sleep(500);
}
```

#### Day 4-5: „Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„É≠„Ç∞

**„Éá„Éº„Çø„Éô„Éº„ÇπËøΩÂä†**:

```prisma
model DeviceActivityLog {
  id              String   @id @default(uuid())
  tenantId        String   @map("tenant_id")
  deviceId        String   @map("device_id")
  roomId          String?  @map("room_id")
  activityType    String   @map("activity_type")  // 'checkin', 'checkout', 'reset'
  guestCount      Int?     @map("guest_count")
  nationality     String?  @map("nationality")
  videoPlayed     Boolean  @default(false) @map("video_played")
  metadata        Json?    @map("metadata")
  createdAt       DateTime @default(now()) @map("created_at")
  
  @@map("device_activity_logs")
  @@index([tenantId, deviceId])
  @@index([tenantId, activityType, createdAt])
}
```

**APIËøΩÂä†Ôºàhotel-commonÔºâ**:

```typescript
// POST /api/v1/devices/activity-log
export async function createActivityLog(data: {
  deviceId: string;
  roomId?: string;
  activityType: 'checkin' | 'checkout' | 'reset';
  guestCount?: number;
  nationality?: string;
  videoPlayed?: boolean;
  metadata?: any;
}) {
  const tenantId = getTenantId(); // „Çª„ÉÉ„Ç∑„Éß„É≥„Åã„ÇâÂèñÂæó
  
  return await prisma.deviceActivityLog.create({
    data: {
      tenantId,
      deviceId: data.deviceId,
      roomId: data.roomId,
      activityType: data.activityType,
      guestCount: data.guestCount,
      nationality: data.nationality,
      videoPlayed: data.videoPlayed,
      metadata: data.metadata
    }
  });
}
```

**hotel-saas„Åã„Çâ„ÅÆÂëº„Å≥Âá∫„Åó**:

```typescript
// useDeviceCheckin.ts - handleCheckin()
const handleCheckin = (data: any) => {
  // ... („ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥Âá¶ÁêÜ)
  
  // „Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„É≠„Ç∞Ë®òÈå≤
  $fetch('/api/v1/devices/activity-log', {
    method: 'POST',
    body: {
      deviceId: getDeviceId(),
      roomId: data.roomNumber,
      activityType: 'checkin',
      guestCount: data.guestCount,
      nationality: data.nationality,
      videoPlayed: data.welcomeVideo?.shouldPlay,
      metadata: {
        checkinTime: data.checkinDate,
        welcomeVideoUrl: data.welcomeVideo?.videoUrl
      }
    }
  });
};
```

#### Day 6: Á∑äÊÄ•„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥

**ÂÆüË£Ö**:

```vue
<!-- pages/tv/settings.vue - Á∑äÊÄ•„É™„Çª„ÉÉ„ÉàËøΩÂä† -->
<div 
  class="setting-card emergency-reset"
  @mousedown="startLongPress"
  @mouseup="cancelLongPress"
  :class="{ 'long-pressing': isLongPressing }"
>
  <Icon name="heroicons:exclamation-triangle" class="text-red-500" />
  <h2>Á∑äÊÄ•„É™„Çª„ÉÉ„Éà</h2>
  <p>5ÁßíÈñìÈï∑Êäº„Åó„ÅßÂº∑Âà∂„É™„Çª„ÉÉ„Éà</p>
  <div v-if="isLongPressing" class="progress-ring">
    <svg class="progress-ring-svg">
      <circle :style="{ strokeDashoffset: progressOffset }" />
    </svg>
  </div>
</div>
```

#### Day 7: „ÉÜ„Çπ„Éà„ÉªË™øÊï¥

---

### Phase 4: PMSÈÄ£ÂãïÂº∑ÂåñÔºàhotel-pmsÂÆåÊàêÂæåÔºâüîµ Â∞ÜÊù•ÂÆüË£Ö

**PMS‰æùÂ≠ò„ÅÆÊ©üËÉΩ**:

#### Ë®ÄË™ûËá™ÂãïË®≠ÂÆöÔºà0.5Êó•Ôºâ

**hotel-pmsÂÅ¥ÂÆüË£Ö**:

```typescript
// hotel-pms: „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÊôÇ„Å´ÂõΩÁ±ç„Éá„Éº„Çø„Åã„ÇâÊé®Â•®Ë®ÄË™û„ÇíË®àÁÆó
const nationality = 'JP'; // „Ç≤„Çπ„Éà„ÅÆÂõΩÁ±ç
const preferredLanguage = getLanguageFromNationality(nationality);
// 'JP' ‚Üí 'ja'
// 'US', 'UK', 'AU' ‚Üí 'en'
// 'CN' ‚Üí 'zh-CN'
// 'KR' ‚Üí 'ko'

// WebSocket„Ç§„Éô„É≥„ÉàÈÖç‰ø°
websocket.send({
  type: 'GUEST_CHECKIN',
  data: {
    roomNumber: '301',
    nationality: nationality,
    language: preferredLanguage, // üÜï
    ...
  }
});
```

**hotel-saasÂÅ¥ÂÆüË£Ö**:

```typescript
// useDeviceCheckin.ts - handleCheckin()
const handleCheckin = (data: any) => {
  // ... (Êó¢Â≠òÂá¶ÁêÜ)
  
  // Ë®ÄË™ûËá™ÂãïË®≠ÂÆöÔºàPhase 4Ôºâ
  if (data.language) {
    locale.value = data.language;
    localStorage.setItem('preferred-language', data.language);
    console.log(`‚úÖ Ë®ÄË™û„ÇíËá™ÂãïË®≠ÂÆö: ${data.language}`);
  }
};
```

#### „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂâçÁ¢∫Ë™çÔºà1Êó•Ôºâ

**hotel-pmsÂÅ¥ÂÆüË£Ö**:

```typescript
// hotel-pms: „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà‰∫àÂÆöÊôÇÂàª„ÅÆ15ÂàÜÂâç„Å´„Ç§„Éô„É≥„ÉàÈÖç‰ø°
const checkoutTime = new Date('2025-10-16T11:00:00Z');
const now = new Date();
const minutesRemaining = Math.floor((checkoutTime.getTime() - now.getTime()) / 60000);

if (minutesRemaining === 15) {
  websocket.send({
    type: 'CHECKOUT_WARNING', // üÜï
    data: {
      roomNumber: '301',
      checkoutTime: checkoutTime.toISOString(),
      minutesRemaining: 15
    }
  });
}
```

**hotel-saasÂÅ¥ÂÆüË£Ö**:

```typescript
// useDeviceCheckin.ts - handleCheckoutWarning()
const handleCheckoutWarning = (data: any) => {
  showModal({
    title: '„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„ÅÆ„ÅîÊ°àÂÜÖ',
    message: '„ÅÇ„Å®15ÂàÜ„Åß„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÊôÇÂàª„Åß„Åô„ÄÇ\nÊ≥®Êñá‰∏≠„ÅÆÂïÜÂìÅ„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÅäÊó©„ÇÅ„Å´Á¢∫ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ',
    icon: '‚è∞',
    buttons: [
      { label: 'Á¢∫Ë™ç', action: 'dismiss' },
      { label: 'Ê≥®ÊñáÁîªÈù¢„Å∏', action: () => navigateTo('/order/cart') }
    ]
  });
};

// WebSocket„Ç§„Éô„É≥„Éà„Éè„É≥„Éâ„É©„Å´ËøΩÂä†
switch (data.type) {
  case 'GUEST_CHECKIN': handleCheckin(data.data); break;
  case 'CHECKOUT_WARNING': handleCheckoutWarning(data.data); break; // üÜï
  case 'GUEST_CHECKOUT': handleCheckout(); break;
}
```

---

## üìä ÂÆüË£ÖÁä∂Ê≥Å

### ÂÖ®‰ΩìÂÆåÊàêÂ∫¶: **85%**

| „Ç´„ÉÜ„Ç¥„É™ | ÂÆåÊàêÂ∫¶ | Áä∂Ê≥Å |
|:--------|:-----:|:-----|
| **Composables** | 100% | 5„Å§ÂÖ®„Å¶ÂÆåÊàêÔºàuseWebView, useTVFocus, useDeviceAuth, useDeviceCheckin, useDeviceResetÔºâ |
| **Middleware/API** | 100% | Ë™çË®º„Éï„É≠„ÉºÂÆåÁíßÔºàdevice-guard.ts, check-status.post.ts, client-ip.get.tsÔºâ |
| **„Éó„É©„Ç∞„Ç§„É≥** | 100% | webview-security.client.tsÂÆåÊàê |
| **TVÂêë„Åë„Éö„Éº„Ç∏** | 95% | concierge.vue (95%), settings.vue (100%) |
| **WebViewÊ§úÂá∫** | 100% | UserAgentÂà§ÂÆöÂÆåÁíß |
| **„É™„É¢„Ç≥„É≥Êìç‰Ωú** | 100% | „Ç∞„É™„ÉÉ„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ÂÆåÁíß |
| **„Éá„Éê„Ç§„ÇπË™çË®º** | 100% | MAC/IPË™çË®ºÂÆåÊàê |
| **WebSocketÈÄ£Êê∫** | 100% | „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„Éà„Ç§„Éô„É≥„Éà |
| **CapacitorË®≠ÂÆö** | 0% | Êú™‰ΩúÊàêÔºàPhase 2„ÅßÂÆüË£ÖÔºâ |
| **Google PlayÈÖç‰ø°** | 0% | Êú™ÂÆüÊñΩÔºàPhase 2„ÅßÂÆüÊñΩÔºâ |

### PhaseÂà•ÂÆåÊàêÂ∫¶

#### Phase 1: Êó¢Â≠òÊ©üËÉΩÔºàÂÆå‰∫ÜÁéá: 100%Ôºâ

| # | Ê©üËÉΩ | ÂÆüË£ÖÁä∂Ê≥Å | ÂÆåÊàêÂ∫¶ | ÂÇôËÄÉ |
|:-:|:-----|:--------|:-----:|:-----|
| 1 | useDeviceCheckin.ts | ‚úÖ | 100% | „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥/„Ç¶„Çß„É´„Ç´„É†„É†„Éº„Éì„Éº |
| 2 | useDeviceReset.ts | ‚úÖ | 100% | „Éá„Éê„Ç§„Çπ„É™„Çª„ÉÉ„Éà |
| 3 | useWebView.ts | ‚úÖ | 100% | WebViewÊ§úÂá∫ |
| 4 | useTVFocus.ts | ‚úÖ | 100% | „É™„É¢„Ç≥„É≥Êìç‰Ωú |
| 5 | useDeviceAuth.ts | ‚úÖ | 100% | „Éá„Éê„Ç§„ÇπË™çË®º |
| 6 | device-guard.ts | ‚úÖ | 100% | Ë™çË®º„Éü„Éâ„É´„Ç¶„Çß„Ç¢ |
| 7 | webview-security.client.ts | ‚úÖ | 100% | „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Éó„É©„Ç∞„Ç§„É≥ |
| 8 | /tv/concierge.vue | ‚úÖ | 95% | AI„Ç≥„É≥„Ç∑„Çß„É´„Ç∏„É• |
| 9 | /tv/settings.vue | ‚úÖ | 100% | Ë®≠ÂÆöÁîªÈù¢ |

#### Phase 2: Capacitor + Google PlayÔºàÂÆå‰∫ÜÁéá: 0%Ôºâ

| # | Ê©üËÉΩ | ÂÆüË£ÖÁä∂Ê≥Å | ÂÑ™ÂÖàÂ∫¶ | Â∑•Êï∞ |
|:-:|:-----|:--------|:-----:|:----:|
| 1 | capacitor.config.ts | ‚ùå | üî¥ | 1Êó• |
| 2 | AndroidManifest.xml | ‚ùå | üî¥ | 1Êó• |
| 3 | APK„Éì„É´„Éâ | ‚ùå | üî¥ | 2Êó• |
| 4 | Google PlayÈÖç‰ø° | ‚ùå | üî¥ | 3Êó• |

#### Phase 3: UIÂº∑ÂåñÔºàÂÆå‰∫ÜÁéá: 0%Ôºâ

| # | Ê©üËÉΩ | ÂÆüË£ÖÁä∂Ê≥Å | ÂÑ™ÂÖàÂ∫¶ | Â∑•Êï∞ |
|:-:|:-----|:--------|:-----:|:----:|
| 1 | „Çµ„É≥„ÇØ„Çπ„É†„Éº„Éì„Éº | ‚ùå | üü° | 1Êó• |
| 2 | „É™„Çª„ÉÉ„ÉàÈÄ≤ÊçóË°®Á§∫ | ‚ùå | üü¢ | 0.5Êó• |
| 3 | „Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„É≠„Ç∞ | ‚ùå | üü° | 2Êó• |
| 4 | Á∑äÊÄ•„É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ | ‚ùå | üü¢ | 0.5Êó• |

#### Phase 4: PMSÈÄ£ÂãïÔºàÂÆå‰∫ÜÁéá: 0%Ôºâ

| # | Ê©üËÉΩ | ÂÆüË£ÖÁä∂Ê≥Å | ÂÑ™ÂÖàÂ∫¶ | Â∑•Êï∞ | ‰æùÂ≠ò |
|:-:|:-----|:--------|:-----:|:----:|:-----|
| 1 | Ë®ÄË™ûËá™ÂãïË®≠ÂÆö | ‚ùå | üîµ | 0.5Êó• | hotel-pmsÂÆåÊàêÂæå |
| 2 | „ÉÅ„Çß„ÉÉ„ÇØ„Ç¢„Ç¶„ÉàÂâçÁ¢∫Ë™ç | ‚ùå | üîµ | 1Êó• | hotel-pmsÂÆåÊàêÂæå |

---

## üìö ÂèÇÁÖß„Éâ„Ç≠„É•„É°„É≥„Éà

### SSOT
1. **SSOT_SAAS_DEVICE_AUTHENTICATION.md** v1.0.0 ‚òÖ - „Éá„Éê„Ç§„ÇπË™çË®º„Ç∑„Çπ„ÉÜ„É†
2. **SSOT_GUEST_ROOM_SERVICE_UI.md** v1.0.0 ‚òÖ - ÂÆ¢ÂÆ§UIÂÖ®‰Ωì
3. **SSOT_GUEST_ORDER_FLOW.md** v1.0.0 ‚òÖ - Ê≥®Êñá„Éï„É≠„Éº
4. **SSOT_GUEST_MENU_VIEW.md** v1.0.0 ‚òÖ - „É°„Éã„É•„ÉºÈñ≤Ë¶ß
5. **SSOT_SAAS_MULTITENANT.md** - „Éû„É´„ÉÅ„ÉÜ„Éä„É≥„ÉàÂü∫Áõ§

### ÊäÄË°ì„Éâ„Ç≠„É•„É°„É≥„Éà
6. **MOBILE_APP_SPECIFICATION.md** ‚òÖ‚òÖ‚òÖ - Capacitor + Nuxt 3 WebViewÊßãÊàê
7. **TV_GOOGLE_PLAY_APPS_SPEC.md** - Google Play„Ç¢„Éó„É™„É©„É≥„ÉÅ„É£„Éº
8. **MVP_DEV_TASKS.md** - Phase 2: „É¢„Éê„Ç§„É´„Ç¢„Éó„É™ÂåñÔºà5ÈÄ±ÈñìÔºâ

### Ê®ôÊ∫ñ„ÉªË¶èÁ¥Ñ
9. **DATABASE_NAMING_STANDARD.md** v3.0.0 - ÂëΩÂêçË¶èÂâá
10. **API_ROUTING_GUIDELINES.md** - APIË®≠Ë®à

---

**‰ΩúÊàêÊó•**: 2025-10-15  
**„Éê„Éº„Ç∏„Éß„É≥**: v1.0.0  
**ÁÆ°ÁêÜËÄÖ**: Sun (hotel-saasÊãÖÂΩì)


