# 📋 共通セクション（全テンプレート共通）

**目的**: 全てのプロンプトで共通して使用するセクション

---

## 📍 Phase 0: 事前調査（必須・15分）

### 目的
既存実装パターンの把握と実装方針の決定

### 実施内容

#### ステップ1: 既存の類似ファイルを探す

```bash
# 対象ディレクトリの既存ファイル一覧
find [対象ディレクトリ] -name "*.vue" -type f | head -10
# または
find [対象ディレクトリ] -name "*.ts" -type f | head -10

# 一覧表示
ls -la [対象ディレクトリ]
```

**確認ポイント**:
- 既存ファイルの構造
- ファイル命名規則
- ディレクトリ構成

#### ステップ2: 既存ファイルを読む

```bash
# 最も参考になりそうなファイルを1つ選んで読む
cat [参考ファイルパス]
```

**確認ポイント**:
- コードの書き方
- パターン・規約
- 使用しているライブラリ・関数

#### ステップ3: 関連ファイルの確認

```bash
# 関連ファイルを確認
ls -la [関連ディレクトリ]

# 存在する場合は読む
cat [関連ファイルパス]
```

#### ステップ4: 使用パターンの確認

```bash
# 特定のパターンの使用例を確認
grep -r "[検索パターン]" [対象ディレクトリ] | head -5
```

### 📊 Phase 0 完了報告テンプレート

```markdown
## Phase 0 完了報告

### 既存実装確認
- [ ] 類似ファイル: [ファイル名] を確認済み
  - パターン: [確認した実装パターン]
- [ ] 関連ファイル: [存在する/存在しない]
- [ ] 使用パターン: [リスト]

### 実装方針
- 参考ファイル: [既存ファイル名]を参考にする
- 実装パターン: [確認したパターン]
- 使用する機能: [リスト]

### 不明点（あれば）
- [質問1]
- [質問2]

実装を開始してよろしいでしょうか？
```

**⚠️ 重要**: Phase 0完了報告をユーザーに提出し、承認を得てから次に進んでください。

---

## 🚨 エラー時の対処フロー（共通）

### エラーパターン1: ファイルが見つからない

**症状**: `cat`, `ls`等で「No such file or directory」

**対処**:
```bash
# パスを再確認
pwd

# ディレクトリ構造を確認
find [親ディレクトリ] -name "[ファイル名パターン]"
```

### エラーパターン2: 権限エラー

**症状**: 「Permission denied」

**対処**:
```bash
# ファイル権限を確認
ls -la [ファイルパス]

# ユーザーに報告
```

### エラーパターン3: 既存実装が見つからない

**症状**: 参考にすべきファイルが存在しない

**対処**:
1. より広い範囲で検索
2. 類似機能を探す
3. ドキュメントを確認
4. ユーザーに質問

---

## 📝 完了報告テンプレート（各Phase共通）

```markdown
## Phase [X] 完了報告

### 実施内容
- [実施した内容1]
- [実施した内容2]

### 実装ファイル（該当する場合）
- `[ファイルパス]`: [新規作成/編集]

### チェックリスト
- [ ] [確認項目1]
- [ ] [確認項目2]

### 不明点（あれば）
- [質問1]

次のPhaseに進んでよろしいでしょうか？
```

---

## 📋 受入基準（共通）

### 必須項目

1. **機能動作**
   - [ ] 実装した機能が正常に動作する
   - [ ] エラーが発生しない

2. **SSOT準拠**
   - [ ] 参照SSOTの要件を全て満たす
   - [ ] 禁止事項を守っている

3. **コード品質**
   - [ ] TypeScript型定義
   - [ ] エラーハンドリング
   - [ ] 適切な命名

4. **証跡**
   - [ ] 動作確認ログ
   - [ ] スクリーンショット（UI実装の場合）
   - [ ] 変更ファイルリスト

---

## 🛡️ 実装ガード（共通・絶対禁止事項）

### 禁止1: プレースホルダーの使用 ❌

```typescript
// ❌ 間違い
const data = await fetchData() // 想像上の関数
import { SomeType } from '@/types' // プレースホルダー

// ✅ 正しい
// 実際に存在する関数・型のみ使用
```

### 禁止2: 確認していないことを「確認済み」と言う ❌

```markdown
// ❌ 間違い
"既に確認しました"（実際は確認していない）

// ✅ 正しい
"今から確認します"
```

### 禁止3: 曖昧な表現 ❌

```markdown
// ❌ 間違い
"たぶん〜だと思います"
"おそらく〜でしょう"
"〜かもしれません"

// ✅ 正しい
"確認します"
"調査します"
```

---

## 🎯 Marketing Injection（マーケ視点チェック・必須）

### 目的
高品質な機能開発と高速なマーケティングを両立させるためのチェックリスト

### Config First（ハードコード禁止）

**原則**: テキスト・文言・価格はハードコードしない

```typescript
// ❌ 禁止: ハードコード
const welcomeMessage = 'いらっしゃいませ！'
const price = 9800
const campaignText = '期間限定20%OFF'

// ✅ 推奨: Config/DB から取得
const welcomeMessage = await getConfig('ai.welcome_message', tenantId)
const price = await getTenantSetting('starter.price', tenantId)
const campaignText = await getI18n('campaign.limited_offer', tenantId)
```

**チェックリスト**:
- [ ] UIに表示するテキスト・文言はハードコードしていないか？
- [ ] 価格・割引率はハードコードしていないか？
- [ ] AIの口調・人格設定はハードコードしていないか？
- [ ] キャンペーン関連のパラメータはハードコードしていないか？

**許容されるハードコード**:
- システムエラーメッセージ（開発者向け）
- ログ出力メッセージ
- 技術的な定数（ポート番号、タイムアウト値等）

### Tracking by Default（計測必須）

**原則**: 全てのアクションに計測タグを入れる

```vue
<!-- ❌ 禁止: 計測タグなし -->
<button @click="sendMessage">送信</button>

<!-- ✅ 推奨: data-analytics-id 必須 -->
<button 
  data-analytics-id="ai-chat-send"
  @click="sendMessage"
>
  送信
</button>
```

```typescript
// ❌ 禁止: ログなしAPI
router.post('/', async (req, res) => {
  // 処理のみ
})

// ✅ 推奨: ログ出力必須
router.post('/', async (req, res) => {
  console.log('[POST /api/v1/xxx] tenantId:', tenantId, 'userId:', userId)
  // 処理
})
```

**チェックリスト**:
- [ ] 全てのCTAボタンに `data-analytics-id` を付与したか？
- [ ] APIエンドポイントにリクエストログを出力しているか？
- [ ] 重要なユーザーアクション（カート追加、注文確定等）はDB記録しているか？

**計測すべきイベント例**:
| イベント | analytics-id | 記録先 |
|:---------|:-------------|:-------|
| AIチャット送信 | `ai-chat-send` | console + DB |
| AI推奨クリック | `ai-recommend-click` | DB必須 |
| カート追加 | `cart-add` | DB必須 |
| 注文確定 | `order-confirm` | DB必須 |

### 親タスク完了ルール（必須）

**サブタスクが全て完了したら、親タスクもDoneにする**

```markdown
## 親タスク完了チェック

親タスク: DEV-0160 [MVP] FAQ自動応答
├── DEV-0161: コンテンツ設計 → Done ✅
├── DEV-0162: API実装 → Done ✅
├── DEV-0163: UI実装 → Done ✅
└── DEV-0164: テスト → Done ✅

↓ 全サブタスクDone

✅ 親タスク DEV-0160 も Done に更新
```

**チェック方法**:
```bash
# 自動チェック（dry-run）
cd /Users/kaneko/hotel-kanri/scripts/plane
node check-parent-completion.cjs --dry-run

# 実行（親タスクを自動更新）
node check-parent-completion.cjs
```

**手動更新の場合**:
```bash
# Plane UIで親タスクをDoneに変更
# または
node -e "
const api = require('./lib/plane-api-client.cjs');
// COM-XXX を Done に更新
"
```

---

### 📊 Marketing Injection 完了報告

```markdown
## Marketing Injection チェック完了

### Config First
- [ ] テキスト・文言: ハードコードなし
- [ ] 価格・パラメータ: 外部注入可能
- [ ] 対象ファイル: [ファイル一覧]

### Tracking by Default
- [ ] CTAボタン: data-analytics-id 付与済み
- [ ] APIログ: console出力あり
- [ ] 重要イベント: DB記録あり
- [ ] 追加したanalytics-id: [一覧]

### 備考
- [特記事項があれば]
```

---

## 📞 質問テンプレート

**実装前・実装中に不明点が出た場合**:

```markdown
## 質問

### 質問内容
[具体的な質問]

### 確認したこと
- [ ] 該当SSOTを読んだ
- [ ] 既存実装を確認した
- [ ] エラーメッセージを確認した

### 現在の状況
- Phase: [Phase X]
- 実施済みステップ: [ステップX]
- エラー内容（あれば）: [エラーメッセージ]

### 提案する対処法（あれば）
[対処法1]
[対処法2]
```

**ユーザーの承認を得てから次に進んでください。**

